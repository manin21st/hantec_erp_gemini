$PBExportHeader$w_adt_00290.srw
$PBExportComments$작업지시 등록(ADT)
forward
global type w_adt_00290 from w_inherite
end type
type gb_2 from groupbox within w_adt_00290
end type
type gb_1 from groupbox within w_adt_00290
end type
type cb_suju from commandbutton within w_adt_00290
end type
type gb_3 from groupbox within w_adt_00290
end type
type tab_1 from tab within w_adt_00290
end type
type tabpage_1 from userobject within tab_1
end type
type cbx_2 from checkbox within tabpage_1
end type
type rr_3 from roundrectangle within tabpage_1
end type
type rr_2 from roundrectangle within tabpage_1
end type
type p_tabpage1_cancel from uo_picture within tabpage_1
end type
type p_tabpage1_commit from uo_picture within tabpage_1
end type
type p_tabpage1_print from uo_picture within tabpage_1
end type
type p_1 from uo_picture within tabpage_1
end type
type dw_plnlist from u_d_select_sort within tabpage_1
end type
type dw_layout1 from datawindow within tabpage_1
end type
type cbx_1 from checkbox within tabpage_1
end type
type pb_3 from u_pic_cal within tabpage_1
end type
type dw_date from datawindow within tabpage_1
end type
type tabpage_1 from userobject within tab_1
cbx_2 cbx_2
rr_3 rr_3
rr_2 rr_2
p_tabpage1_cancel p_tabpage1_cancel
p_tabpage1_commit p_tabpage1_commit
p_tabpage1_print p_tabpage1_print
p_1 p_1
dw_plnlist dw_plnlist
dw_layout1 dw_layout1
cbx_1 cbx_1
pb_3 pb_3
dw_date dw_date
end type
type tabpage_2 from userobject within tab_1
end type
type p_jaje from uo_picture within tabpage_2
end type
type p_13 from uo_picture within tabpage_2
end type
type p_delall from uo_picture within tabpage_2
end type
type rr_4 from roundrectangle within tabpage_2
end type
type dw_link from u_key_enter within tabpage_2
end type
type dw_stock from u_key_enter within tabpage_2
end type
type p_14 from uo_picture within tabpage_2
end type
type rr_9 from roundrectangle within tabpage_2
end type
type p_4 from uo_picture within tabpage_2
end type
type p_3 from uo_picture within tabpage_2
end type
type p_2 from uo_picture within tabpage_2
end type
type p_tabpage2_insert from uo_picture within tabpage_2
end type
type p_12 from uo_picture within tabpage_2
end type
type p_auto from uo_picture within tabpage_2
end type
type p_last from uo_picture within tabpage_2
end type
type dw_tabpage2 from datawindow within tabpage_2
end type
type st_pordno from statictext within tabpage_2
end type
type tabpage_2 from userobject within tab_1
p_jaje p_jaje
p_13 p_13
p_delall p_delall
rr_4 rr_4
dw_link dw_link
dw_stock dw_stock
p_14 p_14
rr_9 rr_9
p_4 p_4
p_3 p_3
p_2 p_2
p_tabpage2_insert p_tabpage2_insert
p_12 p_12
p_auto p_auto
p_last p_last
dw_tabpage2 dw_tabpage2
st_pordno st_pordno
end type
type tabpage_3 from userobject within tab_1
end type
type rr_8 from roundrectangle within tabpage_3
end type
type p_17 from uo_picture within tabpage_3
end type
type p_16 from uo_picture within tabpage_3
end type
type rr_7 from roundrectangle within tabpage_3
end type
type dw_tabpage3_3 from datawindow within tabpage_3
end type
type cb_3 from commandbutton within tabpage_3
end type
type p_15 from uo_picture within tabpage_3
end type
type p_save from uo_picture within tabpage_3
end type
type cb_2 from commandbutton within tabpage_3
end type
type cb_1 from commandbutton within tabpage_3
end type
type rr_1 from roundrectangle within tabpage_3
end type
type rr_6 from roundrectangle within tabpage_3
end type
type dw_etc from u_key_enter within tabpage_3
end type
type rr_5 from roundrectangle within tabpage_3
end type
type dw_wkctr from u_key_enter within tabpage_3
end type
type p_8 from uo_picture within tabpage_3
end type
type p_7 from uo_picture within tabpage_3
end type
type p_9 from uo_picture within tabpage_3
end type
type p_11 from uo_picture within tabpage_3
end type
type p_10 from uo_picture within tabpage_3
end type
type dw_tabpage3_1 from datawindow within tabpage_3
end type
type dw_tabpage3_2 from datawindow within tabpage_3
end type
type gb_5 from groupbox within tabpage_3
end type
type dw_jego from u_key_enter within tabpage_3
end type
type tabpage_3 from userobject within tab_1
rr_8 rr_8
p_17 p_17
p_16 p_16
rr_7 rr_7
dw_tabpage3_3 dw_tabpage3_3
cb_3 cb_3
p_15 p_15
p_save p_save
cb_2 cb_2
cb_1 cb_1
rr_1 rr_1
rr_6 rr_6
dw_etc dw_etc
rr_5 rr_5
dw_wkctr dw_wkctr
p_8 p_8
p_7 p_7
p_9 p_9
p_11 p_11
p_10 p_10
dw_tabpage3_1 dw_tabpage3_1
dw_tabpage3_2 dw_tabpage3_2
gb_5 gb_5
dw_jego dw_jego
end type
type tab_1 from tab within w_adt_00290
tabpage_1 tabpage_1
tabpage_2 tabpage_2
tabpage_3 tabpage_3
end type
type dw_ban from datawindow within w_adt_00290
end type
type dw_jaje from datawindow within w_adt_00290
end type
type st_2 from statictext within w_adt_00290
end type
type sle_bal from singlelineedit within w_adt_00290
end type
type st_3 from statictext within w_adt_00290
end type
type dw_saupj from datawindow within w_adt_00290
end type
type dw_print from datawindow within w_adt_00290
end type
type cbx_jaje from checkbox within w_adt_00290
end type
end forward

global type w_adt_00290 from w_inherite
integer width = 5595
integer height = 2932
string title = "작업지시 등록"
boolean minbox = false
boolean resizable = false
gb_2 gb_2
gb_1 gb_1
cb_suju cb_suju
gb_3 gb_3
tab_1 tab_1
dw_ban dw_ban
dw_jaje dw_jaje
st_2 st_2
sle_bal sle_bal
st_3 st_3
dw_saupj dw_saupj
dw_print dw_print
cbx_jaje cbx_jaje
end type
global w_adt_00290 w_adt_00290

type variables
string ispordno  // 작업지시번호
string isholdno  // 할당번호
integer iChoice // 부하현황-율,공수기준
string is_chk    //datawindow 변경여부
String  ls_auto //자동채번여부
String  isgyymm
integer iimoseq
datastore d_pdt_02030_strerr
boolean bomcheck
integer i_level // treeview
string trscode, trsname // 부하현황 조회용
integer ii_factor = 100 // 프린터 줌
boolean   iv_b_down = false, ib_rcal = false
String  is_sysno // 작업지시 기준번호 

String is_seemonth //월 계획 수량 잔량 같이 보기 Flag

w_adt_00290_1 iw_window

// m환산기준
Dec idMeter

int            drag_start_row,drag_end_row
boolean    ib_down
end variables

forward prototypes
public subroutine wf_treeview_item ()
public function integer wf_requiredchk_bomrtn (string sitnbr, ref string srtnbr)
public function integer wf_requiredchk_tabpage4 (ref long lrow, ref string scolumn)
public function integer wf_update ()
public function integer wf_requiredchk_tabpage2_final (ref string scolumn, ref long lrow)
public function integer wf_requiredchk_bomrtn2 (long currlow, string sitnbr, ref string srtnbr, string spordno)
public subroutine wf_tabpage1_layout (long lrow)
public function integer wf_requiredchk_tabpage2 (ref string scolumn, ref long lrow)
public function integer wf_requiredchk_tabpage31 (ref long lrow, ref string scolumn)
public function integer wf_reset ()
public function integer wf_treeview_retrieve ()
public function integer wf_treeview_retrieve2 ()
public function integer wf_treeview_retrieve1 ()
public function integer wf_requiredchk_tabpage1 ()
public function string wf_depotno (string oversea_gu, string sjumaechul)
public subroutine wf_item_check (long arg_row, string arg_itnbr, string arg_spspec, string arg_opseq)
public function integer wf_stock_link (string arg_gubun, long arg_row)
public function integer wf_calc_time (long ar_row, string ar_gub)
public function integer wf_calc_time2 (long ar_row, string ar_gub)
public function integer wf_copy_row (integer arg_start, integer arg_end)
public function decimal wf_convert_qty (string arg_itnbr, decimal arg_qty, string arg_gubun)
public function integer wf_hold_jaje ()
end prototypes

public subroutine wf_treeview_item ();
return 
end subroutine

public function integer wf_requiredchk_bomrtn (string sitnbr, ref string srtnbr);String	sDitnbr, sReff, sReff1, stimegu, spdtgu
Long Lrow

// 생산팀별로 bom,공정이 별도로 구성됨
sPdtgu = tab_1.tabpage_1.dw_date.GetItemString(1, 'steam')

Lrow = d_pdt_02030_strerr.insertrow(0)

/* BOM이 있는 지 확인
	1. 지시품번에 하위부품이 있는지
	2. 표준품번에 하위부품이 있는지	*/
Long lcnt, Lcnt1, lcnt2
Lcnt = 0
Select count(*) Into :lcnt from pstruc
 Where pinbr = :sitnbr;
 
if Isnull(Lcnt) or Lcnt < 1 then
	Select stdnbr Into :sDitnbr From itemas
	 Where itnbr = :sItnbr;

	/* 대표품번에 대한 BOM 검색 */
	Lcnt = 0
	Select count(*) Into :lcnt from pstruc
	 Where pinbr = :sDitnbr;
	 
	if Isnull(Lcnt) or Lcnt < 1 then		 
		d_pdt_02030_strerr.setitem(Lrow, "err5", 2)
	   dw_insert.setitem(Lrow, "momast_copy_holdct", 'N')		
		bomcheck = true
	End if
	sRtnbr = sDitnbr
Else
	sRtnbr = sitnbr
end if

if isnull(sRtnbr) or trim(sRtnbr) = '' then sRtnbr = sitnbr

d_pdt_02030_strerr.setitem(Lrow, "itnbr", sitnbr)
d_pdt_02030_strerr.setitem(Lrow, "stdnbr", srtnbr)		 

/* 표준공정순서에 동시공정이 1개 이상인 경우 check */
lcnt = 0
Select count(*)
  into :lcnt
  from 
		(select itnbr, opseq, twocod
			from routng
		  where itnbr = :sRtnbr
			 and twocod is not null) a,
		routng b
 where a.itnbr  = b.itnbr
	and a.twocod = b.opseq
	and b.twocod is not null;

if lcnt > 0 then
	d_pdt_02030_strerr.setitem(Lrow, "err1", 2)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true	
end if

/* 시간은 환경설정의 표준시간, 평균시간으로 한다 
   1: 표준시간, 2:평균시간 */
select dataname
  into :stimegu
  from syscnfg
 where sysgu = 'Y' and serial = '15' and lineno = '3';
 
if stimegu <>  '1' and stimegu <> '2' then
	sTimegu = '1'
end if

/* 표준공정에 시간이 없는지 check, 최초/최종공정이 1개이상인지 check 
   표준시간 check시 작업장마스터를 기준으로 
	시간구분 1 : Man H/R필수
	         2 : M/C H/R필수 
				3 또는 4 : Man + M/C 필수 */
Dec {2} dTotime

Lcnt 	= 0
Lcnt1 = 0	
Lcnt2 = 0	
Select Sum(Decode(:stimegu, '1', Decode(b.basic, '1', manhr,  '2', mchr,  '3', manhr  + mchr, 9), 0) +
		     Decode(:stimegu, '2', Decode(b.basic, '1', manhr1, '2', mchr1, '3', manhr1 + mchr1, 9), 0)),
		 Sum(decode(lastc, '1', 1, '9', 1, 0)),
		 Sum(decode(Lastc, '3', 1, '9', 1, 0)), count(*)
  into :dTotime, :lcnt, :Lcnt1, :Lcnt2
  from routng a, wrkctr b
 where a.itnbr = :sRtnbr
 	and a.wkctr = b.wkctr;

if dTotime = 0 or sqlca.sqlcode <> 0 then
	d_pdt_02030_strerr.setitem(Lrow, "err2", 2)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true	
end if

if Lcnt > 1 then
	d_pdt_02030_strerr.setitem(Lrow, "err2", 3)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if	

if Lcnt1 > 1 then
	d_pdt_02030_strerr.setitem(Lrow, "err2", 4)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

if Lcnt2 = 0 then
	d_pdt_02030_strerr.setitem(Lrow, "err2", 5)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')	
	bomcheck = true		
end if

/* 최초공정이 동시공정인지 check하고 공정순서가 맞는지 check */
Setnull(sReff)
Setnull(sReff1)
select lastc, twocod into :sreff, :sreff1 From routng
 Where itnbr = :sRtnbr 
	And opseq = (select Min(opseq) from routng where itnbr = :sRtnbr);
 
If sReff = '1' or sReff = '9' then
else
	d_pdt_02030_strerr.setitem(Lrow, "err3", 2)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

If isnull(sReff1) or trim(sReff1)  = '' then
Else
	d_pdt_02030_strerr.setitem(Lrow, "err3", 3)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

select lastc, twocod into :sreff, :sreff1 From routng
 Where itnbr = :sRtnbr 
	And opseq = (select Max(opseq) from routng where itnbr = :sRtnbr);

If sReff = '3' or sReff = '9' then
else
	d_pdt_02030_strerr.setitem(Lrow, "err4", 2)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

If isnull(sReff1) or trim(sReff1)  = '' then
Else
	d_pdt_02030_strerr.setitem(Lrow, "err4", 3)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

return 0
end function

public function integer wf_requiredchk_tabpage4 (ref long lrow, ref string scolumn);/* 자재 할당 내역 검색 */

string   snull, sitnbr, sreff, sreff1, sitdsc, sispec, scvcod, sopseq, spordno, stoday
integer  ireturn
Decimal  {5} dunprc
long lcnt, lfind

w_mdi_frame.sle_msg.text = "자재할당내역을 검색중입니다......!!"

sToday = f_today()

tab_1.tabpage_3.dw_jego.accepttext()

setnull(snull)

For 	lcnt = 1 to tab_1.tabpage_3.dw_jego.rowcount()
		lrow = lcnt
		
		/* 공정순서 check */
		If 	isnull(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "opseq")) or &
				Trim(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "opseq")) = '' then
				f_message_chk(30, '[공정순서]')
				sColumn = "opseq"
				return -1
		end if
		
		/* 품번 check */
		If 	isnull(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "itnbr")) or &
				Trim(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "itnbr")) = '' then
				f_message_chk(30, '[품목번호]')
				sColumn = "itnbr"
				return -1
		end if
		
		/* 사양 check */
		If 	isnull(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "pspec")) or &
				Trim(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "pspec")) = '' then
				tab_1.tabpage_3.dw_jego.setitem(Lcnt, 'pspec', '.')
		end if		
		
		/* 할당수량 check */
		If 	tab_1.tabpage_3.dw_jego.getitemdecimal(Lcnt, "hold_qty") = 0 then
				f_message_chk(30, '[할당수량]')
				sColumn = "hold_qty"
				return -1
		end if		
		
		/* 출고창고 check */
		If 	isnull(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "out_store")) or &
				Trim(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "out_store")) = '' then
				f_message_chk(30, '[출고창고]')
				sColumn = "out_store"
				return -1
		end if
		
		/* 출고요총창고 check */
		If 	isnull(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "hold_store")) or &
				Trim(tab_1.tabpage_3.dw_jego.getitemstring(Lcnt, "hold_store")) = '' then
				f_message_chk(30, '[출고요청창고]')
				sColumn = "out_store"
				return -1
		end if
				
	
Next

if tab_1.tabpage_3.dw_jego.update() = 1 then
	commit;
Else
	Lrow = 1
	sColumn = 'opseq'
	Rollback;
	return -1
end if

return 1
end function

public function integer wf_update ();string  sdptno, sitnbr, stoday, spaordno, spaopseq
Decimal {3} djiqty
Long    Lrow

integer ii

w_mdi_frame.sle_msg.text = ''
stoday = f_today()

/* 분할인 경우에는 분할되는 작업지시에 수량을 저장 */
For Lrow = 1 to tab_1.tabpage_2.dw_tabpage2.rowcount()
	if not isnull(tab_1.tabpage_2.dw_tabpage2.getitemstring(1, "momast_copy_pa_pordno")) then
		 spaordno = tab_1.tabpage_2.dw_tabpage2.getitemstring(1, "momast_copy_pa_pordno")
		 spaopseq = tab_1.tabpage_2.dw_tabpage2.getitemstring(1, "momast_copy_pa_ospeq")
		 djiqty   = tab_1.tabpage_2.dw_tabpage2.getitemdecimal(1, "momast_copy_pdqty")
	
		 Update momast
			 set paqty = paqty + :djiqty
		  where sabu  = :gs_sabu and pordno = :spaordno;
		  
		 if sqlca.sqlcode <> 0 then
			 f_message_chk(32, "분할 작업지시-Head")
			 return -1
		end if
	  
		 Update morout
			 set paqty = paqty + :djiqty
		  where sabu  = :gs_sabu and pordno = :spaordno and opseq = :spaopseq;
		  
		 if sqlca.sqlcode <> 0 then
			 f_message_chk(32, "분할 작업지시-Detail")
			 return -1
		end if		  
	
	End if
Next

return 1
end function

public function integer wf_requiredchk_tabpage2_final (ref string scolumn, ref long lrow);string   snull, sitnbr, sreff, sreff1, sitdsc, sispec, scvcod, sopseq, sDitnbr, sRtnbr, sopdsc, spordno
integer  ireturn
Decimal  {5} dunprc
Decimal  {3} dgaqty

w_mdi_frame.sle_msg.text = '자료를 검사중입니다.....!!'

setnull(snull)

For lrow = 1 to tab_1.tabpage_2.dw_tabpage2.rowcount()
	
	/* 작업지시구분 check */
	if isnull(f_get_reffer('60', tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_porgu"))) then
		f_message_chk(79,'[작업지시구분]') 
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_porgu", '')
		scolumn = "momast_copy_porgu"
		RETURN  -1
	END IF
	
	spordno = trim(tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pordno"))	
	sItnbr  = trim(tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_itnbr"))
	if 	isnull(sitnbr) or trim(sitnbr) = '' then	
		sitnbr ='X1'
	end if	
	
	ireturn = f_get_name2('품번', 'Y', sitnbr, sitdsc, sispec)    //1이면 실패, 0이 성공	
	if 	ireturn = 1 then
		scolumn = "momast_copy_itnbr"
		RETURN -1
	end if
	
	if dec(tab_1.tabpage_2.dw_tabpage2.getitemdecimal(Lrow, "momast_copy_pdqty")) < 1 then
		scolumn = "momast_copy_pdqty"
		f_message_chk(78,'[지시수량]') 
		RETURN -1	
	end if
	
	sreff = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pspec")
	if isnull(sreff) or trim(sreff) = '' then	
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pspec", '.')
	end if
	
	sreff = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_esdat")
	if (isnull(sreff) or trim(sreff) = '') and &
		tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_purgc") = 'N' then
	elseif f_datechk(sreff) = -1 then
// hjp(050702)	임시로 풀어줌
//			 f_message_chk(35,'[생산시작일(외주인 경우 필수)]') 
//			 tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_esdat", '')
//			 scolumn = "momast_copy_esdat"
//			 RETURN -1
	end if
	
	sreff1 = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_eedat")	
	if (isnull(sreff1) or trim(sreff1) = '') and &
		tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_purgc") = 'N' then
	elseif f_datechk(sreff1) = -1 then
// hjp(050702)	임시로 풀어줌
//			 f_message_chk(35,'[생산종료일(외주인 경우 필수)]') 
//			 tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_eedat", '')
//			 scolumn = "momast_copy_eedat"			 
//			 RETURN -1
	end if
	
	if isnull(sreff1) or trim(sreff1) = '' then
	elseif sreff > sreff1 then
// hjp(050702)	임시로 풀어줌
//			f_message_chk(35,'[생산종료일]') 
//			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_esdat", '')
//			scolumn = "momast_copy_esdat"
//			RETURN -1
	end if
	
	if isnull(tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_ipchango")) or &
		trim(tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_ipchango")) = '' then
			f_message_chk(36,'[입고예정창고]') 
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_ipchango", '')
			scolumn = "momast_copy_ipchango"
			RETURN -1
	end if	
	
	// 외주인 경우 check
	if tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_purgc") = 'Y' then
		if tab_1.tabpage_2.dw_tabpage2.getitemdecimal(Lrow, "momast_copy_unprc") < 1 then
			f_message_chk(80,'[외주단가]') 
			scolumn = "momast_copy_unprc"
			RETURN -2
		end if	
	end if
	
	if 	tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "pagbn") = 'Y' then
		sreff = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pa_pordno")
		Select itnbr, pspec, pdsts into :sitnbr, :sispec, :sreff1 from momast
		 where sabu = :gs_sabu and pordno = :sreff;
		  
		if 	sqlca.sqlcode <> 0 then
			f_message_chk(77,'[작업지시번호]')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_pordno", '')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_ospeq", '')
			scolumn = "momast_copy_pa_pordno"
			return -2
		end if
		if sreff1 <> '1' and sreff1 <> '2' then
			f_message_chk(84,'[작업지시상태]')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_pordno", '')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_ospeq", '')
			scolumn = "momast_copy_pa_pordno"
			return -2
		end if
		if tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_itnbr") <> sitnbr or &
			tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pspec") <> sispec then
			f_message_chk(85,'[품목,사양]')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_pordno", '')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_ospeq", '')
			scolumn = "momast_copy_pa_pordno"
			return -2
		end if
		
		sitnbr = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_itnbr")
		sopseq = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pa_ospeq")
		// 분할할 공정이 실제로 존재하는지 CHECK
		setnull(sopdsc)
		Select opdsc into :sopdsc from morout
		 Where sabu = :gs_sabu And pordno = :sreff And opseq = :sopseq;		
		if isnull(sopdsc) then 
			scolumn = "momast_copy_pa_ospeq"		
			return -2
		end if		
		
		// 가용수량 check = (당공정합격 + 불량) - (후공정 정상실적 + 당공정 수리실적수량) 
		 select nvl(a.mqty, 0) - (nvl(b.preqty, 0) + nvl(c.suqty, 0))
 		   into :dgaqty
			from (select (b.coqty + b.faqty) as mqty
					  from momast a, morout b
					 where a.sabu = :gs_sabu and a.pordno = :sreff
						and a.pdsts in ('1','2')
						and a.sabu  = b.sabu     and a.pordno = b.pordno
						and b.opseq = :sopseq)a,
				  (select sum(roqty) as preqty
					  from shpact 
					 where sabu   = :gs_sabu
						and pordno = :sreff
						and opsno  = (select de_opseq 	 from morout
											where sabu   = :gs_sabu 
											  and pordno = :sreff
											  and opseq  = :sopseq )
						and sigbn  = '1' )b, 
				  (select sum(roqty) as suqty
					  from shpact 
					 where sabu   = :gs_sabu
						and pordno = :sreff
						and opsno  = :sopseq
						and sigbn  = '2' )c;  
						
		if dgaqty < tab_1.tabpage_2.dw_tabpage2.getitemdecimal(Lrow, "momast_copy_pdqty") then
			f_message_chk(88,'[분할가용수량]')
			scolumn = "momast_copy_pa_ospeq"
			return -1
		end if
		
	end if
	// -------------------------------- 작업지시 .. 품목 생산시작일 /생산 종료일 확인.
	integer nCnt =0
	Select count(*)  into :nCnt
	  from morout_copy 
	 where master_no = :is_sysno and pordno like :isPordno||'%'  and itnbr = :sItnbr 
	    and  ( fsdat is null);
	If	nCnt > 0 	then
// hjp(050702)	임시로 풀어줌
//		f_message_chk(35,'[생산시작일(1)]') 
//		scolumn = "momast_copy_itnbr"
//		RETURN -1
	End If
	// --------------------------------------------------------------------------------	
Next

return 1
end function

public function integer wf_requiredchk_bomrtn2 (long currlow, string sitnbr, ref string srtnbr, string spordno);// 일정 계산전 사용자 선택에 의한 Option Check

String	sDitnbr, sReff, sReff1, stimegu, spdtgu, sPorgu
Long Lrow, Lchk

tab_1.tabpage_2.dw_tabpage2.ACCEPTTEXT()

sPdtgu = tab_1.tabpage_1.dw_date.GetItemString(1, 'steam')
sPorgu = tab_1.tabpage_2.dw_tabpage2.getitemstring(currlow, 'momast_copy_porgu')

Lrow = d_pdt_02030_strerr.insertrow(0)

/* BOM이 있는 지 확인
	1. 지시품번에 하위부품이 있는지
	2. 표준품번에 하위부품이 있는지	*/
Long lcnt, Lcnt1, lcnt2
Lcnt = 0
Select count(*) Into :lcnt from pstruc
 Where pinbr = :sitnbr;
 
if Isnull(Lcnt) or Lcnt < 1 then
	Select stdnbr Into :sDitnbr From itemas
	 Where itnbr = :sItnbr;

	/* 대표품번에 대한 BOM 검색 */
	Lcnt = 0
	Select count(*) Into :lcnt from pstruc
	 Where pinbr = :sDitnbr;

	if tab_1.tabpage_2.dw_tabpage2.getitemstring(currlow, 'momast_copy_holdct') = 'Y' then
		if Isnull(Lcnt) or Lcnt < 1 then		 
			d_pdt_02030_strerr.setitem(Lrow, "err5", 2)
			dw_insert.setitem(Lrow, "momast_copy_holdct", 'N')
			// Bom 미등록시에도 진행가능하도록,단 정상작지가 아닌 경우
			If sPorgu = '12' Then
				bomcheck = true
			End If
		End if
	End if
	sRtnbr = sDitnbr
Else
	sRtnbr = sitnbr
end if

if isnull(sRtnbr) or trim(sRtnbr) = '' then sRtnbr = sitnbr

d_pdt_02030_strerr.setitem(Lrow, "itnbr", sitnbr)
d_pdt_02030_strerr.setitem(Lrow, "stdnbr", srtnbr)		 

// 표준공정을 선택하지 않은 경우에는 아래의 내역을 선택하지 않는다.
// 단 외주인 경우에는 check하지 않는다.
/*if tab_1.tabpage_2.dw_tabpage2.getitemstring(currlow, 'momast_copy_routct') = 'Y' then
	if tab_1.tabpage_2.dw_tabpage2.getitemstring(currlow, 'momast_copy_purgc') = 'N' then
		Lchk = 0
		Select count(*) into :Lchk
		  From morout_copy_none_copy 
		 where sabu = :gs_sabu and pordno = :spordno;
		if lchk = 0 then
			messagebox("표준공정", "표준공정을 먼저 작성하십시요[None]", stopsign!)		
			return -1
		end if;
	end if
end if */


// 시간계산을 하지 않는 경우에는 시간을 직접입력한다.
if tab_1.tabpage_2.dw_tabpage2.getitemstring(currlow, 'momast_copy_timect') = 'N' then
	if tab_1.tabpage_2.dw_tabpage2.getitemstring(currlow, 'momast_copy_purgc') = 'N' then	
		Lchk = 0
		Select sum(decode(esdat, null, 0, 1)) + sum(decode(eedat, null, 0, 1)) into :Lchk
		  From morout_copy_none_copy 
		 where sabu = :gs_sabu and pordno = :spordno;
		if lchk = 0 then
			messagebox("표준공정", "일정을 먼저 작성하십시요", stopsign!)		
			return -1
		end if;
	end if
end if

// 표준공정을 선택하지 않은 경우에는 아래의 내역을 선택하지 않는다.
if tab_1.tabpage_2.dw_tabpage2.getitemstring(currlow, 'momast_copy_routct') = 'N' then
	return 1
end if

/* 표준공정순서에 동시공정이 1개 이상인 경우 check */
lcnt = 0
Select count(*)
  into :lcnt
  from 
		(select itnbr, opseq, twocod
			from routng
		  where 
		     itnbr = :sRtnbr
			 and twocod is not null) a,
		routng b
 where  
    a.itnbr  = b.itnbr
	and a.twocod = b.opseq
	and b.twocod is not null;

if lcnt > 0 then
	d_pdt_02030_strerr.setitem(Lrow, "err1", 2)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true	
end if

/* 시간은 환경설정의 표준시간, 평균시간으로 한다 
   1: 표준시간, 2:평균시간 */
select dataname
  into :stimegu
  from syscnfg
 where sysgu = 'Y' and serial = '15' and lineno = '3';
 
if stimegu <>  '1' and stimegu <> '2' then
	sTimegu = '1'
end if

/* 표준공정에 시간이 없는지 check, 최초/최종공정이 1개이상인지 check 
   표준시간 check시 작업장마스터를 기준으로 
	시간구분 1 : Man H/R필수
	         2 : M/C H/R필수 
				3 또는 4 : Man + M/C 필수 */
Dec {2} dTotime

Lcnt 	= 0
Lcnt1 = 0	
Lcnt2 = 0	
Select Sum(Decode(:stimegu, '1', Decode(b.basic, '1', manhr,  '2', mchr,  '3', manhr  + mchr, 9), 0) +
		     Decode(:stimegu, '2', Decode(b.basic, '1', manhr1, '2', mchr1, '3', manhr1 + mchr1, 9), 0)),
		 Sum(decode(lastc, '1', 1, '9', 1, 0)),
		 Sum(decode(Lastc, '3', 1, '9', 1, 0)), count(*)
  into :dTotime, :lcnt, :Lcnt1, :Lcnt2
  from routng a, wrkctr b
 where 
    a.itnbr = :sRtnbr
 	and a.wkctr = b.wkctr;

if dTotime = 0 or sqlca.sqlcode <> 0 then
	d_pdt_02030_strerr.setitem(Lrow, "err2", 2)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true	
end if

if Lcnt > 1 then
	d_pdt_02030_strerr.setitem(Lrow, "err2", 3)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if	

if Lcnt1 > 1 then
	d_pdt_02030_strerr.setitem(Lrow, "err2", 4)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

if Lcnt2 = 0 then
	d_pdt_02030_strerr.setitem(Lrow, "err2", 5)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')	
	bomcheck = true		
end if

/* 최초공정이 동시공정인지 check하고 공정순서가 맞는지 check */
Setnull(sReff)
Setnull(sReff1)
select lastc, twocod into :sreff, :sreff1 From routng
 Where 
    itnbr = :sRtnbr 
	And opseq = (select Min(opseq) from routng where itnbr = :sRtnbr);
 
If sReff = '1' or sReff = '9' then
else
	d_pdt_02030_strerr.setitem(Lrow, "err3", 2)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

If isnull(sReff1) or trim(sReff1)  = '' then
Else
	d_pdt_02030_strerr.setitem(Lrow, "err3", 3)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

select lastc, twocod into :sreff, :sreff1 From routng
 Where 
    itnbr = :sRtnbr 
	And opseq = (select Max(opseq) from routng where itnbr = :sRtnbr);

If sReff = '3' or sReff = '9' then
else
	d_pdt_02030_strerr.setitem(Lrow, "err4", 2)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

If isnull(sReff1) or trim(sReff1)  = '' then
Else
	d_pdt_02030_strerr.setitem(Lrow, "err4", 3)
	dw_insert.setitem(Lrow, "momast_copy_routct", 'N')
	dw_insert.setitem(Lrow, "momast_copy_timect", 'N')
	bomcheck = true		
end if

return 0
end function

public subroutine wf_tabpage1_layout (long lrow);string sitnbr, sdate

if Lrow > 0 then
	sitnbr 	= tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "itnbr")
	isgyymm 	= tab_1.tabpage_1.dw_date.getitemstring(1, "gidate")
	iimoseq  = 0
//	Select Max(moseq)
//	  Into :iimoseq
//	  From Monpln_sum
//	 Where Sabu = :gs_sabu And monyymm = :isgyymm;
//	tab_1.tabpage_1.dw_layout1.retrieve(gs_sabu, sitnbr, isgyymm, iimoseq, is_seemonth)
	
	// 출하요청 내역 조회
	sdate 	= tab_1.tabpage_1.dw_date.getitemstring(1, "sdate")
	tab_1.tabpage_1.dw_layout1.retrieve(gs_sabu, sdate, sitnbr)
end if
end subroutine

public function integer wf_requiredchk_tabpage2 (ref string scolumn, ref long lrow);string   snull, sitnbr, sreff, sreff1, sitdsc, sispec, scvcod, sopseq, sDitnbr, sRtnbr, &
			sPorgu, scvnas, spordno, sopdsc, sjijil, sispec_code, sittyp
integer  ireturn
Decimal  {3} dunprc, dgaqty

w_mdi_frame.sle_msg.text = '자료를 검사중입니다.....!!'

setnull(snull)

For lrow = 1 to tab_1.tabpage_2.dw_tabpage2.rowcount()
	/* 작업지시구분 check */
	if isnull(f_get_reffer('60', tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_porgu"))) then
		f_message_chk(79,'[작업지시구분]') 
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_porgu", '') 
		scolumn = "momast_copy_porgu"
		RETURN  -1
	END IF
	sPorgu  = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_porgu")	
	sPordno = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pordno")		
	
	sItnbr = trim(tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_itnbr"))
	if isnull(sitnbr) or trim(sitnbr) = '' then	
		sitnbr ='X1'
	end if	
	ireturn = f_get_name4('품번', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code) 
	tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_itnbr", sitnbr)	
	tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "itemas_itdsc", sitdsc)	
	tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "itemas_ispec", sispec)
	tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "itemas_jijil", sjijil)	

	if ireturn = 1 then
		scolumn = "momast_copy_itnbr"
		RETURN -1
	end if
	
	if dec(tab_1.tabpage_2.dw_tabpage2.getitemdecimal(Lrow, "momast_copy_pdqty")) < 1 then
		scolumn = "momast_copy_pdqty"
		f_message_chk(78,'[지시수량]') 
		RETURN -1	
	end if

	select ittyp into :sittyp 
	  from itemas where itnbr = :sitnbr ;


//	if isnull(sreff) or trim(sreff) = '' then	
//		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pspec", '.')
//	end if

	sreff = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_esdat")
	if (isnull(sreff) or trim(sreff) = '') and &
		tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_purgc") = 'N' then
	elseif f_datechk(sreff) = -1 then
			 f_message_chk(35,'[생산시작일(외주인 경우 필수)]') 
			 tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_esdat", '')
			 scolumn = "momast_copy_esdat"
			 RETURN -1
	end if
	
	sreff1 = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_eedat")	
	if (isnull(sreff1) or trim(sreff1) = '') and &
		tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_purgc") = 'N' then
	elseif f_datechk(sreff1) = -1 then
			 f_message_chk(35,'[생산종료일(외주인 경우 필수)]') 
			 tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_eedat", '')
			 scolumn = "momast_copy_eedat"			 
			 RETURN -1
	end if
	
	if isnull(sreff1) or trim(sreff1) = '' then
	elseif sreff > sreff1 then
			f_message_chk(35,'[생산종료일]') 
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_esdat", '')
			scolumn = "momast_copy_esdat"
			RETURN -1
	end if
	
	if isnull(tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_ipchango")) or &
		trim(tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_ipchango")) = '' then
			f_message_chk(36,'[입고예정창고]') 
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_ipchango", '')
			scolumn = "momast_copy_ipchango"
			RETURN -1
	end if	
	
	if tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_purgc") = 'Y' then
	
		scvcod = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_cvcod")
		select cvnas into :scvnas from vndmst
		 where cvcod = :scvcod;
		 if sqlca.sqlcode <> 0 then
			 messagebox('외주거래처','외주거래처가 지정되지 않았읍니다.', stopsign!)
			 scolumn = "momast_copy_cvcod"			 
			 return -2
		end if
	end if
	
	if tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "pagbn") = 'Y' then
		sreff = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pa_pordno")
		Select itnbr, pspec, pdsts into :sitnbr, :sispec, :sreff1 from momast
		 where sabu = :gs_sabu and pordno = :sreff;
		  
		if sqlca.sqlcode <> 0 then
			f_message_chk(77,'[작업지시번호]')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_pordno", '')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_ospeq", '')
			scolumn = "momast_copy_pa_pordno"
			return -2
		end if
		if sreff1 <> '1' and sreff1 <> '2' then
			f_message_chk(84,'[작업지시상태]')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_pordno", '')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pa_ospeq", '')
			scolumn = "momast_copy_pa_pordno"
			return -2
		end if
		
		sitnbr = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_itnbr")
		sopseq = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pa_ospeq")
		
		// 분할할 공정이 실제로 존재하는지 CHECK
		setnull(sopdsc)
		Select opdsc into :sopdsc from morout
		 Where sabu = :gs_sabu And pordno = :sreff And opseq = :sopseq;		
		if isnull(sopdsc) then 
			scolumn = "momast_copy_pa_ospeq"		
			return -2
		end if
		
		// 가용수량 check = (당공정합격 + 불량) - (후공정 정상실적 + 당공정 수리실적수량) 
		 select nvl(a.mqty, 0) - (nvl(b.preqty, 0) + nvl(c.suqty, 0))
 		   into :dgaqty
			from (select (b.coqty + b.faqty) as mqty
					  from momast a, morout b
					 where a.sabu = :gs_sabu and a.pordno = :sreff
						and a.pdsts in ('1','2')
						and a.sabu  = b.sabu     and a.pordno = b.pordno
						and b.opseq = :sopseq)a,
				  (select sum(roqty) as preqty
					  from shpact 
					 where sabu   = :gs_sabu
						and pordno = :sreff
						and opsno  = (select de_opseq 	 from morout
											where sabu   = :gs_sabu 
											  and pordno = :sreff
											  and opseq  = :sopseq )
						and sigbn  = '1' )b, 
				  (select sum(roqty) as suqty
					  from shpact 
					 where sabu   = :gs_sabu
						and pordno = :sreff
						and opsno  = :sopseq
						and sigbn  = '2' )c;  
			  
		if dgaqty < tab_1.tabpage_2.dw_tabpage2.getitemdecimal(Lrow, "momast_copy_pdqty") then
			f_message_chk(88,'[분할가용수량]')
			scolumn = "momast_copy_pa_ospeq"
			return -1
		end if
		
		sitnbr  = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_itnbr")	
	end if
	
	// 재작업 및 테스트품은 검사하지 않는다
	If tab_1.tabpage_2.dw_tabpage2.getitemstring(lrow, "momast_copy_porgu") = '14' or tab_1.tabpage_2.dw_tabpage2.getitemstring(lrow, "momast_copy_porgu") = '20' Then
	Else	
		iReturn =  wf_requiredchk_bomrtn2(lrow, sitnbr, sRtnbr, spordno) 
		IF ireturn = -1 then
			scolumn = "momast_copy_itnbr"
			return -1
		Else
			tab_1.tabpage_2.dw_tabpage2.Setitem(Lrow, "momast_copy_stditnbr", sRtnbr)
		End if	 	
	End If
Next

return 1
end function

public function integer wf_requiredchk_tabpage31 (ref long lrow, ref string scolumn);string   snull, sitnbr, sreff, sreff1, sitdsc, sispec, scvcod, sopseq, spordno, stoday, spropseq, sdeopseq
integer  ireturn
Decimal  {5} dunprc
long lcnt, lfind, lnext

w_mdi_frame.sle_msg.text = "공정일정 내역을 검색중입니다......!!"

sToday = f_today()

tab_1.tabpage_3.dw_tabpage3_2.accepttext()

setnull(snull)
setnull(spropseq)
setnull(sdeopseq)

For 	lcnt = 1 to tab_1.tabpage_3.dw_tabpage3_2.rowcount()
		lrow = lcnt
	 	/* 생산시작일*/
		sreff = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_esdat")
		tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_fsdat", sreff)		
		if isnull(sreff) or trim(sreff) = '' or f_datechk(sreff) = -1 then
			f_message_chk(35,'[생산시작일(1)]') 
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_esdat", '')
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_fsdat", '')
			scolumn = "morout_copy_esdat"
			RETURN  -1
		end if
		
		/* 첫번째 공정의 생산시작일을 작업지시-head에 move */
		if lcnt = 1 then
			spordno = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_pordno")
			lfind   = tab_1.tabpage_3.dw_tabpage3_1.find("momast_copy_pordno = '"+ spordno +"'", 0, tab_1.tabpage_3.dw_tabpage3_1.rowcount())
			if lfind > 0 then
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lfind, "momast_copy_esdat", sreff)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lfind, "momast_copy_fsdat", sreff)
				tab_1.tabpage_2.dw_tabpage2.setitem(lfind, "momast_copy_esdat", sreff)
				tab_1.tabpage_2.dw_tabpage2.setitem(lfind, "momast_copy_fsdat", sreff)				
			end if				
		end if

		/* 생산종료일 */
		sreff1 = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_eedat")	
		tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_fedat", sreff1)
		if isnull(sreff1) or trim(sreff1) = '' or f_datechk(sreff1) = -1 then
			f_message_chk(35,'[생산종료일(2)]') 
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_eedat", '')
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_fedat", '')		
			scolumn = "morout_copy_eedat"			
			RETURN  -1			
		end if
		
		if sreff > sreff1 then
			f_message_chk(35,'[생산종료일(3)]') 
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_eedat", '')
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_fedat", '')
			scolumn = "morout_copy_eedat"
			RETURN  -1			
		end if
		
		/* 마지막 공정의 생산종료일을 작업지시-head에 move */
		if lcnt = tab_1.tabpage_3.dw_tabpage3_2.rowcount() then
			if lfind > 0 then
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lfind, "momast_copy_eedat", sreff1)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lfind, "momast_copy_fedat", sreff1)
				tab_1.tabpage_2.dw_tabpage2.setitem(lfind, "momast_copy_eedat", sreff1)
				tab_1.tabpage_2.dw_tabpage2.setitem(lfind, "momast_copy_fedat", sreff1)
			end if				
		end if				

		/* 작업장 */
		ireturn = 0
		sreff = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_wkctr")
		select a.wkctr, a.wcdsc, b.jocod, b.jonam
		  into :sitnbr, :sreff, :sitdsc, :sispec
		  from wrkctr a, jomast b
		 where a.wkctr = :sreff and a.jocod = b.jocod (+);
		if sqlca.sqlcode <> 0 then
			f_message_chk(90,'[작업장]')
			setnull(sreff)		
			setnull(sitnbr)
			setnull(sitdsc)
			setnull(sispec)
			ireturn = -1
		end if
	if not isnull(sreff)  and isnull(sitdsc) then
			f_message_chk(91,'[조]')
			setnull(sreff)
			setnull(sitnbr)
			setnull(sitdsc)
			setnull(sispec)
			ireturn = -1
		end if
		tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_wkctr", sitnbr)
		tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "wrkctr_wcdsc", sreff)
		tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_jocod", sitdsc)
		tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "jomast_jonam", sispec)
		if ireturn = -1 then
			scolumn = "morout_copy_wkctr"
			return -1
		end if
		
		/* 설비 */
		ireturn = 0
		sreff = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_mchcod")
		if not isnull(sreff) then
			select mchnam
			  into :sreff1
			  from mchmst
			 where sabu = :gs_sabu and mchno = :sreff;
			if sqlca.sqlcode <> 0 then
				f_message_chk(92,'[설비]')
				setnull(sreff)
				setnull(sreff1)		
				ireturn = -1
			end if
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "mchmst_mchnam", sreff1)
			if ireturn = -1 then
				scolumn = "morout_copy_mchcod"
				return -1
			end if
		end if
		/* 외주유무 */
		sreff = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_purgc")
		sopseq = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_opseq")		
		if sreff = 'Y' then
			Setnull(sCvcod)
			scvcod = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_wicvcod")
			ireturn = f_get_name2('V1', 'N', scvcod, sitdsc, sispec)    //1이면 실패, 0이 성공	
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_wicvcod", scvcod)	
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "vndmst_cvnas2",  sitdsc)
			if ireturn  = 1 then
				f_message_chk(30,'[외주거래처]')
				scolumn = "morout_copy_wicvcod"
				RETURN -1
			end if
		
		end if
		
		/* 작업예상시간 */
      dunprc = tab_1.tabpage_3.dw_tabpage3_2.getitemdecimal(lcnt, "morout_copy_estim")
		if dunprc < 0 then
			f_message_chk(93,'[작업예상시간]') 
			scolumn = "morout_copy_estim"
			RETURN  -1
		end if
		
		/* 전공정 및 후공정에 대한 정리 작업 
			단 후공정은 동시공정인 경우에는 작성하지 않는다.	*/
		if IsNull( spropseq )  then
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_pr_opseq", '0000')
		Else
			tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_pr_opseq", spropseq)
		End if
		spropseq = sopseq
		
		if IsNull (tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt, "morout_copy_do_opseq")) then
			if lcnt < tab_1.tabpage_3.dw_tabpage3_2.rowcount()  then
				tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_de_opseq", tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lcnt + 1, "morout_copy_opseq"))
			Else
				tab_1.tabpage_3.dw_tabpage3_2.setitem(lcnt, "morout_copy_de_opseq", snull)
			end if
		end if
		
Next

if tab_1.tabpage_3.dw_tabpage3_2.update() = 1 then
	commit;
Else
	Rollback;
	return -1
end if

return 1
end function

public function integer wf_reset ();rollback;

String sToday , sCode

stoday = f_today()
w_mdi_frame.sle_msg.text = ''

/* tabpage를 disable */
tab_1.tabpage_2.enabled = false
tab_1.tabpage_3.enabled = false

/* datawindow clear */
tab_1.tabpage_1.dw_plnlist.settransobject(sqlca)	// 연동계획 검토화면
tab_1.tabpage_1.dw_date.settransobject(sqlca)		// 연동계획 선택화면
tab_1.tabpage_2.dw_tabpage2.settransobject(sqlca)	// 품목우선순위 선택화면

tab_1.tabpage_2.dw_tabpage2.Reset()
tab_1.tabpage_3.dw_etc.Reset()

tab_1.tabpage_2.p_jaje.enabled = false						
tab_1.tabpage_2.p_jaje.PictureName = "..\image\소요자재_d.gif"				// 작업지시button
tab_1.tabpage_2.p_last.enabled = false						
tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"				// 작업지시button

/* 연동계획 선택화면을 기본으로 설정 */
tab_1.tabpage_1.enabled = True
tab_1.selecttab(1);
tab_1.tabpage_1.dw_date.setfocus()

ib_any_typing = false

/* 반제품 창고 검색 */
//sCode 	= wf_DepotNo('2', '2')	// 반제품창고를 둘경우
sCode 	= wf_DepotNo('2', '1')	// 반제품을 생산창고로 잡을경우
dw_ban.setitem(1, "ban_code", sCode)

/* 자제 창고 검색 */
//sCode 	= wf_DepotNo('3', '')	// 자재창고에서 출고요청할경우
sCode 	= wf_DepotNo('2', '1')	// 자재창고가 없이 자재가 생산창고로 입고될 경우
dw_jaje.setitem(1, "jaje_code", sCode)

return 1
end function

public function integer wf_treeview_retrieve ();

return 1
end function

public function integer wf_treeview_retrieve2 ();
return 1
end function

public function integer wf_treeview_retrieve1 ();
return 1
end function

public function integer wf_requiredchk_tabpage1 ();String  swanch, sbanch, stoday, ntoday, schk, sgubun, ls_saupj, sitnbr, spdtgu, sitgu, sittyp, snapgi
String  sitcls, sporgu, srtnbr, scvcod, stuncu, sordgbn, ls_pspec, scvnas, sjasacode, sMasterNo
String  sjdate, ssdate, sedate
Integer ii, nn, k, ireturn
Long    lrow, lopt, Linsrow
Dec{3}  dpdqty, doptqty, dmod
Dec{5}  dpdprc, dunprc

If tab_1.tabpage_1.dw_date.AcceptTExt() <> 1 Then Return -1

/* -------------------------------------------------------------------------------------------------------------- */
/*  자료선택구분(1:연동계획, 2:작업예정, 3:수주자료, 4:개발의뢰자료, 5:금형치공구, 7:샘플의뢰, 9:주간계획) , A :재작업 */
/* -------------------------------------------------------------------------------------------------------------- */

// 기초정보 체크
sPdtgu = tab_1.tabpage_1.dw_date.getitemstring(1, "steam")
If isnull(sPdtgu) or Trim(sPdtgu) = '' then
	f_message_chk(309, '[생산팀구분]')
	return -1
end if

/* 창고는 완제품, 반제품인 경우 첫번째 창고를 선택한다 */
ls_saupj	= dw_saupj.GetItemString(1,"saupj")
Select Min(cvcod) Into :sWanch from Vndmst where cvgu = '5' and juprod = '1' and ipjogun = :ls_saupj;
//Select Min(cvcod) Into :sBanch from Vndmst where cvgu = '5' and juprod = '2' and jumaeip = :spdtgu and ipjogun = :ls_saupj; // 반제품창고
Select Min(cvcod) Into :sBanch from Vndmst where cvgu = '5' and juprod = '2' and jumaechul = '1' and jumaeip = :spdtgu and ipjogun = :ls_saupj; // 생산창고

/* 작업지시번호 채번(Visual) */
IF ls_auto = 'N' THEN 
	stoday = trim(sle_bal.text)
	IF stoday = '' or isnull(stoday) THEN 
		MessageBox("확 인", "생성할 작업지시번호를 입력하세요!") 
		sle_bal.setfocus()
		return 0
	END IF
ELSE
	//stoday = f_today()
	stoday   = tab_1.tabpage_1.dw_date.getitemstring(1, "jdate")
END IF

// 마스타작지번호를 입력한 경우에는 기존내역을 조회한다
sMasterNo = Trim(tab_1.tabpage_1.dw_date.GetItemString(1, 'master_no'))
If IsNull(sMasterNo) Or sMasterNo = '' Then
	// 화면상에 보이는 작업지시번호 채번
	ii = sqlca.fun_junpyo(gs_sabu, stoday, 'N0')
	if ii < 1 then
		f_message_chk(51,'[작업지시번호]') 
		rollback;
		return -1
	end if
	Commit;
	ispordno = stoday + String(ii, '0000')		// 신규추가용 품목별 작업지시번호

	// 작업지시 기준번호 채번(모든 계산단위는 작업지시 기준번호를 기준으로 한다)
	ntoday = f_today()
	Nn = sqlca.fun_junpyo(gs_sabu, nToday, 'N3')
	if Nn < 1 then
		f_message_chk(51,'[작업지시 기준번호]') 
		rollback;
		return -1
	end if
	
	is_sysno = nToday + String(Nn, '0000')		// master_no임
Else
	is_sysno = sMasterNo
	ispordno = sMasterNo
End If

/* 자료 저장용 datawindow clear */
dw_insert.reset()
tab_1.tabpage_1.dw_plnlist.accepttext()
	 
/* 개별 품목으로 작업지시 하는 경우 */
For Lrow = 1 to tab_1.tabpage_1.dw_plnlist.rowcount()
	 sChk     = tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "gubun")
	 if schk = 'N' then continue
	 
	 sGubun	 = tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "crt")	// 계획구분(1:월,7:샘플)
	 
	 dPdqty	 = tab_1.tabpage_1.dw_plnlist.getitemdecimal(Lrow, "monqty") 	//지시수
	 if sGubun = '2' or sGubun = '3' then
		 dOptqty	 = tab_1.tabpage_1.dw_plnlist.getitemdecimal(Lrow, "opt") 	//분할수
		 if isnull(dOptqty) or dOptqty <= 0 or dOptqty > dPdqty  then  dOptqty = dPdqty
		 
		 lOpt = dPdqty / dOptqty
		 dMod = Mod(dPdqty, dOptqty)
		 
		 if dMod > 0 then   //나머지가 있으면 한번 더 count
			 lOpt = lOpt + 1
		 else               //나머지가 없으면 마지막에 dmod 값 move
			 dMod = dOptqty
		 end if
	 else
		 lOpt     = 1
		 doptqty  = dPdqty
		 dMod     = dPdqty
	 end if

	 sItnbr = tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "itnbr")

	 /* 품목마스터의 구입/생산형태를 기준으로 작성 */
	 Setnull(sItgu)
	 Setnull(sIttyp)
	 Setnull(sItcls)
	 Setnull(sporgu)
	 
	 Select a.itgu, a.ittyp, a.itcls	   Into :sItgu, :sIttyp, :sitcls
		From itemas a	  Where a.itnbr = :sItnbr ;

	/* 주간계획에서 읽어올 경우 가상작지로 셋팅 */
	Choose Case sGubun
		Case '7'		// 샘플
			sporgu = '50'
		Case '9'		// 주간계획
			sporgu = '90'	// 가상
		Case 'A'		// 재작업
			sporgu = '14'
		Case Else
			sporgu = '12'	// 정상
	End Choose
	  
	 // 작업지시에 필요한 기초자료 check
	 iReturn =  wf_requiredchk_bomrtn(sitnbr, sRtnbr) 	
	 
	 dPdprc  =	sqlca.fun_erp100000012(stoday, sitnbr, '.')		
		 
	 FOR k = 1 TO lopt
		 /* 작업지시를 임시로 생성 */
		 Linsrow = dw_insert.insertrow(0)
		 dw_insert.setitem(Linsrow, "momast_copy_sabu",   gs_sabu)
		 dw_insert.setitem(Linsrow, "momast_copy_pordno", iSpordno + String(Linsrow, '000') + '0')
		 dw_insert.setitem(Linsrow, "momast_copy_jidat",  tab_1.tabpage_1.dw_date.getitemstring(1, "jdate"))
		 
		 dw_insert.setitem(Linsrow, "momast_copy_itnbr", sItnbr)
		 dw_insert.setitem(Linsrow, "momast_copy_pspec",  '.')	// 기본사양을 저장
		 
		 dw_insert.setitem(Linsrow, "momast_copy_pdtgu", sPdtgu )
		 if k > 1 and k = lopt then  
			 dw_insert.setitem(Linsrow, "momast_copy_pdqty", dMod)
		 else
			 dw_insert.setitem(Linsrow, "momast_copy_pdqty", doptqty)
			 dw_insert.setitem(Linsrow, "momast_copy_pdmqty", wf_convert_qty(sItnbr, doptqty, 'Q'))
		 end if
		 dw_insert.setitem(Linsrow, "momast_copy_pdsts", '1')

		dw_insert.setitem(Linsrow, "momast_copy_matchk", '2')
	
		 dw_insert.setitem(Linsrow, "momast_copy_stditnbr", sRtnbr)

		 //품목분류 대분류에 의해 작업지시구분을 선택
		 dw_insert.setitem(Linsrow, "momast_copy_porgu", sPorgu)

		 If sItgu = '6' then		// 외주인 경우 
			 dw_insert.setitem(Linsrow, "momast_copy_purgc",  'Y')	
			 Setnull(sCvcod)
			 f_buy_unprc(sItnbr, ls_pspec, '9999', sCvcod, sCvnas, dUnprc, sTuncu)
			 If isnull(sCvcod) or trim(sCvcod) = '' then
				select dataname
				  into :sJasacode
				  from syscnfg
				 where sysgu = 'C' and serial = '4' and lineno = '1';			 
				 
				 d_pdt_02030_strerr.setitem(LInsrow, "err6", 2)
				 
				 sCvcod = sJasaCode
				 dUnprc = 0
			 End if
			 dw_insert.setitem(Linsrow, "momast_copy_cvcod",  sCvcod)
			 dw_insert.setitem(Linsrow, "momast_copy_unprc",  dUnprc)
		 Else
			 dw_insert.setitem(Linsrow, "momast_copy_purgc",  'N')
		 End if
	 
		 If sIttyp = '1' Or sIttyp = '8' then
			 dw_insert.Setitem(Linsrow, "momast_copy_ipchango", sWanch)
		 Else
			 dw_insert.Setitem(Linsrow, "momast_copy_ipchango", sBanch)
		 End if
		 
		 /* 생산실적 작성용 단가 산출 */
		 dw_insert.setitem(Linsrow, "momast_copy_pdprc", dPdprc)
		 
		 // 수주건별로 작업지시인 경우 수주번호를 넣어준다.
		 if sOrdgbn = 'Y' then
			 dw_insert.setitem(Linsrow, "momast_copy_order_no",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "order_no"))
			 sNapgi =   tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "cust_napgi")
			 if not (isnull(sNapgi) or sNapgi < stoday) then
//				 dw_insert.setitem(Linsrow, "momast_copy_eedat",  sNapgi  )
			 end if
		 // 계획자료인 경우 계획일자를 종료일자로 셋팅한다
		 elseif sGubun = '1' then
			 sNapgi =   tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "plndat")
			 if not (isnull(sNapgi) or sNapgi < stoday) then
//				 dw_insert.setitem(Linsrow, "momast_copy_eedat",  sNapgi  )
			else
//				dw_insert.setitem(Linsrow, "momast_copy_eedat",  stoday  )
			 end if
		 // 4:개발의뢰자료, 5:금형/치공구, 7:A/S, 8:크레임
		 // 개발의뢰인 경우에는 개발의뢰 내역을 저장한다.
		 elseif sGubun = '4' then
			 dw_insert.setitem(Linsrow, "momast_copy_reqno",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "reqno"))
			 dw_insert.setitem(Linsrow, "momast_copy_reqate", tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "cfdate"))
//			 dw_insert.setitem(Linsrow, "momast_copy_eedat", tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "wadat"))
			 dw_insert.setitem(Linsrow, "momast_copy_fedat", tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "wadat"))
			 dw_insert.setitem(Linsrow, "momast_copy_pdprc",  tab_1.tabpage_1.dw_plnlist.getitemdecimal(Lrow, "unprc"))
			 if Not IsNull(tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "ipchango")) then
				 dw_insert.setitem(Linsrow, "momast_copy_ipchango", tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "ipchango"))
			 end if
			 dw_insert.setitem(Linsrow, "momast_copy_mogubn",  '4') // 작업지시 구분 : 개발의뢰
		 // 금형/치공구인 경우에는 제작의뢰 내역을 저장한다.
		 Elseif sGubun = '5' then
			 dw_insert.setitem(Linsrow, "momast_copy_kumno",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "kumno"))
			 dw_insert.setitem(Linsrow, "momast_copy_untno",   tab_1.tabpage_1.dw_plnlist.getitemdecimal(Lrow, "untno"))
			 dw_insert.setitem(Linsrow, "momast_copy_kestno", tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "reqno"))
//			 dw_insert.setitem(Linsrow, "momast_copy_eedat",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "wadat"))
			 dw_insert.setitem(Linsrow, "momast_copy_fedat",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "wadat"))
			 dw_insert.setitem(Linsrow, "momast_copy_pdprc",  tab_1.tabpage_1.dw_plnlist.getitemdecimal(Lrow, "unprc"))
			 dw_insert.setitem(Linsrow, "momast_copy_mogubn",  '5') // 작업지시 구분
		 elseif sGubun = '7' then
			 dw_insert.setitem(Linsrow, "momast_copy_reqno",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "as_jpno"))
			 dw_insert.setitem(Linsrow, "momast_copy_asseq",  tab_1.tabpage_1.dw_plnlist.getitemNumber(Lrow, "asseq"))
			 dw_insert.setitem(Linsrow, "momast_copy_reqate", tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "cfdate"))
			 dw_insert.setitem(Linsrow, "momast_copy_mogubn",  '7') // 작업지시 구분 : 샘플의뢰
		 elseif sGubun = '8' then
			 dw_insert.setitem(Linsrow, "momast_copy_reqno",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "clamst_cl_jpno"))
			 dw_insert.setitem(Linsrow, "momast_copy_reqate", tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "cfdate"))
			 dw_insert.setitem(Linsrow, "momast_copy_mogubn",  '8') // 작업지시 구분 : 크레임
		 /* 구분이 주간계획인 경우에는 작지번호는 기존 작지번호를 사용한다 (가상임)*/
		 elseif sGubun = '9' then
			dw_insert.setitem(Linsrow, "momast_copy_pordno",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "as_jpno"))
			dw_insert.setitem(Linsrow, "momast_copy_mogubn",  '9') // 작업지시 구분 : 주간계획
			dw_insert.setitem(Linsrow, "momast_copy_holdct",  'N')	// 기존계획은 할당을 하지 않는다
		 /* 재작업 */
		 elseif sGubun = 'A' then
			dw_insert.setitem(Linsrow, "momast_copy_project_no",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "as_jpno"))
			dw_insert.setitem(Linsrow, "momast_copy_mogubn",  '1') // 작업지시 구분 : 제조(생산입고 전표 생성을 위해)
			dw_insert.setitem(Linsrow, "momast_copy_holdct",  'Y')	// 기존계획은 할당을 하지 않는다
		 End if	
		 
		/* 작업시작일자는 주간계획 기준일자로 작성 */
		//dw_insert.setitem(Linsrow, "momast_copy_esdat",  tab_1.tabpage_1.dw_date.getitemstring(1, "jdate"))
		dw_insert.setitem(Linsrow, "momast_copy_esdat",  tab_1.tabpage_1.dw_plnlist.getitemstring(Lrow, "plndat"))
		
		/* 작업지시 기준번호 작성 */
		dw_insert.setitem(Linsrow, "momast_copy_master_no", is_sysno)
		dw_insert.setitem(Linsrow, "momast_copy_mocnt",  String(Linsrow, '00'))
	NEXT
Next

// 헤더정보 생성
If IsNull(sMasterNo) Or sMasterNo = '' Then
	sjdate	= tab_1.tabpage_1.dw_date.getitemstring(1, "jdate")
	ssdate	= tab_1.tabpage_1.dw_date.getitemstring(1, "sdate")
	sedate	= tab_1.tabpage_1.dw_date.getitemstring(1, "edate")
	
	insert into momast_head_copy
		    ( SABU,     MASTER_NO, PDTGU,   JDATE,   SDATE,   EDATE, STATUS, CRT_DATE, CRT_USER )
	 values( :gs_sabu, :is_sysno, :sPdtgu, :sjdate, :ssdate, :sedate, '1',  :ntoday,  :gs_userid );
	 
	 If SQLCA.SQLCODE <> 0 Then
		MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
		RollBack;
		Return -1
	End If
End If

if dw_insert.update() =  1 then
	commit;
Else
	Rollback;
	messagebox("작지","작지작성시 Error(wf_requiredchk_tabpage)")	
	return -1
end if

return 1

end function

public function string wf_depotno (string oversea_gu, string sjumaechul);string  sSaupj, sdepotNo, sPdtgu

If	IsNull(oversea_gu) Or oversea_gu = '' Then Return ''

sSaupj 	= dw_saupj.GetItemString(1, "saupj")
sPdtgu	= tab_1.tabpage_1.dw_date.GetItemString(1, 'steam')

if	sSaupj	=  '%'	then
	sSaupj	=  gs_saupj
End If 

If	isnull(sJumaechul) or sJumaechul = "" then
	select min(cvcod )
	  into :sDepotNo
	  from vndmst
	 where cvgu = '5' and
			 juprod = :oversea_gu and                               // 1:  완제품 , 2: 반제품, 3:원자재
			 ipjogun = :sSaupj ;
else	
	select min(cvcod )
	  into :sDepotNo
	  from vndmst
	 where cvgu = '5' and
			 juprod       = :oversea_gu and                        // 1:  완제품 , 2: 반제품, 3:원자재
			 jumaechul 	  = :sJumaechul and                        // 1: 생산, 2:일반
			 jumaeip      = :sPdtgu and                            // 생산팀
			 ipjogun      = :sSaupj;
End if	

If IsNull(sDepotNo) Then 
	f_message_chk(1400,'[창고]')
	sDepotNo = ''
End If

Return sDepotNo

end function

public subroutine wf_item_check (long arg_row, string arg_itnbr, string arg_spspec, string arg_opseq);/* 품목마스터를 check하여 외주(구입형태 = '6')인 경우에는 작업지시를 기본으로 setting */
String sitgu, spurgc, sittyp, sipchango, snull, sDitnbr, srtnbr , swkctr, swcdsc
String ls_saupj, sunmsr, sPdtgu

Select itgu, ittyp, unmsr into :sitgu, :sittyp, :sunmsr
  from itemas 
 where itnbr = :arg_itnbr;
 
/* 외주인 경우 외주로 setting */
if sitgu 	= '6' then
	spurgc	= 'Y'
else
	spurgc	= 'N'
end if

ls_saupj	= dw_saupj.GetItemString(1,"saupj")
sPdtgu   = tab_1.tabpage_1.dw_date.GetItemString(1, 'steam')

Setnull(snull)

/* 거래처및 계약단가를 생성 */
String scvcod, sTuncu, scvnas
decimal {3} dUnprc

if spurgc = 'Y' then
	f_buy_unprc(arg_itnbr, arg_spspec, arg_opseq, scvcod, scvnas, dUnprc, sTuncu)
	tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_cvcod",  scvcod)
	tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "vndmst_cvnas2", scvnas)
	tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_unprc",  dUnprc)	
	tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_routct",  'N')	
	
	tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_cvcod",  scvcod)
	tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "vndmst_cvnas2", scvnas)
	tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_unprc",  dUnprc)	
	tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_routct",  'N')
Else
	tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_cvcod",  snull)
	tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "vndmst_cvnas2", snull)
	tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_unprc",  0)	
	tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_routct",  'Y')		
	
	tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_cvcod",  snull)
	tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "vndmst_cvnas2", snull)
	tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_unprc",  0)		
	tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_routct",  'Y')	
end if

tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "itemas_unmsr", sunmsr)
tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_purgc", spurgc)
tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_purgc", spurgc)

tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_pdprc", sqlca.fun_erp100000012(f_today(), arg_itnbr, '.'))	/* 생산기본단가 산출 */
tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_pdprc", sqlca.fun_erp100000012(f_today(), arg_itnbr, '.'))

/* 창고를 기본으로 SETTING하고 사용자가 수정 */
/* 창고는 완제품, 반제품인 경우 첫번째 창고를 선택한다 */
if sIttyp = '1' Or sIttyp = '8' then
	Select Min(cvcod) Into :sIpchango from Vndmst where cvgu = '5' and juprod = '1' and ipjogun = :ls_saupj ;
elseif sittyp = '2'  then
//	Select Min(cvcod) Into :sIpchango from Vndmst where cvgu = '5' and juprod = '2' and jumaechul = '2' and jumaeip = :sPdtgu; // 반제품창고
	Select Min(cvcod) Into :sIpchango from Vndmst where cvgu = '5' and juprod = '2' and jumaechul = '1' and jumaeip = :sPdtgu; // 생산창고
end if
tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_ipchango", sIpchango)
tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_ipchango", sIpchango)


Long lcnt
Lcnt = 0
Select count(*) Into :lcnt from pstruc
 Where pinbr = :arg_itnbr;
 
if Isnull(Lcnt) or Lcnt < 1 then
	Select stdnbr Into :sDitnbr From itemas
	 Where itnbr = :arg_Itnbr;

	/* 대표품번에 대한 BOM 검색 */
	Lcnt = 0
	Select count(*) Into :lcnt from pstruc
	 Where pinbr = :sDitnbr;
	sRtnbr = sDitnbr
Else
	sRtnbr = arg_itnbr
end if

if isnull(sRtnbr) or trim(sRtnbr) = '' then sRtnbr = arg_itnbr

tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "momast_copy_stditnbr", arg_itnbr)
tab_1.tabpage_3.dw_tabpage3_1.setitem(arg_row, "momast_copy_stditnbr", arg_itnbr)

// 대표작업장
select fun_get_wkctr_lrout(:arg_itnbr) into :swkctr from dual;
select wcdsc into :swcdsc from wrkctr where wkctr = :swkctr;
tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "wrkctr_wkctr", swkctr)
tab_1.tabpage_2.dw_tabpage2.setitem(arg_row, "wrkctr_wcdsc", swcdsc)
end subroutine

public function integer wf_stock_link (string arg_gubun, long arg_row);Long nRow, nFind, ix
String sPordno, sItnbr, sJidat
Dec    dValid, dPdqty

nFind = tab_1.tabpage_2.dw_tabpage2.GetSelectedRow(0)
If nFind <= 0 Then Return -1

sPordno = tab_1.tabpage_2.dw_tabpage2.GetItemString(nfind, 'momast_copy_pordno')	// 상위작지

If arg_gubun = 'I' Then	
	For ix = 1 To tab_1.tabpage_2.dw_stock.RowCount()
		If tab_1.tabpage_2.dw_stock.GetItemSTring(ix, 'chk') = 'N' Then Continue
		
		dValid = tab_1.tabpage_2.dw_stock.GetItemNumber(ix, 'choice_qty')
		If dValid <= 0 Then Continue
		
//		If dValid <= 0 Then
//			f_message_chk(76,'')
//			Return -1
//		End If
		
		nRow = tab_1.tabpage_2.dw_link.InsertRow(0)
		
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'sabu',gs_sabu)
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'pordno',sPordno)
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'child_pordno',tab_1.tabpage_2.dw_stock.GetItemString(ix, 'stock_copy_pordno'))
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'gubun',tab_1.tabpage_2.dw_stock.GetItemString(ix, 'stock_copy_gubun'))
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'depot_no',tab_1.tabpage_2.dw_stock.GetItemString(ix, 'stock_copy_depot_no'))
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'itnbr',tab_1.tabpage_2.dw_stock.GetItemString(ix, 'stock_copy_itnbr'))
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'pspec',tab_1.tabpage_2.dw_stock.GetItemString(ix, 'stock_copy_pspec'))
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'hold_qty',tab_1.tabpage_2.dw_stock.GetItemNumber(ix, 'choice_qty'))
		tab_1.tabpage_2.dw_link.SetItem(nRow, 'master_no',is_sysno)
	Next
Else
	tab_1.tabpage_2.dw_link.DeleteRow(arg_row)
End If

If tab_1.tabpage_2.dw_link.Update() <> 1 Then
	MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
	RollBack;
	Return -1
End If

COMMIT;

sItnbr = tab_1.tabpage_2.dw_tabpage2.GetItemString(nFind, 'momast_copy_itnbr')
sJidat = tab_1.tabpage_2.dw_tabpage2.GetItemString(nFind, 'momast_copy_jidat')
dPdqty = tab_1.tabpage_2.dw_tabpage2.GetItemNumber(nFind, 'momast_copy_pdqty')

tab_1.tabpage_2.dw_stock.Retrieve(gs_sabu, is_sysno, sItnbr, sJidat, dPdqty)
		
return 1
end function

public function integer wf_calc_time (long ar_row, string ar_gub);String sfsdat, sfstim, sfedat, sfetim, sStrTime, sEndTime
Dec    stime
Long   ix, iy, nFind

If tab_1.tabpage_3.dw_tabpage3_2.AcceptText() <> 1 Then Return -1
If tab_1.tabpage_3.dw_etc.AcceptText() <> 1 Then Return -1

// 기타일정 정렬
tab_1.tabpage_3.dw_etc.SetSort("fsdat, fstim")
tab_1.tabpage_3.dw_etc.Sort()

// 시작시간 조정시
if ar_gub = '1' then
	
	wf_calc_time2(ar_row, ar_gub)

	// 기타일정 감안
	For iy = 1 To tab_1.tabpage_3.dw_etc.RowCount()
		// 시작시간
		sfsdat = tab_1.tabpage_3.dw_etc.GetItemString(iy, 'fsdat')
		sfstim = tab_1.tabpage_3.dw_etc.GetItemString(iy, 'fstim')
		sStrTime = sfsdat+sfstim
		
		sfedat = tab_1.tabpage_3.dw_etc.GetItemString(iy, 'fedat')
		sfetim = tab_1.tabpage_3.dw_etc.GetItemString(iy, 'fetim')
		sEndTime = sfedat+sfetim
		
		nFind = tab_1.tabpage_3.dw_tabpage3_2.Find("morout_copy_fsdat+morout_copy_fstim <= '" +sStrTime + "' and morout_copy_fedat+morout_copy_fetim > '" + sStrTime + "'" , &
		        1 ,tab_1.tabpage_3.dw_tabpage3_2.RowCount())
		If nFind <= 0 Then
			nFind = tab_1.tabpage_3.dw_tabpage3_2.Find("morout_copy_fsdat+morout_copy_fstim < '" +sEndTime + "' and morout_copy_fedat+morout_copy_fetim >= '" + sEndTime + "'" , &
					  1 ,tab_1.tabpage_3.dw_tabpage3_2.RowCount())
		End If
		
		If nFind > 0 Then
			tab_1.tabpage_3.dw_tabpage3_2.SetItem(nFind, 'morout_copy_fsdat', sfedat)
			tab_1.tabpage_3.dw_tabpage3_2.SetItem(nFind, 'morout_copy_esdat', sfedat)
			tab_1.tabpage_3.dw_tabpage3_2.SetItem(nFind, 'morout_copy_fstim', sfetim)
			
			wf_calc_time2(nFind, ar_gub)
		End If
	Next
end if

Return 1

end function

public function integer wf_calc_time2 (long ar_row, string ar_gub);String sfsdat, sfstim, sfedat, sfetim, sStrTime, sEndTime, sWanTime, s1, s2
Dec    stime, sWan, dhubuha
Long   ix, iy, nFind

// 시작시간 조정시
// JOB CHANGE시간은 작업시간에 포함하지 않고 다음작업의 시작시간에 감안한다.
if ar_gub = '1' then
	ix = ar_row
	
	sEndTime = ''
	Do while ( ix <= tab_1.tabpage_3.dw_tabpage3_2.RowCount())
		// 작업시간
		sTime = tab_1.tabpage_3.dw_tabpage3_2.GetItemNumber(ix, 'calc_estim') + &
				  tab_1.tabpage_3.dw_tabpage3_2.GetItemNumber(ix, 'morout_copy_esset')

		// Job Change를 감안한 시간
		sWan  = tab_1.tabpage_3.dw_tabpage3_2.GetItemNumber(ix, 'calc_estim') + &
				  tab_1.tabpage_3.dw_tabpage3_2.GetItemNumber(ix, 'morout_copy_esset') + &
				  tab_1.tabpage_3.dw_tabpage3_2.GetItemNumber(ix, 'morout_copy_stdmn')

		// 시작시간
		sfsdat = tab_1.tabpage_3.dw_tabpage3_2.GetItemString(ix, 'morout_copy_fsdat')
		sfstim = tab_1.tabpage_3.dw_tabpage3_2.GetItemString(ix, 'morout_copy_fstim')
		sStrTime = sfsdat+sfstim
				
		// 종료시간
		If sEndTime = '' Then
			sfedat = sfsdat
			sfetim = sfstim
			sEndtime = sStrTime
			
			sWanTime = sStrTime
		End If
		
		// 시작시간이 앞공정의 종료시간보다 클경우
		sfsdat = left(sWanTime,8)
		sfstim = right(sWanTime,4)
		sStrTime = sWanTime

		// 종료시간 계산
		select to_char(to_date(:sStrTime,'yyyymmddhh24mi') + :sTime/1440 , 'yyyymmddhh24mi') into :sEndTime from dual;
		select to_char(to_date(:sStrTime,'yyyymmddhh24mi') + :sWan /1440 , 'yyyymmddhh24mi') into :sWanTime from dual;

		sfedat = left(sEndTime,8)
		sfetim = right(sEndTime,4)
		
		// 휴식시간 감안하여 종료시간을 다시계산한다
		dhubuha = 0
		s1 = right(sStrTime,4)
		s2 = right(sEndTime,4)
		select sum(to_number(dataname)) into :dhubuha from syscnfg 
		 where sysgu = 'Y' and serial = 28 and lineno <> '00' 
		   and titlename >= :s1 and titlename < :s2;
		If dhubuha > 0 Then
			sTime = sTime + dhubuha
			sWan  = sWan  + dhubuha

			select to_char(to_date(:sStrTime,'yyyymmddhh24mi') + :sTime/1440 , 'yyyymmddhh24mi') into :sEndTime from dual;
			select to_char(to_date(:sStrTime,'yyyymmddhh24mi') + :sWan /1440 , 'yyyymmddhh24mi') into :sWanTime from dual;
		
			sfedat = left(sEndTime,8)
			sfetim = right(sEndTime,4)
		End If
	
		tab_1.tabpage_3.dw_tabpage3_2.SetItem(ix, 'morout_copy_fsdat', left(sStrTime,8))
		tab_1.tabpage_3.dw_tabpage3_2.SetItem(ix, 'morout_copy_esdat', left(sStrTime,8))
		tab_1.tabpage_3.dw_tabpage3_2.SetItem(ix, 'morout_copy_fstim', right(sStrTime,4))
		tab_1.tabpage_3.dw_tabpage3_2.SetItem(ix, 'morout_copy_fedat', left(sEndTime,8))
		tab_1.tabpage_3.dw_tabpage3_2.SetItem(ix, 'morout_copy_eedat', left(sEndTime,8))
		tab_1.tabpage_3.dw_tabpage3_2.SetItem(ix, 'morout_copy_fetim', right(sEndTime,4))
		
		ix ++
	Loop
end if

Return 1
end function

public function integer wf_copy_row (integer arg_start, integer arg_end);Long 		Lrow, lMax, nRow, nSeq
String	sDepotNo, sPordno
String sitnbr, sitdsc, sispec, sshtnm, sunmsr, spdtgu

/* 입고예정창고 선택 */
sDepotNo = wf_DepotNo('1', '')

If tab_1.tabpage_2.dw_tabpage2.RowCount() = 0 Then
	lMax = 0
Else
	lMax = Long(tab_1.tabpage_2.dw_tabpage2.GetItemString(1, 'maxseq'))
End If

// 지시번호 생성
lMax = lMax + 1
sPordno = ispordno + string(lMax, '000') + '0'

nRow = arg_end
If nRow = 0 Then nRow = tab_1.tabpage_2.dw_tabpage2.RowCount()

/* 순위 결정 */
If nRow = 0 Then
	nSeq = 10
Else
	If nRow = tab_1.tabpage_2.dw_tabpage2.RowCount() Then
		nSeq = tab_1.tabpage_2.dw_tabpage2.GetItemNumber(nRow, 'momast_copy_mocnt')
		nSeq += 10
	Else
		nSeq = round((tab_1.tabpage_2.dw_tabpage2.GetItemNumber(nRow, 'momast_copy_mocnt') + tab_1.tabpage_2.dw_tabpage2.GetItemNumber(nRow+1, 'momast_copy_mocnt'))/2,0)
	End If
End If

// 복사할 행 copy
sitnbr = tab_1.tabpage_2.dw_tabpage2.GetItemString(arg_start, 'momast_copy_itnbr')
sitdsc = tab_1.tabpage_2.dw_tabpage2.GetItemString(arg_start, 'itemas_itdsc')
sispec = tab_1.tabpage_2.dw_tabpage2.GetItemString(arg_start, 'itemas_ispec')
sshtnm = tab_1.tabpage_2.dw_tabpage2.GetItemString(arg_start, 'itm_shtnm')
sunmsr = tab_1.tabpage_2.dw_tabpage2.GetItemString(arg_start, 'itemas_unmsr')
spdtgu = tab_1.tabpage_2.dw_tabpage2.GetItemString(arg_start, 'momast_copy_pdtgu')

/* 품목화면에 삽입 */
Lrow = 	tab_1.tabpage_2.dw_tabpage2.insertrow(nRow+1)
tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow,"momast_copy_ipchango",	sDepotNo)     // 출고창고			
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_sabu", gs_sabu)
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pordno", sPordno)
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_jidat", f_today())
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pdsts", '1')
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_purgc", 'N')
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "pagbn", 'N')
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_master_no", is_sysno)
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_matchk", '2')
tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow, 'momast_copy_mocnt', nSeq)

tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow, 'momast_copy_itnbr', sitnbr)
tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow, 'itemas_itdsc', sitdsc )
tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow, 'itemas_ispec', sispec)
tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow, 'itm_shtnm', sshtnm)
tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow, 'itemas_unmsr', sunmsr)
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pdtgu", spdtgu)

/* 상세화면에 삽입 */
tab_1.tabpage_3.dw_tabpage3_1.insertrow(0)	
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow,"momast_copy_ipchango",	sDepotNo)     // 출고창고			
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_sabu", gs_sabu)
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_pordno", sPordno)
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_jidat", f_today())
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_pdsts", '1')
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_purgc", 'N')
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "pagbn", 'N')
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_master_no", is_sysno)
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_matchk", '2')

tab_1.tabpage_2.dw_tabpage2.scrolltorow(Lrow)
tab_1.tabpage_2.dw_tabpage2.setrow(Lrow)
tab_1.tabpage_2.dw_tabpage2.setcolumn("momast_copy_pdqty")
tab_1.tabpage_2.dw_tabpage2.setfocus()

Return 1
end function

public function decimal wf_convert_qty (string arg_itnbr, decimal arg_qty, string arg_gubun);// arg_gubun = 'M' : m  -> 매
// arg_gubun = 'Q' : 매 -> M
Dec dstdqty, dvalue
String sPdtgu

sPdtgu = tab_1.tabpage_1.dw_date.GetItemString(1, 'steam')

SELECT MAX(STDQTY) INTO :dstdqty FROM PSTRUC WHERE PINBR = :arg_itnbr;
If IsNull(dstdqty) Or dstdqty = 0 Then dstdqty = 1

If arg_gubun = 'M' Then
	dValue = Truncate(arg_qty * dstdqty,0)
Else
	dValue = Truncate(arg_qty / dstdqty,0)
End If

Return dValue
end function

public function integer wf_hold_jaje ();Long lrow, ij
String sPordno, serror, stoday, sban, sjaje

dw_ban.accepttext() 		// 반제품 출고 기준창고
dw_jaje.accepttext()		// 부품   출고 기준창고

sBan		=	dw_ban.getitemstring(1, "ban_code")
sJaje		=	dw_jaje.getitemstring(1, "jaje_code")
sToday 	= f_today()

/* 할당내역을 삭제 */
Delete From holdstock_copy Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';	

/* 작업지시에 대한 할당을 작성 - 단 할당생성을 check한 경우 */
w_mdi_frame.sle_msg.text = '할당내역을 적상중입니다....!!'

For Lrow = 1 to tab_1.tabpage_2.dw_tabpage2.rowcount()
	
	 sPordno = tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_pordno")
	 
	 /* 할당내역 생성이 아니면 BOM을 검색안 함 */
	 if tab_1.tabpage_2.dw_tabpage2.getitemstring(Lrow, "momast_copy_holdct") = 'N' then continue;

	/* 할당번호 채번 */
	iJ = sqlca.fun_junpyo(gs_sabu, stoday, 'B0')
	if iJ < 1 then
		rollback;
		f_message_chk(51,'[할당번호]') 
		return -1
	end if
	
	/* 할당번호작성(12자리 기준) */
	isholdno = stoday + String(iJ, '0000')	
	Commit;

	sError = 'X'
	sqlca.erp000000840(gs_sabu, spordno, isholdno, sError);

	Choose Case sError
			 Case 'X'
					Rollback;
					F_message_chk(41,'[할당내역 계산]')
					return -1;
			 Case 'Y'
					Rollback;
					F_message_chk(89,'[할당내역 계산]')
					return -1;			
	End Choose
	
	// 출고예정창고를 Update
	Update HoldsTock_copy a
		Set hold_store = (select Decode(b.ittyp, '2', :sBan, :sJaje) as chango
								  From Itemas b
								 Where b.itnbr = a.itnbr)
	 Where a.sabu = :gs_sabu and a.hold_no like :isholdno||'%';
Next

Commit;

/* 작업지시 헤더 저장 */
update momast_head_copy set calc4 = 'Y' where sabu = :gs_sabu and master_no = :is_sysno;
Commit;

// 지시버튼 활성화
tab_1.tabpage_2.p_last.enabled = true
tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_up.gif"

return 1
end function

on w_adt_00290.create
int iCurrent
call super::create
this.gb_2=create gb_2
this.gb_1=create gb_1
this.cb_suju=create cb_suju
this.gb_3=create gb_3
this.tab_1=create tab_1
this.dw_ban=create dw_ban
this.dw_jaje=create dw_jaje
this.st_2=create st_2
this.sle_bal=create sle_bal
this.st_3=create st_3
this.dw_saupj=create dw_saupj
this.dw_print=create dw_print
this.cbx_jaje=create cbx_jaje
iCurrent=UpperBound(this.Control)
this.Control[iCurrent+1]=this.gb_2
this.Control[iCurrent+2]=this.gb_1
this.Control[iCurrent+3]=this.cb_suju
this.Control[iCurrent+4]=this.gb_3
this.Control[iCurrent+5]=this.tab_1
this.Control[iCurrent+6]=this.dw_ban
this.Control[iCurrent+7]=this.dw_jaje
this.Control[iCurrent+8]=this.st_2
this.Control[iCurrent+9]=this.sle_bal
this.Control[iCurrent+10]=this.st_3
this.Control[iCurrent+11]=this.dw_saupj
this.Control[iCurrent+12]=this.dw_print
this.Control[iCurrent+13]=this.cbx_jaje
end on

on w_adt_00290.destroy
call super::destroy
destroy(this.gb_2)
destroy(this.gb_1)
destroy(this.cb_suju)
destroy(this.gb_3)
destroy(this.tab_1)
destroy(this.dw_ban)
destroy(this.dw_jaje)
destroy(this.st_2)
destroy(this.sle_bal)
destroy(this.st_3)
destroy(this.dw_saupj)
destroy(this.dw_print)
destroy(this.cbx_jaje)
end on

event open;call super::open;String stoday, sPdtgu
	 
dw_ban.settransobject(sqlca)
dw_ban.insertrow(0)
dw_jaje.settransobject(sqlca)
dw_jaje.insertrow(0)
dw_saupj.settransobject(sqlca)
dw_saupj.insertrow(0)

dw_datetime.insertrow(0)

dw_insert.settransobject(sqlca)	/* 신규작업지시 저장용 - HEAD */

tab_1.tabpage_1.dw_plnlist.settransobject(sqlca)		// 연동계획 		검토화면
tab_1.tabpage_1.dw_date.settransobject(sqlca)			// 연동계획 		선택화면
tab_1.tabpage_1.dw_layout1.settransobject(sqlca)		// 연동계획 		선택화면
tab_1.tabpage_2.dw_tabpage2.settransobject(sqlca)		// 품목우선순위 	선택화면
tab_1.tabpage_2.dw_stock.settransobject(sqlca)			// 재고			 	선택화면
tab_1.tabpage_2.dw_link.settransobject(sqlca)			// 재고			 	선택화면
tab_1.tabpage_3.dw_tabpage3_1.settransobject(sqlca)	// 작업지시품목별 상세화면 
tab_1.tabpage_3.dw_tabpage3_2.settransobject(sqlca)	// 작업지시공정별 상세화면
tab_1.tabpage_3.dw_tabpage3_3.settransobject(sqlca)	// 작업지시공정별 상세화면

tab_1.tabpage_3.dw_etc.settransobject(sqlca)	// 작업지시공정별 상세화면

tab_1.tabpage_3.dw_jego.settransobject(sqlca)			// 품목별			할당화면

/* 작업지시번호 자동채번여부를 환경설정에서 검색함 */
select dataname
  into :ls_auto
  from syscnfg
 where sysgu = 'S' and serial = 6 and lineno = '70';
 
If isNull(ls_auto) or Trim(ls_auto) = '' then
	ls_auto = 'Y'
End if

if ls_auto = 'Y' then 
	sle_bal.Visible = false
	st_2.Visible = false
end if

/* 하위단계 품목에 대한 자동작업지시 여부를 검색하여 Button control */
//select dataname
//  into :ls_auto
//  from syscnfg
// where sysgu = 'Y' and serial = 21 and lineno = '1';
// 
//If isNull(ls_auto) or Trim(ls_auto) = '' then
//	ls_auto = '1'
//End if
//
//if ls_auto = '3' then 
//	tab_1.tabpage_2.p_auto.visible = false
//End if

//wf_treeview_item()

stoday = f_today()

tab_1.tabpage_1.dw_date.insertrow(0)
tab_1.tabpage_1.dw_date.setitem(1, "gidate", left(stoday, 6))

tab_1.tabpage_1.dw_date.setitem(1, "jdate",  stoday)	// 주간계획 기준일자

tab_1.tabpage_1.dw_date.setitem(1, "sdate",  stoday)
tab_1.tabpage_1.dw_date.setitem(1, "edate",  stoday)
//tab_1.tabpage_1.dw_date.setitem(1, "edate",  f_afterday(stoday,6))

// 부가사업장
f_mod_saupj(dw_saupj, 'saupj')

// 생산팀
f_child_saupj(tab_1.tabpage_1.dw_date, 'steam',gs_saupj)
select min(rfgub) into :sPdtgu from reffpf where rfcod = '03' and rfna2 = :gs_saupj;
tab_1.tabpage_1.dw_date.setitem(1, "steam",  sPdtgu)

tab_1.tabpage_1.dw_plnlist.reset()

wf_reset()


//m환산기준
SELECT TO_NUMBER(DATANAME) INTO :idMeter FROM SYSCNFG WHERE SYSGU = 'Y' AND SERIAL = 2 AND LINENO = :gs_saupj;
If IsNull(idMeter) Then idMeter = 500000

// 작업장별 내역-미리보기용
openwithparm(iw_window, this, "w_adt_00290_1", this)

iw_window.Move(this.X + 60, this.Y + 1350)
//iw_window.Resize(this.Width , this.Height - 350) // - dw_emplist.Height - 40)
iw_window.Visible = False

end event

event close;rollback;
end event

event closequery;call super::closequery;String sError

IF tab_1.tabpage_2.enabled then
	if Messagebox("작업지시", "작업지시중입니다" + '~n' + &
									  "작업지시를 취소하시겠읍니까?", question!, yesno!) = 1 then

		w_mdi_frame.sle_msg.text = '부하내역을 취소중입니다....!!'
		sError = 'X'
		sqlca.erp000000820(gs_sabu, is_sysno, sError);
		w_mdi_frame.sle_msg.text = ''
		Choose Case sError
				 Case 'X'
						F_message_chk(41,'[부하내역 계산]')
						Rollback;
						return -1
				 Case 'Y'
						F_message_chk(89,'[부하내역 계산]')
						Rollback;
						return -1
		End Choose
		
		/* 할당내역을 삭제 */
		Delete From holdstock_copy 			Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
		/* 지시내역을 삭제 */
		Delete From momast_copy 				Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
		Delete From morout_copy_none_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
		/* 공정내역을 삭제 */
		Delete From morout_copy 				Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
		/* 반제품 소요수량 삭제 */
		Delete From momast_copy_lotsim 		Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

		Delete From stock_copy 			Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
		Delete From momast_hold_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
		
	   COMMIT;

	Else	
		return 1
	End if
end if


end event

event activate;gw_window = this

if gs_lang = "CH" then   //// 중문일 경우
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("??(&Q)", false) //// 조회
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("追加(&A)", false) //// 추가
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("?除(&D)", false) //// 삭제
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("?存(&S)", false) //// 저장
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("取消(&Z)", false) //// 취소
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("淸除(&C)", false) //// 신규
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("??(&T)", false) //// 찾기
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("??(&F)", false) //// 필터
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("Excel??(&E)", false) //// 엑셀다운
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("?出(&P)", false) //// 출력
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("??(&R)", false) //// 미리보기 
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled("?助?(&G)", false) //// 도움말
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("PDF") + "(&P)", false)  //// PDF변환
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("설정") + "(&C)", false) //// 설정
else
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("조회") + "(&Q)", false) //// 조회
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("추가") + "(&A)", false) //// 추가
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("삭제") + "(&D)", false) //// 삭제
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("저장") + "(&S)", false) //// 저장
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("취소") + "(&Z)", false) //// 취소
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("신규") + "(&C)", false) //// 신규
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("찾기") + "(&T)", false) //// 찾기
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("필터") + "(&F)",	 false) //// 필터
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("엑셀변환") + "(&E)", false) //// 엑셀다운
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("출력") + "(&P)", false) //// 출력
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("미리보기") + "(&R)", false) //// 미리보기
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("도움말") + "(&G)", false) //// 도움말
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("PDF") + "(&P)", false)
	w_mdi_frame.uo_toolbarstrip.of_SetEnabled(f_get_trans_word("설정") + "(&C)", false)
end if

//// 단축키 활성화 처리
m_main2.m_window.m_inq.enabled = false //// 조회
m_main2.m_window.m_add.enabled = false //// 추가
m_main2.m_window.m_del.enabled = false  //// 삭제
m_main2.m_window.m_save.enabled = false //// 저장
m_main2.m_window.m_cancel.enabled = false //// 취소
m_main2.m_window.m_new.enabled = false //// 신규
m_main2.m_window.m_find.enabled = false  //// 찾기
m_main2.m_window.m_filter.enabled = false //// 필터
m_main2.m_window.m_excel.enabled = false //// 엑셀다운
m_main2.m_window.m_print.enabled = false  //// 출력
m_main2.m_window.m_preview.enabled = false //// 미리보기

w_mdi_frame.st_window.Text = Upper(is_window_id)
end event

event resize;tab_1.width = this.width - 60
tab_1.height = this.height - tab_1.y - 65

tab_1.tabpage_1.dw_plnlist.width = tab_1.width - 119
tab_1.tabpage_1.rr_2.width = tab_1.width - 101

tab_1.tabpage_1.dw_layout1.width = tab_1.width - 119
tab_1.tabpage_1.dw_layout1.height = tab_1.height - 2050
tab_1.tabpage_1.rr_3.width = tab_1.width - 101
tab_1.tabpage_1.rr_3.height = tab_1.height - 2034

tab_1.tabpage_2.dw_tabpage2.width = tab_1.width - 119
tab_1.tabpage_2.dw_tabpage2.height = tab_1.height - 386
tab_1.tabpage_2.rr_4.width = tab_1.width - 101
tab_1.tabpage_2.rr_4.height = tab_1.height - 366
end event

type cb_exit from w_inherite`cb_exit within w_adt_00290
integer x = 1650
integer y = 2708
string text = "종료"
end type

type sle_msg from w_inherite`sle_msg within w_adt_00290
end type

type dw_datetime from w_inherite`dw_datetime within w_adt_00290
end type

type st_1 from w_inherite`st_1 within w_adt_00290
integer x = 37
end type

type p_search from w_inherite`p_search within w_adt_00290
integer y = 3400
end type

type p_addrow from w_inherite`p_addrow within w_adt_00290
end type

type p_delrow from w_inherite`p_delrow within w_adt_00290
end type

type p_mod from w_inherite`p_mod within w_adt_00290
integer y = 3400
end type

type p_del from w_inherite`p_del within w_adt_00290
integer y = 3400
end type

type p_inq from w_inherite`p_inq within w_adt_00290
integer y = 3400
end type

type p_print from w_inherite`p_print within w_adt_00290
integer y = 3400
end type

type p_can from w_inherite`p_can within w_adt_00290
integer y = 3400
end type

type p_exit from w_inherite`p_exit within w_adt_00290
integer y = 3400
end type

type p_ins from w_inherite`p_ins within w_adt_00290
integer y = 3400
end type

type p_new from w_inherite`p_new within w_adt_00290
integer y = 3400
end type

type dw_input from w_inherite`dw_input within w_adt_00290
boolean visible = false
integer x = 27
integer y = 2912
end type

type cb_delrow from w_inherite`cb_delrow within w_adt_00290
boolean visible = false
integer y = 3200
end type

type cb_addrow from w_inherite`cb_addrow within w_adt_00290
boolean visible = false
integer y = 3200
end type

type dw_insert from w_inherite`dw_insert within w_adt_00290
boolean visible = false
integer x = 155
integer y = 2424
integer width = 517
integer height = 200
integer taborder = 0
boolean enabled = false
string dataobject = "d_pdt_02030_1"
end type

type cb_mod from w_inherite`cb_mod within w_adt_00290
boolean visible = false
integer y = 3200
end type

type cb_ins from w_inherite`cb_ins within w_adt_00290
boolean visible = false
integer y = 3200
end type

type cb_del from w_inherite`cb_del within w_adt_00290
boolean visible = false
integer y = 3200
end type

type cb_inq from w_inherite`cb_inq within w_adt_00290
boolean visible = false
integer y = 3200
end type

type cb_print from w_inherite`cb_print within w_adt_00290
boolean visible = false
integer y = 3200
end type

type cb_can from w_inherite`cb_can within w_adt_00290
boolean visible = false
integer y = 3200
end type

type cb_search from w_inherite`cb_search within w_adt_00290
boolean visible = false
integer y = 3200
end type

type gb_10 from w_inherite`gb_10 within w_adt_00290
integer x = 27
end type

type gb_button1 from w_inherite`gb_button1 within w_adt_00290
end type

type gb_button2 from w_inherite`gb_button2 within w_adt_00290
end type

type r_head from w_inherite`r_head within w_adt_00290
boolean visible = false
integer x = 23
integer y = 2900
end type

type r_detail from w_inherite`r_detail within w_adt_00290
boolean visible = false
integer x = 151
integer y = 2420
integer width = 526
integer height = 208
end type

type gb_2 from groupbox within w_adt_00290
boolean visible = false
integer x = 937
integer y = 2668
integer width = 1070
integer height = 168
integer textsize = -10
integer weight = 700
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
end type

type gb_1 from groupbox within w_adt_00290
boolean visible = false
integer x = 238
integer y = 2916
integer width = 722
integer height = 164
integer textsize = -10
integer weight = 700
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
end type

type cb_suju from commandbutton within w_adt_00290
boolean visible = false
integer x = 1207
integer y = 2404
integer width = 325
integer height = 108
integer textsize = -10
integer weight = 700
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
boolean enabled = false
string text = "수주연결"
end type

event clicked;//tab_1.selecttab(2)
//openwithparm(w_pdt_02030_3, tab_1.tabpage_2.dw_item)
end event

type gb_3 from groupbox within w_adt_00290
boolean visible = false
integer x = 914
integer y = 2464
integer width = 1376
integer height = 164
integer textsize = -10
integer weight = 700
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 67108864
boolean enabled = false
end type

type tab_1 from tab within w_adt_00290
event create ( )
event destroy ( )
integer x = 32
integer y = 52
integer width = 4558
integer height = 2328
integer taborder = 20
boolean bringtotop = true
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 16777215
boolean fixedwidth = true
boolean raggedright = true
boolean boldselectedtext = true
alignment alignment = center!
integer selectedtab = 1
tabpage_1 tabpage_1
tabpage_2 tabpage_2
tabpage_3 tabpage_3
end type

on tab_1.create
this.tabpage_1=create tabpage_1
this.tabpage_2=create tabpage_2
this.tabpage_3=create tabpage_3
this.Control[]={this.tabpage_1,&
this.tabpage_2,&
this.tabpage_3}
end on

on tab_1.destroy
destroy(this.tabpage_1)
destroy(this.tabpage_2)
destroy(this.tabpage_3)
end on

event selectionchanging;String scolumn, sItnbr, stditnbr
long   lrow
Integer Ichk, ireturn
int rtn
string spordno
datawindowchild state_child

w_mdi_frame.sle_msg.text = ''

If IsValid(iw_window) Then	iw_window.visible = false

/* 품목별 기본내역 error check */
if	oldindex = 2 then
	if	tab_1.tabpage_2.dw_tabpage2.accepttext() = -1 then
		return 1
	end if
	
	// 저장
	If tab_1.tabpage_2.dw_tabpage2.RowCount() > 0 Then
		tab_1.tabpage_2.p_auto.TriggerEvent(Clicked!)
	End If
End if

///* 품목별 상세/공정내역 error check */	
if 	oldindex = 3 then
	/* 기타일정 저장 */
	If tab_1.tabpage_3.dw_etc.Update() <> 1 Then
		MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
		RollBack;
		Return
	End If
	
	COMMIT;
end if


/* 지시 기준자료인 경우에는 화면을 Reset 하고 기준번호를 Clear*/
if newindex = 1 then
	tab_1.tabpage_1.dw_plnlist.reset()
	tab_1.tabpage_1.dw_layout1.reset()	
	
	SetNull(IsPordno)
	SetNull(Is_SysNo)
end if

if newindex = 2 then
	w_mdi_frame.sle_msg.text = 'Double Click시 재고상세 내역을 조회할 수 있읍니다.'	
end if

Lrow = 0
/* 품목별 상세/공정내역의 순서를 품목별 기본내역의 화면과 동일하게 설정 */
if	newindex = 3 Then
	If ib_rcal = TRUE Then
		// 작업지시가 생성된 작업장 내역을 조회
		tab_1.tabpage_3.dw_wkctr.Reset()
		iReturn = tab_1.tabpage_3.dw_wkctr.GetChild('wkctr', state_child)
		state_child.SetTransObject(SQLCA)
		state_child.Retrieve(gs_sabu, is_sysno)
		tab_1.tabpage_3.dw_wkctr.SetTransObject(SQLCA)
		tab_1.tabpage_3.dw_wkctr.InsertRow(0)
		
		tab_1.tabpage_3.dw_tabpage3_2.Reset()
		tab_1.tabpage_3.dw_etc.Reset()
	
		ib_rcal = False  // 공정일정 수정을 감시하기위한 Tag	
	End If
	
	tab_1.tabpage_3.dw_wkctr.SetItem(1, 'roslt', '')
	tab_1.tabpage_3.dw_tabpage3_2.SetFilter("")
	tab_1.tabpage_3.dw_tabpage3_2.Filter()
End if
end event

type tabpage_1 from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 108
integer width = 4521
integer height = 2204
long backcolor = 16777215
string text = "계획"
long tabtextcolor = 33554432
long tabbackcolor = 32106727
long picturemaskcolor = 553648127
cbx_2 cbx_2
rr_3 rr_3
rr_2 rr_2
p_tabpage1_cancel p_tabpage1_cancel
p_tabpage1_commit p_tabpage1_commit
p_tabpage1_print p_tabpage1_print
p_1 p_1
dw_plnlist dw_plnlist
dw_layout1 dw_layout1
cbx_1 cbx_1
pb_3 pb_3
dw_date dw_date
end type

on tabpage_1.create
this.cbx_2=create cbx_2
this.rr_3=create rr_3
this.rr_2=create rr_2
this.p_tabpage1_cancel=create p_tabpage1_cancel
this.p_tabpage1_commit=create p_tabpage1_commit
this.p_tabpage1_print=create p_tabpage1_print
this.p_1=create p_1
this.dw_plnlist=create dw_plnlist
this.dw_layout1=create dw_layout1
this.cbx_1=create cbx_1
this.pb_3=create pb_3
this.dw_date=create dw_date
this.Control[]={this.cbx_2,&
this.rr_3,&
this.rr_2,&
this.p_tabpage1_cancel,&
this.p_tabpage1_commit,&
this.p_tabpage1_print,&
this.p_1,&
this.dw_plnlist,&
this.dw_layout1,&
this.cbx_1,&
this.pb_3,&
this.dw_date}
end on

on tabpage_1.destroy
destroy(this.cbx_2)
destroy(this.rr_3)
destroy(this.rr_2)
destroy(this.p_tabpage1_cancel)
destroy(this.p_tabpage1_commit)
destroy(this.p_tabpage1_print)
destroy(this.p_1)
destroy(this.dw_plnlist)
destroy(this.dw_layout1)
destroy(this.cbx_1)
destroy(this.pb_3)
destroy(this.dw_date)
end on

type cbx_2 from checkbox within tabpage_1
boolean visible = false
integer x = 2990
integer y = 144
integer width = 695
integer height = 76
boolean bringtotop = true
integer textsize = -9
integer weight = 700
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 16777215
string text = "월계획 수량/잔량보기"
end type

event clicked;if this.checked = true then
	is_seemonth='Y'
else
	is_seemonth='N'
end if
end event

type rr_3 from roundrectangle within tabpage_1
long linecolor = 28144969
integer linethickness = 1
long fillcolor = 32106727
integer x = 37
integer y = 1860
integer width = 4457
integer height = 344
integer cornerheight = 40
integer cornerwidth = 55
end type

type rr_2 from roundrectangle within tabpage_1
long linecolor = 28144969
integer linethickness = 1
long fillcolor = 32106727
integer x = 37
integer y = 224
integer width = 4457
integer height = 1620
integer cornerheight = 40
integer cornerwidth = 55
end type

type p_tabpage1_cancel from uo_picture within tabpage_1
boolean visible = false
integer x = 4315
integer y = 20
integer width = 178
string picturename = "..\image\닫기_up.gif"
end type

event clicked;call super::clicked;if tab_1.tabpage_2.enabled then
	if Messagebox("작업지시", "작업지시중입니다" + '~n' + &
								     "작업지시를 취소하시겠읍니까?", question!, yesno!) = 2 then
		return
	end if
end if

p_exit.TriggerEvent(Clicked!)

end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\닫기_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\닫기_dn.gif'
end event

type p_tabpage1_commit from uo_picture within tabpage_1
integer x = 4142
integer y = 20
integer width = 178
string picturename = "..\image\완료_up.gif"
end type

event clicked;call super::clicked;w_mdi_frame.sle_msg.text = '품목자료를 생성중입니다....!!'
setpointer(hourglass!)
dw_insert.reset()

String sMsterNo, snull
Integer Ireturn, Igubun
Long    nCnt

Datawindowchild  state_child

setnull(snull)

d_pdt_02030_strerr = create datastore
d_pdt_02030_strerr.dataobject = 'd_pdt_02030_strerr'

bomcheck = false // 작업지시 기초자료 오류여부 check
Ireturn =  wf_requiredchk_tabpage1() 

if bomcheck  then
	Messagebox("Error", "작업지시 하려고 하는 품목중 오류가 있읍니다", information!)
	Openwithparm(w_pdt_02030_6, d_pdt_02030_strerr)
End if
bomcheck = False

destroy d_pdt_02030_strerr

dw_insert.reset()
w_mdi_frame.sle_msg.text = ''

If Ireturn = -1 then
	Messagebox("작업지시", "품목자료 작성중 오류발생", stopsign!)
	return
elseIf Ireturn = 0 then
	return
end if

w_mdi_frame.sle_msg.text = '작업지시 예정 자료를 조회중입니다....!!'

String 	sYymm, sSdate, sEdate

sYymm 	= dw_date.getitemstring(1, "gidate")
sSdate	= dw_date.getitemstring(1, "sdate")
sEdate	= dw_date.getitemstring(1, "edate")

tab_1.tabpage_2.st_pordno.text = '[ 작업계획번호 ] ' + ispordno


/* 품목별 상세내역 조회 */
tab_1.tabpage_3.dw_tabpage3_1.retrieve(gs_sabu, is_sysno)

/* 품목별 내역 조회 		*/
tab_1.tabpage_2.dw_tabpage2.retrieve(gs_sabu, is_sysno, gs_saupj)

sMsterNo = Trim(dw_date.GetItemString(1, 'master_no'))
If IsNull(sMsterNo) Or sMsterNo = '' Then	
	setpointer(arrow!)
	/* 순위결정 활성화 */
	tab_1.tabpage_1.enabled = false
	tab_1.tabpage_2.enabled = true
	tab_1.tabpage_3.enabled = false
Else
	/* 순위결정 활성화 */
	tab_1.tabpage_1.enabled = false
	tab_1.tabpage_2.enabled = true
	tab_1.tabpage_3.enabled = true
	
	// 작업지시가 생성된 작업장 내역을 조회
	tab_1.tabpage_3.dw_wkctr.Reset()
	iReturn = tab_1.tabpage_3.dw_wkctr.GetChild('wkctr', state_child)
	state_child.SetTransObject(SQLCA)
	state_child.Retrieve(gs_sabu, is_sysno)
	tab_1.tabpage_3.dw_wkctr.SetTransObject(SQLCA)
	tab_1.tabpage_3.dw_wkctr.InsertRow(0)
	
	tab_1.tabpage_3.dw_tabpage3_2.Reset()
	
	// 일정계산되어 있으면 소요자재 활성화
	If state_child.RowCount() > 0 Then
		tab_1.tabpage_2.p_jaje.Enabled = True
		tab_1.tabpage_2.p_jaje.picturename = '..\image\소요자재_up.gif'
		
//		// 소요내역이 계산되어있으면 작지 버튼 활성화
//		SELECT COUNT(*) INTO :nCnt FROM MOMAST_HEAD_COPY WHERE SABU = :gs_sabu AND MASTER_NO = :is_sysno AND CALC4 = 'Y';
//		If nCnt > 0 Then
//			tab_1.tabpage_2.p_last.Enabled = True
//			tab_1.tabpage_2.p_last.picturename = '..\image\작업지시_up.gif'
//		End If
	End If
End If

tab_1.tabpage_2.dw_tabpage2.setfocus()
tab_1.selecttab(2);

dw_date.SetItem(1, 'master_no', sNull)

w_mdi_frame.sle_msg.text = 'Double Click시 재고상세 내역을 조회할 수 있읍니다.'	

end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\완료_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\완료_dn.gif'
end event

type p_tabpage1_print from uo_picture within tabpage_1
integer x = 3968
integer y = 20
integer width = 178
boolean enabled = false
string picturename = "..\image\인쇄_d.gif"
end type

event clicked;call super::clicked;openwithparm(w_print_options, tab_1.tabpage_1.dw_plnlist)
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\인쇄_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\인쇄_dn.gif'
end event

type p_1 from uo_picture within tabpage_1
integer x = 3794
integer y = 20
integer width = 178
string picturename = "..\image\자료조회_up.gif"
end type

event clicked;call super::clicked;string sjdate, sdate1, sdate2, sdate3, snull, slimon, s_team, sGbn, s_wkctr, sittyp, fitcls, titcls, sitnbr, sempno, ls_saupj
decimal dhseq

setnull(snull)

if dw_date.accepttext() = -1 then return 

sGbn = dw_date.getitemstring(1, "gubun")

/* 유효일자 check */
sJdate = TRIM(dw_date.getitemstring(1, "jdate"))
if isnull(sJdate) or trim(sJdate) = '' or f_datechk(sJdate ) = -1 then
	f_message_chk(35,'[일자 FROM]') 
	dw_date.setcolumn('jdate')
	dw_date.setfocus()
	return 
end if

sdate1 = Left(TRIM(dw_date.getitemstring(1, "jdate")),6)
sdate2 = TRIM(dw_date.getitemstring(1, "sdate"))
sdate3 = dw_date.getitemstring(1, "edate")

/* 해당년월의 연동계획에 대한 최대차수 검색 */
select max(moseq) into :dhseq from monpln_sum  where sabu = :gs_sabu and monyymm = :sdate1;
isgyymm = sdate1
iimoseq = dhseq

sempno = TRIM(dw_date.getitemstring(1, "empno"))
if  sempno = '' or isnull(sempno) then    sempno = ''

s_team = TRIM(dw_date.getitemstring(1, "steam"))
if  s_team = '' or isnull(s_team) then
	f_message_chk(1400,'[생산팀]')
	dw_date.setcolumn('steam')
	dw_date.setfocus()
	return 1
END if

/* 작업장 입력여부에 따라 */
s_wkctr = TRIM(dw_date.getitemstring(1, "wkctr"))
if  s_wkctr = '' or isnull(s_wkctr) then    s_wkctr = ''

//사업장
ls_saupj = TRIM(dw_saupj.getitemstring(1, "saupj"))
if  ls_saupj = '' or isnull(ls_saupj) then    ls_saupj = ''

dw_layout1.reset()

sittyp = TRIM(dw_date.getitemstring(1, "ittyp"))
fitcls = TRIM(dw_date.getitemstring(1, "itcls"))
titcls = TRIM(dw_date.getitemstring(1, "titcls"))
sitnbr = TRIM(dw_date.getitemstring(1, "itnbr"))

if sitnbr = '' or isnull(sitnbr) then sitnbr = ''

// 품목분류
if sittyp = '' or isnull(sittyp) then sittyp = ''
if fitcls = '' or isnull(fitcls) then fitcls = ''

if  dw_plnlist.retrieve(gs_sabu, sdate1, dhseq, sdate2, sdate3, s_team+'%', s_wkctr+'%', sittyp+'%', fitcls+'%', sitnbr+'%', sempno+'%', ls_saupj) < 1 then
	f_message_chk(50, '')
	
	dw_date.setcolumn("gidate")
	dw_date.setfocus()
	return
end if

p_tabpage1_print.enabled = True
p_tabpage1_print.PictureName = "..\image\인쇄_up.gif"
dw_plnlist.setrow(1)
dw_plnlist.setfocus()

end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\자료조회_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\자료조회_dn.gif'
end event

type dw_plnlist from u_d_select_sort within tabpage_1
integer x = 46
integer y = 228
integer width = 4439
integer height = 1608
integer taborder = 11
boolean bringtotop = true
string dataobject = "d_adt_00290_2"
boolean border = false
end type

event clicked;call super::clicked;if is_chk ='Y' then 
   is_old_dwobject_name = ''
	is_chk = 'N' 
end if	

Long Lrow
Lrow = row

wf_tabpage1_layout(Lrow)

//CALL SUPER ::CLICKED



end event

event rowfocuschanged;Long Lrow
Lrow = currentrow

if Lrow > 0 then
	selectrow(0, False)
	selectrow(Lrow, True)	
	wf_tabpage1_layout(Lrow)
end if
end event

event rbuttondown;call super::rbuttondown;string sitnbr

If row > 0 AND ( dwo.name = 'bomchk' or dwo.name = 'rouchk')     then
	sitnbr = this.getitemstring(row, 'itnbr')
	
	if dwo.name = 'rouchk' then
		gs_gubun = 'ATTENTION'
		gs_code  = sitnbr 
      open(w_pdm_01440)
   else
		gs_gubun = 'ATTENTION'
		gs_code  = sitnbr 
      open(w_pdm_01530)
	End if
End if


end event

type dw_layout1 from datawindow within tabpage_1
integer x = 46
integer y = 1868
integer width = 4439
integer height = 328
integer taborder = 40
boolean bringtotop = true
string dataobject = "d_adt_00290_8"
boolean vscrollbar = true
boolean border = false
boolean livescroll = true
end type

type cbx_1 from checkbox within tabpage_1
integer x = 3392
integer y = 132
integer width = 375
integer height = 80
boolean bringtotop = true
integer textsize = -9
integer weight = 700
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 16777215
string text = "전체선택"
end type

event clicked;long ll_count, lCount
string ls_status

if this.checked = true then
	ls_status='Y'
	this.text = '전체해제'
else
	ls_status='N'
	this.text = '전체선택'
end if

SetPointer(HourGlass!)

lCount = dw_plnlist.rowcount() 

for ll_count=1 to lCount
	dw_plnlist.setitem(ll_count, 'gubun', ls_status)
next


end event

type pb_3 from u_pic_cal within tabpage_1
integer x = 2313
integer y = 112
integer taborder = 100
boolean bringtotop = true
end type

event clicked;call super::clicked;dw_date.Setcolumn('jdate')
IF gs_code = '' Or IsNull(gs_code) THEN Return
dw_date.SetItem(1, 'jdate', gs_code)

tab_1.tabpage_1.dw_date.setitem(1, "sdate",  gs_code)
tab_1.tabpage_1.dw_date.setitem(1, "edate",  gs_code)
//tab_1.tabpage_1.dw_date.setitem(1, "edate",  f_afterday(gs_code,6))

end event

type dw_date from datawindow within tabpage_1
event ue_enterkey pbm_dwnprocessenter
integer x = 32
integer width = 3717
integer height = 208
integer taborder = 10
string dataobject = "d_adt_00290_1"
boolean border = false
boolean livescroll = true
end type

event ue_enterkey;Send(Handle(this),256,9,0)
Return 1
end event

event itemchanged;string sdate, snull, slimon, steam, sGbn, swkctr, swknm, s_gub, s_itt, stitnm
int    ireturn 

setnull(snull)

if this.accepttext() = -1 then return 

/* 계획자료 선택에 따른 text변경 */
if dwo.name = 'gubun' then
	sGbn = this.gettext()

//	Choose case sGbn
//			 Case '1'
//					tab_1.tabpage_1.text	= '월 계획'
//					dw_plnlist.dataobject = 'd_adt_00290_2'
//					this.object.sdate_t.text = '계획일자'
//			 Case '2'
////					p_1.text = '작업예정조회'
//					tab_1.tabpage_1.text	= '작업예정'
//					dw_plnlist.dataobject = 'd_pdt_02030_101'
//					this.object.sdate_t.text = '계획일자'
//			 Case '3'
////					p_1.text = '수주자료조회'
//					tab_1.tabpage_1.text	= '수주자료'
//					this.object.sdate_t.text = '수주승인일'
//					dw_plnlist.dataobject = 'd_pdt_02030_102'  // 할당기준으로 수주조회
//			 Case '4'
////					p_1.text = '개발작지조회'
//					tab_1.tabpage_1.text	= '개발작지'
//					dw_plnlist.dataobject = 'd_pdt_02030_104'
//					this.object.sdate_t.text = '의뢰승인일'
//			 Case '5'
////					p_1.text = '금형/치공구 조회'
//					tab_1.tabpage_1.text	= '금형치구'
//					dw_plnlist.dataobject = 'd_pdt_02030_105'
//					this.object.sdate_t.text = '의뢰일자'
//
//			 Case '7'
////					p_1.text = 'A/S 조회'
//					tab_1.tabpage_1.text	= '샘플'
//					dw_plnlist.dataobject = 'd_pdt_02030_107'
//					this.object.sdate_t.text = '의뢰승인일'					
//			 Case '8'
////					p_1.text = '크레임 조회'
//					tab_1.tabpage_1.text	= '크레임'
//					dw_plnlist.dataobject = 'd_pdt_02030_108'
//					this.object.sdate_t.text = '의뢰승인일'					
//	End choose
//	dw_plnlist.settransobject(sqlca)

	If sGbn = '%' Then
		dw_plnlist.SetFilter("")
	Else
		dw_plnlist.SetFilter("crt = '"+sGbn+"'")
	End If
	dw_plnlist.Filter()
	
	dw_layout1.reset()
end if

/* 유효일자 check */
if dwo.name = 'gidate' then
	sdate = this.gettext()
	this.setitem(1, "sdate", snull)
	this.setitem(1, "edate", snull)
	if isnull(sdate) or trim(sdate) = '' or f_datechk(sdate + '01') = -1 then
		f_message_chk(35,'[기준년월]') 	
		return 1
	end if
end if

/* 주간계획일자 check */
if dwo.name = 'jdate' then
	sdate = this.gettext()

	if f_datechk(sdate) <> 1 then
		f_message_chk(35,'[주간계획일자]') 	
		return 1
	end if
	
	tab_1.tabpage_1.dw_date.setitem(1, "sdate",  sdate)
//	tab_1.tabpage_1.dw_date.setitem(1, "edate",  f_afterday(sdate,6))
	tab_1.tabpage_1.dw_date.setitem(1, "edate",  sdate)
end if

sGbn = this.getitemstring(1, "gubun")

/* 기간에 대한 유효성 check */
if dwo.name = 'sdate' then
	sdate = this.gettext()
	if isnull(sdate) or trim(sdate) = '' then return 
	
	if f_datechk(sdate) = -1 then
		f_message_chk(35,'[일자 FROM]') 	
		return 1
	end if	
	
	// 계획년월 기간에 대한 일자check는 수주자료 기준인 경우에는 무시한다.
	if sGbn = '1' then
		if this.getitemstring(1, "gidate") > left(this.getitemstring(1, "sdate"), 6) then
			f_message_chk(34,'[일자-2]') 	
			return 1		
		end if
	end if
	
	select to_char(add_months(to_date(:sdate, 'yyyymmdd'), 5), 'yyyymm')
	  into :slimon
	  from dual;	
	  
	// 계획년월 기간에 대한 일자check는 수주자료 기준인 경우에는 무시한다.
	if sGbn = '1' then	  
		if slimon < left(this.getitemstring(1, "sdate"), 6) then
			f_message_chk(34,'[일자-4]'+slimon) 	
			return 1		
		end if	  
	end if
	
end if

if dwo.name = 'edate' then
	sdate = this.gettext()	
	if isnull(sdate) or trim(sdate) = '' then return 
	
	if f_datechk(sdate) = -1 then
		f_message_chk(35,'[일자 TO]') 	
		return 1
	end if
	
	// 계획년월 기간에 대한 일자check는 수주자료 기준인 경우에는 무시한다.
	if sGbn = '1' then	
		if this.getitemstring(1, "gidate") > left(this.getitemstring(1, "edate"), 6) then
			f_message_chk(34,'[일자]') 	
			return 1		
		end if
	end if	
		
	// 계획년월 기간에 대한 일자check는 수주자료 기준인 경우에는 무시한다.
	if sGbn = '1' then
		select to_char(add_months(to_date(:sdate, 'yyyymmdd'), 5), 'yyyymm')
		  into :slimon
		  from dual;	
		  
		if slimon < left(this.getitemstring(1, "edate"), 6) then
			f_message_chk(34,'[일자]') 	
			return 1		
		end if	  
	end if

end if
/* 생산 check */
if dwo.name = 'steam' then
	steam = this.gettext()
	if isnull(sTeam) or trim(steam) = '' then return 
end if

if dwo.name = 'wkctr' then
	swkctr = trim(this.gettext())
	
	if isnull(swkctr) or trim(swkctr) = '' then 
		this.setitem(1, "wknm", sNull)
		return 
	end if
	ireturn = f_get_name2('작업장', 'Y', swkctr, swknm, sdate) 
	this.setitem(1, "wkctr", swkctr)
	this.setitem(1, "wknm", swknm)
	return ireturn
end if


/* 품목분류 */
if dwo.name = 'itcls' then
	SetItem(1,'titnm',sNull)
		
	s_gub = Trim(GetText())
	IF s_gub = "" OR IsNull(s_gub) THEN 		RETURN
		
	s_itt = GetItemString(1,"ittyp")
	If IsNull(s_itt) Or s_itt = '' then s_itt = '1'
		
	IF s_itt <> "" AND Not IsNull(s_itt) THEN 
		SELECT "ITNCT"."TITNM"
		  INTO :stitnm
		  FROM "ITNCT"  
		 WHERE ( "ITNCT"."ITTYP" = :s_itt ) AND ( "ITNCT"."ITCLS" = :s_gub );
			
		IF SQLCA.SQLCODE <> 0 THEN
			TriggerEvent(RButtonDown!)
			Return 2
		ELSE
			SetItem(1,"titnm",stitnm)
		END IF
	END IF
end if
end event

event itemerror;this.setitem(1, dwo.name, '')
return 1
end event

event rbuttondown;string sittyp
str_itnct lstr_sitnct

gs_code     = ''
gs_codename = ''
gs_codename2 = ''
gs_gubun    = ''

if this.getcolumnname() = "wkctr" then
   gs_code = this.gettext()
	open(w_workplace_popup)
	if gs_code = '' or isnull(gs_code) then return 
	this.setitem(1, "wkctr", gs_code)
	this.setitem(1, "wknm", gs_codename)
elseif this.GetColumnName() = 'itcls' then

	sIttyp   = this.GetItemString(1, 'ittyp')
	gs_gubun = this.GetItemString(1, 'steam')
	OpenWithParm(w_ittyp_popup4, sIttyp)
	
   lstr_sitnct = Message.PowerObjectParm	
	
	if isnull(lstr_sitnct.s_ittyp) or lstr_sitnct.s_ittyp = "" then return 
	
	this.SetItem(1, "ittyp", lstr_sitnct.s_ittyp)
	this.SetItem(1, "itcls", lstr_sitnct.s_sumgub)
	this.SetItem(1, "titnm", lstr_sitnct.s_titnm)
elseif this.GetColumnName() = 'titcls' then

	sIttyp   = this.GetItemString(1, 'ittyp')
	gs_gubun = this.GetItemString(1, 'steam')
	OpenWithParm(w_ittyp_popup4, sIttyp)
	
   lstr_sitnct = Message.PowerObjectParm	
	
	if isnull(lstr_sitnct.s_ittyp) or lstr_sitnct.s_ittyp = "" then return 
	
	this.SetItem(1, "ittyp", lstr_sitnct.s_ittyp)
	this.SetItem(1, "titcls", lstr_sitnct.s_sumgub)
elseif this.GetColumnName() = 'itnbr' then
	gs_gubun = '1' 
	open(w_itemas_popup)
	
	if isnull(gs_code) or gs_code = "" then return
	
	this.SetItem(1, "itnbr", gs_code)

//elseIF this.GetColumnName() = "cvcod" THEN 
//   gs_gubun = '1' 
//	OPEN(W_VNDMST_POPUP)
//
//	if gs_code = '' or isnull(gs_code) then return 
//
//	this.SetItem(1, "cvcod", gs_code)
//	this.SetItem(1, "cvnas", gs_codename)
elseIF this.GetColumnName() = "master_no" THEN 
   gs_gubun = GetItemString(1, 'steam')
	OPEN(w_adt_00290_popup)
	if gs_code = '' or isnull(gs_code) then return 

	this.SetItem(1, "master_no", gs_code)
	this.SetItem(1, "steam", gs_gubun)
	this.SetItem(1, "jdate", gs_codename)
	this.SetItem(1, "sdate", gs_codename)
	this.SetItem(1, "edate", gs_codename2)

	SetNull(gs_code)
	SetNull(gs_codename)
	SetNull(gs_codename2)
	SetNull(gs_gubun)
END IF
end event

type tabpage_2 from userobject within tab_1
integer x = 18
integer y = 108
integer width = 4521
integer height = 2204
boolean enabled = false
long backcolor = 16777215
string text = "대상 물량"
long tabtextcolor = 33554432
long tabbackcolor = 32106727
long picturemaskcolor = 536870912
p_jaje p_jaje
p_13 p_13
p_delall p_delall
rr_4 rr_4
dw_link dw_link
dw_stock dw_stock
p_14 p_14
rr_9 rr_9
p_4 p_4
p_3 p_3
p_2 p_2
p_tabpage2_insert p_tabpage2_insert
p_12 p_12
p_auto p_auto
p_last p_last
dw_tabpage2 dw_tabpage2
st_pordno st_pordno
end type

on tabpage_2.create
this.p_jaje=create p_jaje
this.p_13=create p_13
this.p_delall=create p_delall
this.rr_4=create rr_4
this.dw_link=create dw_link
this.dw_stock=create dw_stock
this.p_14=create p_14
this.rr_9=create rr_9
this.p_4=create p_4
this.p_3=create p_3
this.p_2=create p_2
this.p_tabpage2_insert=create p_tabpage2_insert
this.p_12=create p_12
this.p_auto=create p_auto
this.p_last=create p_last
this.dw_tabpage2=create dw_tabpage2
this.st_pordno=create st_pordno
this.Control[]={this.p_jaje,&
this.p_13,&
this.p_delall,&
this.rr_4,&
this.dw_link,&
this.dw_stock,&
this.p_14,&
this.rr_9,&
this.p_4,&
this.p_3,&
this.p_2,&
this.p_tabpage2_insert,&
this.p_12,&
this.p_auto,&
this.p_last,&
this.dw_tabpage2,&
this.st_pordno}
end on

on tabpage_2.destroy
destroy(this.p_jaje)
destroy(this.p_13)
destroy(this.p_delall)
destroy(this.rr_4)
destroy(this.dw_link)
destroy(this.dw_stock)
destroy(this.p_14)
destroy(this.rr_9)
destroy(this.p_4)
destroy(this.p_3)
destroy(this.p_2)
destroy(this.p_tabpage2_insert)
destroy(this.p_12)
destroy(this.p_auto)
destroy(this.p_last)
destroy(this.dw_tabpage2)
destroy(this.st_pordno)
end on

type p_jaje from uo_picture within tabpage_2
integer x = 3680
integer y = 20
integer width = 178
boolean enabled = false
string picturename = "..\image\소요자재_d.gif"
end type

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\소요자재_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\소요자재_dn.gif'
end event

event clicked;call super::clicked;String 	sColumn
Integer	iReturn
Long		Lrow, ix
Dec      dPdqty, dPdmqty, dOldqty

if dw_tabpage2.accepttext() = -1 then
	dw_tabpage2.setfocus()
	return
end if

SetPointer(HourGlass!)


// 자료 무결성 check
d_pdt_02030_strerr = create datastore
d_pdt_02030_strerr.dataobject = 'd_pdt_02030_strerr'

bomcheck = false // 작업지시 기초자료 오류여부 check

iReturn = 0
iReturn = wf_requiredchk_tabpage2(sColumn, Lrow)

If 	 iReturn = -1 then		/* 현재 화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 
		 dw_tabpage2.setcolumn(sColumn)
		 dw_tabpage2.sCrolltorow(Lrow)
		 dw_tabpage2.setrow(Lrow)
		 dw_tabpage2.setfocus()
		 return
elseif iReturn = -2 then		/* 품목 상세화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 	
		 tab_1.tabpage_3.dw_tabpage3_1.setcolumn(sColumn)
		 tab_1.tabpage_3.dw_tabpage3_1.sCrolltoRow(Lrow)
		 tab_1.tabpage_3.dw_tabpage3_1.setRow(Lrow)
		 tab_1.selecttab(3)
		 tab_1.tabpage_3.dw_tabpage3_1.setFocus()
		 return
end if

//-------------------------------------------------------------------------------------------------------//
if bomcheck  then
	rollback;
	Messagebox("Error", "작업지시 하려고 하는 품목중 오류가 있읍니다", information!)
	Openwithparm(w_pdt_02030_6, d_pdt_02030_strerr)
	destroy d_pdt_02030_strerr
	Return
End if
bomcheck = False

destroy d_pdt_02030_strerr

//-------------------------------------------------------------------------------------------------------//

if dw_tabpage2.update(true, false) = 1 then
	// 수량변경시 morout_copy도 동시에 변경한다
	For ix = 1 To dw_tabpage2.RowCount()
		dPdqty  = dw_tabpage2.GetItemNumber(ix, 'momast_copy_pdqty')
		dPdmqty = dw_tabpage2.GetItemNumber(ix, 'momast_copy_pdmqty')
		dOldqty = dw_tabpage2.GetItemNumber(ix, 'old_pdqty')
		sColumn = dw_tabpage2.GetItemString(ix, 'momast_copy_pordno')
		
		If IsNull(dOldqty) then dOldqty = 0
		
		If dw_tabpage2.GetItemNumber(ix, 'old_pdqty') <> dpdqty And dOldqty > 0 And &
		   dw_tabpage2.GetItemStatus(ix, 0, Primary!) = DataModified! Then
			UPDATE MOROUT_COPY
			   SET PDQTY = :dpdmqty,
				    ESMAN = ROUND(ESMAN / :doldqty * :dpdqty,0),
					 ESMCH = ROUND(ESMCH / :doldqty * :dpdqty,0),
					 ESTIM = ROUND(ESMAN / :doldqty * :dpdqty,0) + ROUND(ESMCH / :doldqty * :dpdqty,0)
			 WHERE SABU = :gs_sabu
			   AND PORDNO = :sColumn
				AND MASTER_NO = :is_sysno;
		End If
	Next
	 
	Commit;		 
 
 	dw_tabpage2.resetupdate()
Else
	Rollback;
	w_mdi_frame.sle_msg.text = ''
	f_rollback()
	return
end if

// 소요자재 할당
If wf_hold_jaje() <> 1 Then Return

// 저장후 재조회
tab_1.tabpage_2.dw_tabpage2.retrieve(gs_sabu, is_sysno, gs_saupj)

ib_rcal = true

SetPointer(Arrow!)

w_mdi_frame.sle_msg.text = ''
tab_1.tabpage_2.setfocus()
end event

type p_13 from uo_picture within tabpage_2
boolean visible = false
integer x = 1253
integer y = 12
integer width = 178
boolean originalsize = true
string picturename = "..\image\공정추가_up.gif"
end type

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\공정추가_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\공정추가_dn.gif'
end event

event clicked;call super::clicked;Int ireturn
String sMsg, sPordno, scolumn
Long lrow

SetNull(gs_code)			// 작업지시번호
SetNull(gs_codename)		// 공정코드

If tab_1.tabpage_2.dw_tabpage2.AcceptText() <> 1 Then Return

If tab_1.tabpage_2.dw_tabpage2.rowcount() > 0 then
	lrow = tab_1.tabpage_2.dw_tabpage2.getrow()
	If lrow <= 0 Then return

	gs_code = tab_1.tabpage_2.dw_tabpage2.getitemstring(lrow, "momast_copy_pordno")   // 작업지시번호
Else
	Return
End if

if IsNull( gs_code ) then
	MessageBox("공정추가", "계산후 공정을 추가하십시요" + "작업지시번호가 생성되어야 합니다", stopsign!)
	return
End if

If tab_1.tabpage_2.dw_tabpage2.getitemstring(lrow, "momast_copy_porgu") = '90' Then 
	MessageBox("공정추가", "주간계획자료는 수정불가합니다.!!", stopsign!)
	Return
End If

If dw_tabpage2.getitemstring(lrow, "momast_copy_porgu") <> '14' and dw_tabpage2.getitemstring(lrow, "momast_copy_porgu") <> '20' Then
	MessageBox("공정추가", "재작업/테스트만 가능합니다!!", stopsign!)
	Return
End If

///////////////////////////////////////////
// 자료 무결성 check
d_pdt_02030_strerr = create datastore
d_pdt_02030_strerr.dataobject = 'd_pdt_02030_strerr'

bomcheck = false // 작업지시 기초자료 오류여부 check

iReturn = 0
iReturn = wf_requiredchk_tabpage2(sColumn, Lrow)

If 	 iReturn = -1 then		/* 현재 화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 
		 dw_tabpage2.setcolumn(sColumn)
		 dw_tabpage2.sCrolltorow(Lrow)
		 dw_tabpage2.setrow(Lrow)
		 dw_tabpage2.setfocus()
		 return
elseif iReturn = -2 then		/* 품목 상세화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 	
		 tab_1.tabpage_3.dw_tabpage3_1.setcolumn(sColumn)
		 tab_1.tabpage_3.dw_tabpage3_1.sCrolltoRow(Lrow)
		 tab_1.tabpage_3.dw_tabpage3_1.setRow(Lrow)
		 tab_1.selecttab(3)
		 tab_1.tabpage_3.dw_tabpage3_1.setFocus()
		 return
end if

if dw_tabpage2.update() = 1 then
 		 
	Commit;		 
 
Else
	Rollback;
	w_mdi_frame.sle_msg.text = ''
	f_rollback()
	return
end if

if bomcheck  then
	rollback;
	Messagebox("Error", "작업지시 하려고 하는 품목중 오류가 있읍니다", information!)
	Openwithparm(w_pdt_02030_6, d_pdt_02030_strerr)
	destroy d_pdt_02030_strerr
	Return
End if
bomcheck = False

destroy d_pdt_02030_strerr


///////////////////////////////////////////
sPordno = gs_code

gs_codename = is_sysno
gs_gubun = 'N'	//수정여부
open(w_pdt_02030_8)

sMsg = message.stringparm
if sMsg = 'Y' then
//	tab_1.tabpage_3.dw_tabpage3_2.retrieve(gs_sabu, spordno)
End if

SetNull(gs_code)			// 작업지시번호
SetNull(gs_codename)		// 공정코드
end event

type p_delall from uo_picture within tabpage_2
integer x = 4027
integer y = 20
integer width = 178
string picturename = "..\image\삭제_up.gif"
end type

event clicked;call super::clicked;if Messagebox("주간계획", "작업지시중입니다" + '~n' + &
							     "작업지시를 삭제하시겠읍니까?", question!, yesno!) = 2 then
	return
end if

String sError
/* 작업지시 임시자료에 의하여 계산된 부하내역을 복구시킨다(부하내역 삭제만 함). */
if isnull(is_sysno) or trim(is_sysno) = '' then
Else
	w_mdi_frame.sle_msg.text = '부하내역을 취소중입니다....!!'
	sError = 'X'
	sqlca.erp000000820(gs_sabu, is_sysno, sError);
	w_mdi_frame.sle_msg.text = ''
	Choose Case sError
			 Case 'X'
					F_message_chk(41,'[부하내역 계산]')
					Rollback;
					return -1
			 Case 'Y'
					F_message_chk(89,'[부하내역 계산]')
					Rollback;
					return -1
	End Choose
end if

/* 지시내역을 삭제 */
Delete From momast_copy 				Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 공정내역을 삭제 */
Delete From morout_copy 				Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From morout_copy_none_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 할당내역을 삭제 */
Delete From holdstock_copy 			Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 반제품 소요수량 삭제 */
Delete From momast_copy_lotsim 		Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

Delete From stock_copy 			Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From momast_hold_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From mometc_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

/* 작업지시 헤더 저장 */
update momast_head_copy set STATUS = '3' where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

Commit;

wf_reset()

end event

event ue_lbuttonup;PictureName = '..\image\삭제_up.gif'
end event

event ue_lbuttondown;PictureName = '..\image\삭제_dn.gif'
end event

type rr_4 from roundrectangle within tabpage_2
long linecolor = 28144969
integer linethickness = 1
long fillcolor = 32106727
integer x = 37
integer y = 168
integer width = 4462
integer height = 2012
integer cornerheight = 40
integer cornerwidth = 55
end type

type dw_link from u_key_enter within tabpage_2
boolean visible = false
integer x = 3145
integer y = 2080
integer width = 1362
integer height = 116
integer taborder = 11
boolean titlebar = true
string title = "연결"
string dataobject = "d_adt_00290_a"
boolean vscrollbar = true
end type

event buttonclicked;call super::buttonclicked;Post wf_stock_link('D', row)

end event

type dw_stock from u_key_enter within tabpage_2
boolean visible = false
integer x = 37
integer y = 2080
integer width = 3095
integer height = 116
integer taborder = 11
boolean titlebar = true
string title = "미연결"
string dataobject = "d_adt_00290_9"
boolean vscrollbar = true
end type

event buttonclicked;call super::buttonclicked;Post wf_stock_link('I', row)

end event

event itemerror;call super::itemerror;return 1
end event

event itemchanged;call super::itemchanged;Long nRow
Dec  dQtyPr, dSumchoice, dChoice, dValid

nRow = GetRow()
If nRow <= 0 Then REturn

Choose Case GetColumnName()
	Case 'chk'
		dQtyPr		= GetItemNumber(nRow, 'sum_qtypr')
		dSumchoice	= GetItemNumber(nRow, 'sum_choice')
		dValid		= GetItemNumber(nRow, 'stock_copy_valid_qty')

		If GetText() = 'N' Then
			SetItem(nRow, 'choice_qty', 0)
		Else
			dChoice = dQtyPr - dSumchoice
		End If
		If dValid > dChoice Then
			SetItem(nRow, 'choice_qty', dChoice)
		Else
			SetItem(nRow, 'choice_qty', dValid)
		End If
End Choose
end event

type p_14 from uo_picture within tabpage_2
boolean visible = false
integer x = 3333
integer y = 20
integer width = 178
string picturename = "..\image\재고재계산_up.gif"
end type

event clicked;call super::clicked;/* 재고내역 계산 */
Int II, iReturn
String sError, sPorgu, scolumn
Long   Lrow

If dw_tabpage2.AcceptText() <> 1 Then REturn

//-------------------------------------------------------------------------------------------------------//

// 자료 무결성 check
d_pdt_02030_strerr = create datastore
d_pdt_02030_strerr.dataobject = 'd_pdt_02030_strerr'

bomcheck = false // 작업지시 기초자료 오류여부 check

iReturn = 0
iReturn = wf_requiredchk_tabpage2(sColumn, Lrow)

If 	 iReturn = -1 then		/* 현재 화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 
		 dw_tabpage2.setcolumn(sColumn)
		 dw_tabpage2.sCrolltorow(Lrow)
		 dw_tabpage2.setrow(Lrow)
		 dw_tabpage2.setfocus()
		 return
elseif iReturn = -2 then		/* 품목 상세화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 	
		 tab_1.tabpage_3.dw_tabpage3_1.setcolumn(sColumn)
		 tab_1.tabpage_3.dw_tabpage3_1.sCrolltoRow(Lrow)
		 tab_1.tabpage_3.dw_tabpage3_1.setRow(Lrow)
		 tab_1.selecttab(3)
		 tab_1.tabpage_3.dw_tabpage3_1.setFocus()
		 return
end if

if dw_tabpage2.update() = 1 then		 
	Commit;		 
Else
	Rollback;
	w_mdi_frame.sle_msg.text = ''
	f_rollback()
	return
end if

if bomcheck  then
	rollback;
	Messagebox("Error", "작업지시 하려고 하는 품목중 오류가 있읍니다", information!)
	Openwithparm(w_pdt_02030_6, d_pdt_02030_strerr)
	destroy d_pdt_02030_strerr
	Return
End if
bomcheck = False

destroy d_pdt_02030_strerr
//-------------------------------------------------------------------------------------------------------//

w_mdi_frame.sle_msg.text = '재고내역을 계산중입니다....!!'

//프로시저 선언
DECLARE erp000000900 procedure for erp000000900(:gs_sabu, :is_sysno, :gs_saupj) ;

sError = 'X'
Execute erp000000900;

FETCH erp000000900 INTO :sError;
Choose Case sError
		 Case 'X'
				MESSAGEBOX(string(sqlca.sqlcode), SQLCA.SQLERRTEXT)
				Rollback;
				F_message_chk(41,'[재고내역 계산]')
				return;
		 Case 'Y'
				MESSAGEBOX(string(sqlca.sqlcode), SQLCA.SQLERRTEXT)
				Rollback;
				F_message_chk(89,'[재고내역 계산]')
				return;			
End Choose

COMMIT;

close erp000000900 ;

// 초기화
dw_tabpage2.SelectRow(0,false)
dw_stock.Reset()
dw_link.Reset()
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\재고재계산_dn.gif'
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\재고재계산_up.gif'
end event

type rr_9 from roundrectangle within tabpage_2
long linecolor = 28144969
integer linethickness = 1
long fillcolor = 12639424
integer x = 32
integer y = 44
integer width = 1189
integer height = 116
integer cornerheight = 40
integer cornerwidth = 55
end type

type p_4 from uo_picture within tabpage_2
integer x = 4315
integer y = 20
integer width = 178
boolean originalsize = true
string picturename = "..\image\취소_up.gif"
end type

event clicked;call super::clicked;if Messagebox("주간계획", "작업지시중입니다" + '~n' + &
							     "작업지시를 삭제하시겠읍니까?", question!, yesno!) = 2 then
	wf_reset()
	return
end if

String sError
/* 작업지시 임시자료에 의하여 계산된 부하내역을 복구시킨다(부하내역 삭제만 함). */
if isnull(is_sysno) or trim(is_sysno) = '' then
Else
	w_mdi_frame.sle_msg.text = '부하내역을 취소중입니다....!!'
	sError = 'X'
	sqlca.erp000000820(gs_sabu, is_sysno, sError);
	w_mdi_frame.sle_msg.text = ''
	Choose Case sError
			 Case 'X'
					F_message_chk(41,'[부하내역 계산]')
					Rollback;
					return -1
			 Case 'Y'
					F_message_chk(89,'[부하내역 계산]')
					Rollback;
					return -1
	End Choose
end if

/* 지시내역을 삭제 */
Delete From momast_copy 				Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 공정내역을 삭제 */
Delete From morout_copy 				Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From morout_copy_none_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 할당내역을 삭제 */
Delete From holdstock_copy 			Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 반제품 소요수량 삭제 */
Delete From momast_copy_lotsim 		Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

Delete From stock_copy 			Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From momast_hold_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From mometc_copy		 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

/* 작업지시 헤더 저장 */
update momast_head_copy set STATUS = '3' where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

Commit;

wf_reset()
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\취소_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\취소_dn.gif'
end event

type p_3 from uo_picture within tabpage_2
integer x = 3506
integer y = 20
integer width = 178
string picturename = "..\image\계산_up.gif"
end type

event clicked;call super::clicked;String 	sColumn, sReturn, sToday, sPordno, sBan, sJaje, srtnbr, spriorno, sPorgu
Long	 	Lrow, Lsqlcode, Lseq
Integer 	iGubun, iReturn, iBan, iJ
String 	ls_esdat, ls_eedat
DataWindowChild state_child


ls_esdat 	=  tab_1.tabpage_1.dw_date.getitemstring(1, "sdate")
ls_eedat 	= 	tab_1.tabpage_1.dw_date.getitemstring(1, "edate")

if dw_tabpage2.accepttext() = -1 then
	dw_tabpage2.setfocus()
	return
end if

dw_ban.accepttext() 		// 반제품 출고 기준창고
dw_jaje.accepttext()		// 부품   출고 기준창고
sBan		=	dw_ban.getitemstring(1, "ban_code")
sJaje		=	dw_jaje.getitemstring(1, "jaje_code")

String sError

sToday = f_today()

//-------------------------------------------------------------------------------------------------------//

// 임시 공정내역 삭제
Delete From morout_copy_none_copy Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Commit;

//-------------------------------------------------------------------------------------------------------//

SetPointer(HourGlass!)

dw_tabpage2.setredraw(false)
if MessageBox("자동작업지시", "자동으로 작업지시된 내역을 삭제하시겠읍니까?",Question!, yesno!) = 1 Then
	/* 기존 자동 작업지시 삭제 */
	For Lrow = 1 to dw_tabpage2.rowcount()
		 If dw_tabpage2.getitemstring(Lrow, "autocrt_yn") = 'Y' then
			 dw_tabpage2.deleterow(Lrow)
			 Lrow = Lrow - 1
		 End if
	Next
End if
dw_tabpage2.setredraw(True)	

//-------------------------------------------------------------------------------------------------------//

// 작업지시번호 재작성 및  작업지시 품목에 대한 대표품번및 품목오류 검색
w_mdi_frame.sle_msg.text = '작업지시번호를 생성하고 있읍니다...!'
Lseq = 0
For Lrow = 1 to dw_tabpage2.rowcount()
	
	//-- 오늘일자와 작업계획일자를 확인 비교하여 작업계획일자를 시작일로 Setting.
	If	ls_esdat = ls_eedat	then
		if	ls_esdat	>  f_today()	then
			dw_tabpage2.setitem(Lrow, "momast_copy_esdat", ls_esdat)	
		End If
	End If
	
	// 가상작지가 아닌경우만 작업지시번호를 채번한다
	sPorgu = dw_tabpage2.getitemstring(Lrow, "momast_copy_porgu")
	If sPorgu <> '90' Then
		setnull(spriorno)
		sPriorNo = dw_tabpage2.getitemstring(Lrow, "momast_copy_pordno")
		
//		Lseq = Lseq + 1
//		dw_tabpage2.setitem(Lrow, "momast_copy_pordno", ispordno + string(Lseq, '000') + '0')
//		spordno = ispordno + string(Lseq, '000') + '0'
		 
		 // 저장된 작업지시로 공정생성이 no이면 임시로 morout_copy를 복사한다.
		 if dw_tabpage2.getitemstring(Lrow, "momast_copy_routct") = 'N' And not isnull(sPriorno) then
			insert into morout_copy_none_copy
			Select sabu, :spordno, itnbr, pspec, opseq, de_opseq, mchcod, wkctr, jocod, purgc, uptgu, esdat,
					 eedat, estim, esinw, rstim, tsinw, ntime, lastc, fsdat, fedat, roqty, faqty, suqty, peqty, coqty, paqty,
					 nedat, ladat, wicvcod, wiunprc, pr_opseq, do_opseq, system_end_date, bajpno, rmks, watims, sttim, esset, esman, esmch,
					 esgbn, rsset, rsman, rsmch, qcgub, opdsc, roslt, system_end_date, qcgin, stdmn, master_no  
					 From morout_copy 
			 Where sabu = :gs_sabu And pordno = :sPriorno;	
			 if sqlca.sqlcode <> 0 then
				 LSqlcode = dec(sqlca.sqlcode)
				 f_message_chk(lsqlcode, "[공정복사]")
				 w_mdi_frame.sle_msg.text = ''				 
				 rollback;
				 return
			 end if
		 End if;	
	End If
Next

/* 공정내역을 삭제 :재작업지시 내역만 제외 */
Delete From morout_copy a
 Where a.sabu = :gs_sabu and a.master_no Like :iS_sysno||'%'
   and exists ( select * from momast_copy b 
	              where b.sabu = :gs_sabu 
					    and b.master_no = a.master_no 
						 and b.pordno = a.pordno
						 and b.porgu in ( '12', '14', '50', '90' ));

//-------------------------------------------------------------------------------------------------------//

// 자료 무결성 check
d_pdt_02030_strerr = create datastore
d_pdt_02030_strerr.dataobject = 'd_pdt_02030_strerr'

bomcheck = false // 작업지시 기초자료 오류여부 check

iReturn = 0
iReturn = wf_requiredchk_tabpage2(sColumn, Lrow)

If 	 iReturn = -1 then		/* 현재 화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 
		 dw_tabpage2.setcolumn(sColumn)
		 dw_tabpage2.sCrolltorow(Lrow)
		 dw_tabpage2.setrow(Lrow)
		 dw_tabpage2.setfocus()
		 return
elseif iReturn = -2 then		/* 품목 상세화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 	
		 tab_1.tabpage_3.dw_tabpage3_1.setcolumn(sColumn)
		 tab_1.tabpage_3.dw_tabpage3_1.sCrolltoRow(Lrow)
		 tab_1.tabpage_3.dw_tabpage3_1.setRow(Lrow)
		 tab_1.selecttab(3)
		 tab_1.tabpage_3.dw_tabpage3_1.setFocus()
		 return
end if

if dw_tabpage2.update() = 1 then
	// 임시로 복사한 내역을 복사
	insert into morout_copy
		Select * from morout_copy_none_copy
		 Where sabu = :gs_sabu And master_no Like :is_sysno||'%';
	 if sqlca.sqlcode <> 0 then
		 LSqlcode = dec(sqlca.sqlcode)
		 f_message_chk(lsqlcode, "[공정복사복구]")
		 w_mdi_frame.sle_msg.text = ''			 
		 rollback;
		 return
	 end if		 
		 
	Commit;		 
 
Else
	Rollback;
	w_mdi_frame.sle_msg.text = ''
	f_rollback()
	return
end if

//-------------------------------------------------------------------------------------------------------//
if bomcheck  then
	rollback;
	Messagebox("Error", "작업지시 하려고 하는 품목중 오류가 있읍니다", information!)
	Openwithparm(w_pdt_02030_6, d_pdt_02030_strerr)
	destroy d_pdt_02030_strerr
	Return
End if
bomcheck = False

destroy d_pdt_02030_strerr

//-------------------------------------------------------------------------------------------------------//

/* 작업지시 임시자료에 의하여 계산된 부하내역을 복구시킨다(부하내역 삭제만 함). */
if isnull(is_sysno) or trim(is_sysno) = '' then
Else
	w_mdi_frame.sle_msg.text = '부하내역을 취소중입니다....!!'
	sError = 'X'
	sqlca.erp000000820(gs_sabu, is_sysno, sError);
	w_mdi_frame.sle_msg.text = ''
	Choose Case sError
			 Case 'X'
					Rollback;
					F_message_chk(41,'[부하내역 계산]')
					return -1
			 Case 'Y'
					Rollback;
					F_message_chk(89,'[부하내역 계산]')
					return -1
	End Choose	
end if

//-------------------------------------------------------------------------------------------------------//
/* 작업지시 공정상세 생성 및 일정계산 */
w_mdi_frame.sle_msg.text = '작업일정을 생성중입니다....!!'

// 전체외주인 경우에는 공정상세 내역을 삭제한다
Delete 
  From morout_copy a
 Where a.sabu 		= :gs_sabu
 	And a.pordno IN (select pordno from momast_copy b where b.sabu 		= 		:gs_sabu 
	 																	 and b.master_no	Like 	:is_sysno||'%'
	 																	 and b.purgc		= 		'Y');
																		  
//-------------------------------------------------------------------------------------------------------//
Integer ii, JJ
/* 자동작업지시에 대한 검색기준을 환경설정에서 검색
	-. 자료가 없는 경우에는 기본적으로 검색을 한다.
	1:다단계, 2:단단계, 3:안함 */
	
w_mdi_frame.sle_msg.text = '자동 작업지시를 준비하고 있읍니다....!'

Ireturn = 0
Ireturn = sqlca.erp000000830_1(gs_sabu, iS_sysno);

IF Ireturn < 1 then 
	F_message_chk(41,'[작업지시 소요량 계산]' + string(ireturn) )
	w_mdi_frame.sle_msg.text = ''
End If
Commit;

Ireturn = 0
Ireturn = sqlca.erp000000830(gs_sabu, iS_sysno, sBan, '');

w_mdi_frame.sle_msg.text = ''
Choose Case Ireturn
		 Case 0
				F_message_chk(41,'[자동 작업지시 계산]')
				Rollback;
				return;
		 Case -1
				F_message_chk(89,'[자동 작업지시 계산]')
				Rollback;
				return;			
End Choose

Commit;
//-------------------------------------------------------------------------------------------------------//

// 공정상세 내역 생성
sError = 'X'

sqlca.erp000000880(gs_sabu, is_sysno, sError);

Choose Case sError
		 Case 'X'
				Rollback;
				F_message_chk(41,'[공정상세 생성]')
				JJ = dw_tabpage2.find("momast_copy_pordno = '"+ is_sysno +"'", 0, dw_tabpage2.rowcount())
				if jj > 0 then
					dw_tabpage2.scrolltorow(jj)
					dw_tabpage2.setrow(JJ)
					dw_tabpage2.setfocus()
				End if
				w_mdi_frame.sle_msg.text = ''
				return;
		 Case 'Y'
				Rollback;
				F_message_chk(89,'[공정상세 생성]')
				JJ = dw_tabpage2.find("momast_copy_pordno = '"+ is_sysno +"'", 0, dw_tabpage2.rowcount())
				if jj > 0 then
					dw_tabpage2.scrolltorow(jj)
					dw_tabpage2.setrow(JJ)
					dw_tabpage2.setfocus()
				End if				
				w_mdi_frame.sle_msg.text = ''				
				return;			
End Choose
Commit;

//-------------------------------------------------------------------------------------------------------//
/* 작업지시 헤더 저장 */
update momast_head_copy set calc2 = 'Y' where sabu = :gs_sabu and master_no = :is_sysno;
Commit;	
/* ------------------ */

/* 작업지시 공정 일정 계산 */
w_mdi_frame.sle_msg.text = '작업일정을 계산중입니다....!!'

II = 0
II = sqlca.erp000000810(gs_sabu, is_sysno);
Choose Case Ii
		 Case 0
				F_message_chk(41,'[공정일정 계산]')
				Rollback;
				w_mdi_frame.sle_msg.text = ''
				return;
		 Case -1
				F_message_chk(89,'[공정일정 계산]')
				Rollback;
				w_mdi_frame.sle_msg.text = ''
				return;			
		 Case -2
				F_message_chk(205,'[공정일정 계산]')
				Rollback;
				return;			
End Choose
Commit;
//-------------------------------------------------------------------------------------------------------//

/* 작업지시 헤더 저장 */
update momast_head_copy set calc3 = 'Y' where sabu = :gs_sabu and master_no = :is_sysno;
Commit;	
/* ------------------ */

/* 작업지시를 다시 조회한다. */
String 	sYymm, sSdate, sEdate
integer	iMaxseq

w_mdi_frame.sle_msg.text = '작업지시를 조회중입니다....!!'
sYymm 	= tab_1.tabpage_1.dw_date.getitemstring(1, "gidate")
sSdate	= tab_1.tabpage_1.dw_date.getitemstring(1, "sdate")
sEdate	= tab_1.tabpage_1.dw_date.getitemstring(1, "edate")

/* 해당년월의 연동계획에 대한 최대차수 검색 */
select max(moseq) into :iMaxseq from monpln_sum 
 where sabu = :gs_sabu and monyymm = :sYymm;
tab_1.tabpage_3.dw_tabpage3_1.retrieve(gs_sabu, is_sysno)
tab_1.tabpage_2.dw_tabpage2.retrieve(gs_sabu, is_sysno, gs_saupj, syymm, imaxseq, ssdate, sedate)

if tab_1.tabpage_2.dw_tabpage2.rowcount() > 0 then
	commit;
else
	Messagebox("일정계산", "지시할 품목이 없읍니다..!!", information!)
	w_mdi_frame.sle_msg.text = ''
	return
End if

//-------------------------------------------------------------------------------------------------------//

/* 작업지시에 대한 할당을 작성 - 단 할당생성을 check한 경우 */
If cbx_jaje.Checked Then
	If wf_hold_jaje() <> 1 Then Return
	
//	w_mdi_frame.sle_msg.text = '할당내역을 적상중입니다....!!'
//	
//	For Lrow = 1 to dw_tabpage2.rowcount()
//		
//		 sPordno = dw_tabpage2.getitemstring(Lrow, "momast_copy_pordno")
//		 
//		 /* 할당내역 생성이 아니면 BOM을 검색안 함 */
//		 if dw_tabpage2.getitemstring(Lrow, "momast_copy_holdct") = 'N' then continue;
//	
//		/* 할당번호 채번 */
//		iJ = sqlca.fun_junpyo(gs_sabu, stoday, 'B0')
//		if iJ < 1 then
//			rollback;
//			f_message_chk(51,'[할당번호]') 
//			return -1
//		end if
//		
//		/* 할당번호작성(12자리 기준) */
//		isholdno = stoday + String(iJ, '0000')	
//		Commit;
//	
//		sError = 'X'
//		sqlca.erp000000840(gs_sabu, spordno, isholdno, sError);
//	
//		Choose Case sError
//				 Case 'X'
//						Rollback;
//						F_message_chk(41,'[할당내역 계산]')
//						return;
//				 Case 'Y'
//						Rollback;
//						F_message_chk(89,'[할당내역 계산]')
//						return;			
//		End Choose
//		
//		// 출고예정창고를 Update
//		Update HoldsTock_copy a
//			Set hold_store = (select Decode(b.ittyp, '2', :sBan, :sJaje) as chango
//									  From Itemas b
//									 Where b.itnbr = a.itnbr)
//		 Where a.sabu = :gs_sabu and a.hold_no like :isholdno||'%';
//	Next
//	
//	Commit;
//	
//	/* 작업지시 헤더 저장 */
//	update momast_head_copy set calc4 = 'Y' where sabu = :gs_sabu and master_no = :is_sysno;
//	Commit;
End If
/* ------------------ */

//-------------------------------------------------------------------------------------------------------//

/* 공정별 일정에 대한 부하내역을 적상 */
//w_mdi_frame.sle_msg.text = '부하내역을 적상중입니다....!!'
//
//sError = 'X'
//sqlca.erp000000820_1(gs_sabu, is_sysno, sError);
//Choose Case sError
//		 Case 'X'
//				Rollback;
//				F_message_chk(41,'[부하내역 계산]')
//		 Case 'Y'
//				Rollback;
//				F_message_chk(89,'[부하내역 계산]')
//End Choose
//
///* 계산내역을 저장한다 */
//Commit;

/* 품목상세, 자재검토, 부하검토 사용가능 */
tab_1.tabpage_1.enabled = false
tab_1.tabpage_3.enabled = true

// 소요량 계산후 작업지시버튼 활성화
//p_last.enabled = true
//p_last.PictureName = "..\image\작업지시_up.gif"
p_jaje.enabled = true
p_jaje.PictureName = "..\image\소요자재_up.gif"

//// 작업지시가 생성된 작업장 내역을 조회
//tab_1.tabpage_3.dw_wkctr.Reset()
//iReturn = tab_1.tabpage_3.dw_wkctr.GetChild('wkctr', state_child)
//state_child.SetTransObject(SQLCA)
//state_child.Retrieve(gs_sabu, is_sysno)
//tab_1.tabpage_3.dw_wkctr.SetTransObject(SQLCA)
//tab_1.tabpage_3.dw_wkctr.InsertRow(0)
//
//tab_1.tabpage_3.dw_tabpage3_2.Reset()
//tab_1.tabpage_3.dw_etc.Reset()
ib_rcal = true

SetPointer(Arrow!)

w_mdi_frame.sle_msg.text = ''
tab_1.tabpage_2.setfocus()
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\계산_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\계산_dn.gif'
end event

type p_2 from uo_picture within tabpage_2
integer x = 2752
integer y = 20
integer width = 178
string picturename = "..\image\행삭제_up.gif"
end type

event clicked;call super::clicked;Long lrow

String sPordno, sMaster_parent

Lrow = dw_tabpage2.getrow()
If Lrow > 0 then
 
	if isnull(dw_tabpage2.getitemstring(lrow, "momast_copy_itnbr")) or &
		Trim(dw_tabpage2.getitemstring(lrow, "momast_copy_itnbr")) = '' then
		dw_tabpage2.deleterow(Lrow)
	else
	
	//	If dw_tabpage2.getitemstring(Lrow, "momast_copy_porgu") = '90' Then
	//		MessageBox('확인','가상작지는 삭제하실수 없습니다.!!')
	//		Return
	//	End If
		
	  if Messagebox("삭제확인", "품목 -> " + dw_tabpage2.getitemstring(Lrow, "itemas_itdsc") + '~n' + &
					" 를 삭제하시겠읍니까?" + '~n' + &
					" 하위작지 연결된 내역도 동시에 삭제됩니다", question!, yesno!) = 1 then
					
			sPordno = dw_tabpage2.getitemstring(Lrow, "momast_copy_pordno")
			 
			dw_tabpage2.deleterow(Lrow) 
			/* 품목 상세화면 삭제 */
			tab_1.tabpage_3.dw_tabpage3_1.deleterow(Lrow)
			tab_1.tabpage_3.dw_tabpage3_2.reset()
			
			For Lrow = 1 to dw_tabpage2.rowcount()
			  sMaster_Parent = dw_tabpage2.getitemstring(Lrow, "momast_copy_pordno") 
			  if sPordno = dw_tabpage2.getitemstring(Lrow, "momast_copy_master_parent") then
				dw_tabpage2.deleterow(Lrow)
				tab_1.tabpage_3.dw_tabpage3_1.deleterow(Lrow)   
				
				/* 공정내역을 삭제 */
				Delete From morout_copy   Where sabu = :gs_sabu and pordno = :sMaster_parent and master_no = :is_sysno;
				/* 할당내역을 삭제 */
				Delete From holdstock_copy Where sabu = :gs_sabu and pordno = :sMaster_parent  and master_no = :is_sysno;
				/* 연결 내역 삭제 */
				DELETE FROM momast_hold_copy Where sabu = :gs_sabu and pordno = :sMaster_parent  and master_no = :is_sysno;
				
				Lrow = Lrow - 1
				 End if
			Next
		
			/* 작업지시번호가 채번된 경우에만 삭제한다 */
			if  isnull(spordno) or trim(spordno) = '' then
			Else
				 if dw_tabpage2.update() = 1 then
					  /* 공정내역을 삭제 */
					  Delete From morout_copy  Where sabu = :gs_sabu and pordno = :sPordno and master_no = :is_sysno;
					  /* 할당내역을 삭제 */
					  Delete From holdstock_copy Where sabu = :gs_sabu and pordno = :sPordno and master_no = :is_sysno;
					  /* 연결 내역 삭제 */
					  DELETE FROM momast_hold_copy Where sabu = :gs_sabu and pordno = :sPordno  and master_no = :is_sysno;
						
					  commit;
					  						
					  ib_rcal = True
				 else
					  rollback;
					  f_rollback()
				 end if
			end if
		
	  end if
 end if
end if

dw_tabpage2.setfocus()


end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\행삭제_dn.gif'
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\행삭제_up.gif'
end event

type p_tabpage2_insert from uo_picture within tabpage_2
integer x = 2578
integer y = 20
integer width = 178
string picturename = "..\image\행추가_up.gif"
end type

event clicked;call super::clicked;Long 		Lrow, lMax, nRow, nSeq
String	sDepotNo, sPordno

/* 입고예정창고 선택 */
sDepotNo = wf_DepotNo('1', '')

If tab_1.tabpage_2.dw_tabpage2.RowCount() = 0 Then
	lMax = 0
Else
	lMax = Long(tab_1.tabpage_2.dw_tabpage2.GetItemString(1, 'maxseq'))
End If

// 지시번호 생성
lMax = lMax + 1
sPordno = ispordno + string(lMax, '000') + '0'

nRow = tab_1.tabpage_2.dw_tabpage2.GetRow()
If nRow = 0 Then nRow = tab_1.tabpage_2.dw_tabpage2.RowCount()

/* 순위 결정 */
If nRow = 0 Then
	nSeq = 10
Else
	If nRow = tab_1.tabpage_2.dw_tabpage2.RowCount() Then
		nSeq = tab_1.tabpage_2.dw_tabpage2.GetItemNumber(nRow, 'momast_copy_mocnt')
		nSeq += 10
	Else
		nSeq = round((tab_1.tabpage_2.dw_tabpage2.GetItemNumber(nRow, 'momast_copy_mocnt') + tab_1.tabpage_2.dw_tabpage2.GetItemNumber(nRow+1, 'momast_copy_mocnt'))/2,0)
	End If
End If

/* 품목화면에 삽입 */
Lrow = 	tab_1.tabpage_2.dw_tabpage2.insertrow(nRow+1)
tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow,"momast_copy_ipchango",	sDepotNo)     // 출고창고			
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_sabu", gs_sabu)
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pordno", sPordno)
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_jidat", tab_1.tabpage_1.dw_date.getitemstring(1, "jdate")) //f_today()
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_esdat", tab_1.tabpage_1.dw_date.getitemstring(1, "jdate"))
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_fsdat", tab_1.tabpage_1.dw_date.getitemstring(1, "jdate"))
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pdsts", '1')
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_purgc", 'N')
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "pagbn", 'N')
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_master_no", is_sysno)
tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_matchk", '2')
tab_1.tabpage_2.dw_tabpage2.SetItem(Lrow, 'momast_copy_mocnt', nSeq)

/* 상세화면에 삽입 */
tab_1.tabpage_3.dw_tabpage3_1.insertrow(0)	
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow,"momast_copy_ipchango",	sDepotNo)     // 출고창고			
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_sabu", gs_sabu)
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_pordno", sPordno)
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_jidat", tab_1.tabpage_1.dw_date.getitemstring(1, "jdate"))
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_pdsts", '1')
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_purgc", 'N')
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "pagbn", 'N')
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_master_no", is_sysno)
tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_matchk", '2')
				
dw_tabpage2.scrolltorow(Lrow)
dw_tabpage2.setrow(Lrow)
dw_tabpage2.setcolumn("momast_copy_itnbr")
dw_tabpage2.setfocus()
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\행추가_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\행추가_dn.gif'
end event

type p_12 from uo_picture within tabpage_2
boolean visible = false
integer x = 1472
integer y = 12
integer width = 178
string picturename = "..\image\요약보고_up.gif"
end type

event clicked;call super::clicked;gs_code = is_sysno

open(w_pdt_02030_7)

setnull(gs_code)
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\요약보고_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\요약보고_dn.gif'
end event

type p_auto from uo_picture within tabpage_2
integer x = 2930
integer y = 20
integer width = 178
string picturename = "..\image\저장_up.gif"
end type

event clicked;call super::clicked;String 	sColumn
Integer	iReturn
Long		Lrow, ix
Dec      dPdqty, dPdmqty, dOldqty

if dw_tabpage2.accepttext() = -1 then
	dw_tabpage2.setfocus()
	return
end if

SetPointer(HourGlass!)


// 자료 무결성 check
d_pdt_02030_strerr = create datastore
d_pdt_02030_strerr.dataobject = 'd_pdt_02030_strerr'

bomcheck = false // 작업지시 기초자료 오류여부 check

iReturn = 0
iReturn = wf_requiredchk_tabpage2(sColumn, Lrow)

If 	 iReturn = -1 then		/* 현재 화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 
		 dw_tabpage2.setcolumn(sColumn)
		 dw_tabpage2.sCrolltorow(Lrow)
		 dw_tabpage2.setrow(Lrow)
		 dw_tabpage2.setfocus()
		 return
elseif iReturn = -2 then		/* 품목 상세화면에서 복구할 수 있는 ERROR인 경우 */
		 Rollback;
		 w_mdi_frame.sle_msg.text = ''		 	
		 tab_1.tabpage_3.dw_tabpage3_1.setcolumn(sColumn)
		 tab_1.tabpage_3.dw_tabpage3_1.sCrolltoRow(Lrow)
		 tab_1.tabpage_3.dw_tabpage3_1.setRow(Lrow)
		 tab_1.selecttab(3)
		 tab_1.tabpage_3.dw_tabpage3_1.setFocus()
		 return
end if

//-------------------------------------------------------------------------------------------------------//
if bomcheck  then
	rollback;
	Messagebox("Error", "작업지시 하려고 하는 품목중 오류가 있읍니다", information!)
	Openwithparm(w_pdt_02030_6, d_pdt_02030_strerr)
	destroy d_pdt_02030_strerr
	Return
End if
bomcheck = False

destroy d_pdt_02030_strerr

//-------------------------------------------------------------------------------------------------------//

if dw_tabpage2.update(true, false) = 1 then
	// 수량변경시 morout_copy도 동시에 변경한다
	For ix = 1 To dw_tabpage2.RowCount()
		dPdqty  = dw_tabpage2.GetItemNumber(ix, 'momast_copy_pdqty')
		dPdmqty = dw_tabpage2.GetItemNumber(ix, 'momast_copy_pdmqty')
		dOldqty = dw_tabpage2.GetItemNumber(ix, 'old_pdqty')
		sColumn = dw_tabpage2.GetItemString(ix, 'momast_copy_pordno')
		
		If IsNull(dOldqty) then dOldqty = 0
		
		If dw_tabpage2.GetItemNumber(ix, 'old_pdqty') <> dpdqty And dOldqty > 0 And &
		   dw_tabpage2.GetItemStatus(ix, 0, Primary!) = DataModified! Then
			UPDATE MOROUT_COPY
			   SET PDQTY = :dpdqty,
				    ESMAN = ROUND(ESMAN / :doldqty * :dpdqty,0),
					 ESMCH = ROUND(ESMCH / :doldqty * :dpdqty,0),
					 ESTIM = ROUND(ESMAN / :doldqty * :dpdqty,0) + ROUND(ESMCH / :doldqty * :dpdqty,0)
			 WHERE SABU = :gs_sabu
			   AND PORDNO = :sColumn
				AND MASTER_NO = :is_sysno;
				
			// 공정변경
			ib_rcal = true
		End If
	Next
	 
	Commit;		 
 
 	dw_tabpage2.resetupdate()
Else
	Rollback;
	w_mdi_frame.sle_msg.text = ''
	f_rollback()
	return
end if

// 저장후 재조회
tab_1.tabpage_2.dw_tabpage2.retrieve(gs_sabu, is_sysno, gs_saupj)

SetPointer(Arrow!)

w_mdi_frame.sle_msg.text = ''
tab_1.tabpage_2.setfocus()
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\저장_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\저장_dn.gif'
end event

type p_last from uo_picture within tabpage_2
integer x = 3854
integer y = 20
integer width = 178
string picturename = "..\image\작업지시_d.gif"
end type

event clicked;call super::clicked;Long Lsqlcode

// 현재화면을 품목일반화면으로 전환(수정자료들이 Update됨)
tab_1.selecttab(2)

w_mdi_frame.sle_msg.text = '작업지시 자료를 변환중입니다......!!'

// 자료 무결성 check
INTEGER iReturn
String sColumn
Long Lrow

iReturn = 0
iReturn = wf_requiredchk_tabpage2_final(sColumn, Lrow)
w_mdi_frame.sle_msg.text = '자료를 Check중입니다.'

If 	 iReturn = -1 then		/* 현재 화면에서 복구할 수 있는 ERROR인 경우 */
		 dw_tabpage2.setcolumn(sColumn)
		 dw_tabpage2.sCrolltorow(Lrow)
		 dw_tabpage2.setrow(Lrow)
		 dw_tabpage2.setfocus()
		 Rollback;
		 return
elseif iReturn = -2 then		/* 품목 상세화면에서 복구할 수 있는 ERROR인 경우 */
		 tab_1.tabpage_3.dw_tabpage3_1.setcolumn(sColumn)
		 tab_1.tabpage_3.dw_tabpage3_1.sCrolltoRow(Lrow)
		 tab_1.tabpage_3.dw_tabpage3_1.setRow(Lrow)
		 tab_1.selecttab(3)
		 tab_1.tabpage_3.dw_tabpage3_1.setFocus()
		 Rollback;
		 return
end if

if wf_update() = -1 then
	rollback;
	w_mdi_frame.sle_msg.text = ''
   return
end if

w_mdi_frame.sle_msg.text = '작업지시를 진행중입니다.'

if tab_1.tabpage_2.dw_tabpage2.update() = 1 then
	Commit;
Else
	Rollback;
	w_mdi_frame.sle_msg.text = ''
	f_rollback()	
	return
End if

// 작업예정일자를 update한다
update momast_copy a
   set ( a.fsdat, a.fedat ) = ( select min(b.fsdat), max(b.fedat)
	                               from morout_copy b
											where b.sabu = a.sabu and b.pordno = a.pordno and b.master_no = a.master_no )
 where a.sabu = :gs_sabu
   and a.master_no Like :iS_sysno||'%';
If sqlca.sqlcode <> 0 then
	rollback;
	LSqlcode = dec(sqlca.sqlcode)
	f_message_chk(lsqlcode, "[작업지시head]")
	w_mdi_frame.sle_msg.text = ''	
	return
End if


// 작업지시 head의 내역을 저장
Insert Into momast 
	(sabu, 	pordno, 	jidat,	itnbr,	pspec,		porgu, 		pdtgu,		esdat,	eedat,
	 fsdat,	fedat,	pdqty,	roqty,	peqty,		wtqty,		waqty,		paqty,	pdsts,
	 purgc,	cvcod,	unprc,	assiqt,	pa_pordno,	pa_ospeq,	st_opseq,	system_end_date,	bajpno,	
	 crt_user, 			ipchango,stditnbr,pjt_no,		matchk,		reqno,		reqate,	pdprc,
	 holdct, routct,  timect,  mogubn,  system_str_date,
	 cnfdat, parent_pordno,    			order_no,   asseq,
	 master_no,			master_parent,		kumno,      untno,      kestno, 		fstim,	fetim,   custno)
 Select 
	 sabu, 	pordno, 	jidat,	itnbr,	pspec,		porgu, 		pdtgu,		fsdat,	fedat,
	 fsdat,	fedat,	pdqty,	roqty,	peqty,		wtqty,		waqty,		paqty,	pdsts,
	 purgc,	cvcod,	unprc,	assiqt,	pa_pordno,	pa_ospeq,	st_opseq,	system_end_date,	bajpno,	
	 :gs_userid, 	 	ipchango,stditnbr, project_no,matchk,		reqno,		reqate,	pdprc,
	 holdct, routct,  timect,  mogubn,  system_str_date,
	 Decode(matchk, '2', to_char(sysdate, 'yyyymmdd'), null), 
	 parent_pordno,   					   order_no,   asseq,
 	 master_no,			master_parent,		kumno,      untno,      kestno, 		fstim,	fetim,   custno
   from momast_copy 
  Where sabu = :gs_sabu and master_no Like :iS_sysno||'%' and porgu in ( '12', '20', '14', '50' );
  
If sqlca.sqlcode <> 0 then
	rollback;
	LSqlcode = dec(sqlca.sqlcode)
	f_message_chk(lsqlcode, "[작업지시head]")
	w_mdi_frame.sle_msg.text = ''	
	return
End if
   
// 작업지시 공정상세의 내역을 저장
Insert into morout
	(sabu,		pordno,		itnbr,		pspec,		opseq,		de_opseq,			mchcod,
	 wkctr,		jocod,		purgc,		uptgu,		esdat,		eedat,				estim,
	 esinw,		rstim,		tsinw,		ntime,		lastc,		fsdat,				fedat,
	 roqty,		faqty,		suqty,		peqty,		coqty,		paqty,				nedat,
	 ladat,		wicvcod,		wiunprc,		pr_opseq,	do_opseq,	system_end_date,	bajpno,
	 rmks,		watims,		sttim,		esset,		esman,		esmch,				esgbn,
	 rsset,		rsman,		rsmch,		qcgub,		opdsc,		roslt,				system_str_date,	qcgin,  stdmn,
	 master_no, fstim,      fetim,      pdqty,      moseq) 
 Select 
	 a.sabu,		a.pordno,	a.itnbr,		a.pspec,		a.opseq,		a.de_opseq,			a.mchcod,
	 a.wkctr,	a.jocod,		a.purgc,		a.uptgu,		a.fsdat,		a.fedat,				a.estim,
	 a.esinw,	a.rstim,		a.tsinw,		a.ntime,		a.lastc,		a.fsdat,				a.fedat,
	 a.roqty,	a.faqty,		a.suqty,		a.peqty,		a.coqty,		a.paqty,				a.nedat,
	 a.ladat,	a.wicvcod,	a.wiunprc,	a.pr_opseq,	a.do_opseq,	a.system_end_date,a.bajpno,
	 a.rmks,		a.watims,	a.sttim,		a.esset,		a.esman,		a.esmch,				a.esgbn,
	 a.rsset,	a.rsman,		a.rsmch,		a.qcgub,		a.opdsc,		a.roslt,				a.system_str_date,	a.qcgin,  a.stdmn,
	 a.master_no, a.fstim,  a.fetim,    a.pdqty,    a.moseq
 	From Morout_copy a, momast_copy b
  Where b.sabu = :gs_sabu and b.master_no Like :iS_sysno||'%'
    and b.porgu in ( '12','14','20', '50' )
	 and a.sabu = b.sabu
	 and a.pordno = b.pordno;
  
If sqlca.sqlcode <> 0 then
	rollback;
	LSqlcode = dec(sqlca.sqlcode)
	f_message_chk(lsqlcode, "[작업지시공정]")
	w_mdi_frame.sle_msg.text = ''		
	return
End if

// 가상작지에 대한 내역을 저장
update momast a set ( a.pdqty, a.fedat, a.fsdat ) = ( select b.pdqty, b.fedat, b.fsdat 
                                                        from momast_copy b 
																		 where b.sabu = a.sabu and b.pordno = a.pordno and b.master_no = :is_sysno)
 where exists ( select * from momast_copy c where c.sabu = a.sabu and c.pordno = a.pordno and c.porgu = '90'  and c.master_no = :is_sysno);
If sqlca.sqlcode <> 0 then
	rollback;
	LSqlcode = dec(sqlca.sqlcode)
	f_message_chk(32, "[가상작지 head]")
	w_mdi_frame.sle_msg.text = ''	
	return
End if

update morout a set ( a.pdqty, a.fsdat, a.fedat, a.fstim, a.fetim,   wkctr,   jocod ) = 
             ( select b.pdqty, b.fsdat, b.fedat, b.fstim, b.fetim, b.wkctr, b.jocod from morout_copy b where b.sabu = a.sabu and b.pordno = a.pordno and a.opseq = b.opseq and b.master_no = :is_sysno)
 where exists ( select * from morout_copy c where c.sabu = a.sabu and c.pordno = a.pordno and c.opseq = a.opseq and c.master_no = :is_sysno);
If sqlca.sqlcode <> 0 then
	rollback;
	LSqlcode = dec(sqlca.sqlcode)
	f_message_chk(32, "[가상작지 공정]")
	w_mdi_frame.sle_msg.text = ''
	return
End if

// 할당내역을 저장
// 에이스디지텍은 할당처리에 의해 자재소진하지 않고 사용자가 직접 출고시킨다
// 따라서 작지시 할당요청은 자재창고에서 생산창고로 이동전표만 만들어 준다
Insert into holdstock
	(sabu,		hold_no,		hold_date,		hold_gu,		itnbr,		pspec,		hold_qty,
	 addqty,		isqty,		unqty,			hold_store,	out_store,	req_dept,	rqdat,
	 isdat,		order_no,	pordno,			out_chk,		naougu,		in_store,	pjtno,
	 hosts,		opseq,		cancelqty,     buwan,      crt_user,	hyebia4,		lotno,
	 hyebia3)
 Select 
	 sabu,		hold_no,		hold_date,		hold_gu,		itnbr,		pspec,		hold_qty,
	 0,			0,				0,					null,	hold_store,	req_dept,	rqdat,
	 isdat,		order_no,	pordno,			out_chk,		naougu,		out_store,	pjtno,
	 hosts,		opseq,		0,  			   'N',        :gs_userid,	area_cd,		lotno,
	 field_cd 
 	From holdstock_copy
  Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
  
If sqlca.sqlcode <> 0 then
	rollback;
	LSqlcode = dec(sqlca.sqlcode)
	f_message_chk(lsqlcode, "[할당내역]")
	w_mdi_frame.sle_msg.text = ''		
	return
End if

// 반제품 연결 정보를 저장
insert into momast_hold
 ( SABU, MASTER_NO, PORDNO, CHILD_PORDNO, GUBUN, DEPOT_NO, ITNBR, PSPEC, HOLD_QTY )
 select SABU, MASTER_NO, PORDNO, CHILD_PORDNO, GUBUN, DEPOT_NO, ITNBR, PSPEC, HOLD_QTY
   from momast_hold_copy
  where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
If sqlca.sqlcode <> 0 then
	rollback;
	LSqlcode = dec(sqlca.sqlcode)
	f_message_chk(lsqlcode, "[반제품 연결 내역]")
	w_mdi_frame.sle_msg.text = ''		
	return
End if

// 외주 발주예정 내역을 저장
String sError
sError = 'X';

w_mdi_frame.sle_msg.text = '외주 발주예정내역을 생성중입니다....!!'
sError = 'X'
sqlca.erp000000850(gs_sabu, is_sysno, sError);
w_mdi_frame.sle_msg.text = ''
Choose Case sError
		 Case 'X'
				w_mdi_frame.sle_msg.text = ''
				F_message_chk(41,'[발주예정내역 계산]')
				Rollback;
				return 
		 Case 'Y'
				w_mdi_frame.sle_msg.text = ''
				F_message_chk(89,'[발주예정내역 계산]')
				Rollback;
				return 
End Choose

//////////////////////////////////////////////////////////////////////
// 기타일정 정보를 저장
string sfsdat, sfedat

select min(fsdat), max(fsdat) into :sfsdat, :sfedat
  from mometc_copy
 where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

// 기존일정은 삭제후 다시 INSERT한다
//delete from mometc a
// where sabu = :gs_sabu and fsdat between :sfsdat and :sfedat
//   and wkctr in ( select distinct wkctr from mometc_copy  where sabu = :gs_sabu and master_no Like :iS_sysno||'%' );
//delete from mometc a
// where exists ( select * 
//                  from mometc_copy b 
//					  where b.sabu = a.sabu   and b.wkctr = a.wkctr 
//					    and b.fsdat = a.fsdat and b.fedat = a.fedat 
//						 and b.fstim = a.fstim and b.fetim = a.fetim
//						 and b.master_no Like :iS_sysno||'%' );
//If sqlca.sqlcode <> 0 then
//	rollback;
//	LSqlcode = dec(sqlca.sqlcode)
//	f_message_chk(lsqlcode, "[기타일정 내역]")
//	w_mdi_frame.sle_msg.text = ''		
//	return
//End if

delete from mometc where sabu = :gs_sabu and fsdat = :sfsdat;

insert into mometc
 ( SABU, MASTER_NO, MSTSEQ, WKCTR, FSDAT, FEDAT, FSTIM, FETIM, ESTIM, REMARK, INWON_NM )
 select SABU, MASTER_NO, MSTSEQ, WKCTR, FSDAT, FEDAT, FSTIM, FETIM, ESTIM, REMARK, INWON_NM
   from mometc_copy
  where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
If sqlca.sqlcode <> 0 then
	rollback;
	LSqlcode = dec(sqlca.sqlcode)
	f_message_chk(lsqlcode, "[기타일정 내역]")
	w_mdi_frame.sle_msg.text = ''		
	return
End if
//////////////////////////////////////////////////////////////////////

Commit;

String 	ls_saupj
ls_saupj	= dw_saupj.GetItemString(1,"saupj")

/* 수주연결을 자동으로 한다. */
w_mdi_frame.sle_msg.text = '수주연결을 자동으로 생성중입니다....!!'
sError = 'X'

sqlca.erp000000860(gs_sabu, ls_saupj,  is_sysno, sError);
w_mdi_frame.sle_msg.text = ''
Choose Case sError
		 Case 'X'
				w_mdi_frame.sle_msg.text = ''
			   MessageBox("확 인", "수주연결 자동생성을 실패 하였습니다", stopsign!)
		 Case 'Y'
				w_mdi_frame.sle_msg.text = ''
			   MessageBox("확 인", "수주연결 자동생성을 실패 하였습니다", stopsign!)
End Choose

commit;

/* 작업지시 임시자료에 의하여 계산된 부하내역을 복구시킨다(부하내역 삭제만 함). */
if isnull(is_sysno) or trim(is_sysno) = '' then
Else
	w_mdi_frame.sle_msg.text = '부하내역을 취소중입니다....!!'
	sError = 'X'
	sqlca.erp000000820(gs_sabu, is_sysno, sError);
	w_mdi_frame.sle_msg.text = ''
	Choose Case sError
			 Case 'X'
					F_message_chk(41,'[부하내역 계산]')
					Rollback;
					return -1
			 Case 'Y'
					F_message_chk(89,'[부하내역 계산]')
					Rollback;
					return -1
	End Choose
end if
/* 작업의 인원 내역 처리 */
insert into morout_etc
 ( SABU, PORDNO, OPSEQ, MASTER_NO, INWON_NM, WKCTR, KUNTYPE )
 select SABU, PORDNO, OPSEQ, MASTER_NO, INWON_NM, WKCTR, KUNTYPE
   from morout_etc_copy
  where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

/* 지시내역을 삭제 */
Delete From momast_copy 				Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 공정내역을 삭제 */
Delete From morout_copy 				Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From morout_copy_none_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 할당내역을 삭제 */
Delete From holdstock_copy 			Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 반제품 소요수량 삭제 */
Delete From momast_copy_lotsim 		Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

Delete From stock_copy 			Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From momast_hold_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
Delete From mometc_copy 	Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';
/* 작업의 인원 내역 처리 */
Delete From morout_etc_copy Where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

/* 작업지시 헤더 저장 */
update momast_head_copy set jidat = to_char(sysdate,'YYYYMMDD'), STATUS = '2' where sabu = :gs_sabu and master_no Like :iS_sysno||'%';

Commit;

w_mdi_frame.sle_msg.text = ''
Messagebox("작업지시", "작업지시를 저장하였읍니다", information!)

wf_reset()
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\작업지시_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\작업지시_dn.gif'
end event

type dw_tabpage2 from datawindow within tabpage_2
event ue_processenter pbm_dwnprocessenter
event ue_key pbm_dwnkey
event ue_mousemove pbm_mousemove
event ue_bup pbm_lbuttonup
event ue_bdown pbm_lbuttondown
integer x = 46
integer y = 176
integer width = 4439
integer height = 1992
integer taborder = 40
string dragicon = "WinLogo!"
boolean bringtotop = true
string dataobject = "d_adt_00290_3"
boolean hscrollbar = true
boolean vscrollbar = true
boolean border = false
boolean hsplitscroll = true
boolean livescroll = true
end type

event ue_processenter;Send(Handle(this),256,9,0)
Return 1
end event

event ue_key;Long lrow
lrow = this.getrow()

if keydown(keyf1!) then
	this.triggerevent(rbuttondown!)
end if

IF keydown(keyF2!) THEN
	IF This.GetColumnName() = "momast_copy_itnbr" Then
		open(w_itemas_popup2)
		if isnull(gs_code) or gs_code = "" then return
		
		this.SetItem(this.getrow(),"momast_copy_itnbr",gs_code)
		this.TriggerEvent(ItemChanged!)
	end if
END IF

end event

event ue_mousemove;/* --------------------------------------------------------------- */
/* 마우스를 누른체 움직일 경우 drag                                */
/* --------------------------------------------------------------- */
string  ls_col,ls_colnm

int		li_row,li_pos

ls_col = this.GetObjectAtPointer() 

if Len (ls_col) > 0 then
	drag_start_row = 0
	li_pos = Pos (ls_col, '~t')

   /* row와 column name을 구분 */ 
	if li_pos > 0 then
		li_row = Integer (Right (ls_col, Len (ls_col) - li_pos))
		ls_colnm = Trim(Left(ls_col,li_pos - 1))
	Else
		Return
	end if

   /* 해당 column에서만 drag 가능 */
   If ls_colnm <> 'itemas_itdsc' And ls_colnm <> 'itemas_ispec' Then Return
   If li_row <= 0 Then Return
	
	/* 마으스버튼이 눌릴경우 ue_bdown */
	if ib_down then
		this.Drag (begin!)
      drag_start_row = li_row
	end if

end if
end event

event ue_bup;ib_down = false

This.Drag(End!)
end event

event ue_bdown;string  ls_col,ls_colnm
int		li_row,li_pos

ls_col = this.GetObjectAtPointer() 

if Len (ls_col) > 0 then
	drag_start_row = 0
	li_pos = Pos (ls_col, '~t')

	if li_pos > 0 then
		li_row = Integer (Right (ls_col, Len (ls_col) - li_pos))
		ls_colnm = Trim(Left(ls_col,li_pos - 1))
	Else
		Return
	end if

   If li_row <= 0 Then Return
	
   If ls_colnm = 'iteams_itdsc' Or ls_colnm = 'itemas_ispec' Then
		sle_msg.Text = ''
		SetRow(li_row)
      ib_down = true
   Else
//		messagebox('','*'+ls_colnm+'*')
		sle_msg.Text = 'Drag & Drop은 품명과 규격에서만 가능합니다!!'
		ib_down = False
	End If
End if



end event

event itemchanged;string   snull, sitnbr, sreff, sreff1, sitdsc, sispec, sjijil, sispec_code, scvcod, &
			sdptno, spurgc, sporgu, scvnas, stuncu, sIogbn, sDptstock, sPordno, usechk, sPdtgu, stime, sItmsht, sCarcode
String   ls_pspec, sOldPorgu
long     lrow, Lrow1, Lchk 
integer  ireturn
Decimal  {5} dunprc

setnull(snull)

lrow   = getrow()

If Getcolumnname() = "momast_copy_porgu" Then
	sOldPorgu = GetItemString(lrow, 'momast_copy_porgu')
End If

accepttext()

// 생산팀 체크
sPdtgu = Trim(tab_1.tabpage_1.dw_date.GetItemString(1, 'steam'))
If IsNull(sPdtgu) Or sPdtgu = '' Then
	f_message_chk(1400,'생산팀')
	Return 2
End If

/* 작업지시구분 check */
Choose Case  Getcolumnname()
	Case "momast_copy_porgu" 
		sporgu = Trim(GetText())
		If sPorgu = '12' Or sPorgu = '20' Or sPorgu = '50' Then
		Else
			f_message_chk(79,'[작업지시구분]') 
			SetItem(lrow, 'momast_copy_porgu', sOldPorgu)
			Return 1
		End If
		
//		tab_1.tabpage_2.p_last.enabled = false
//		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_porgu", gettext())
//		if isnull(f_get_reffer('60', gettext())) then
//			f_message_chk(79,'[작업지시구분]') 
//			setitem(lrow, "momast_copy_porgu", '')
//			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_porgu", '')
//			RETURN  1
//		END IF
//	
//		setitem(lrow, "pagbn", 'N')		
//		setitem(lrow, "momast_copy_purgc", 'N')
//		setitem(lrow, "momast_copy_pa_pordno", '')
//		setitem(lrow, "momast_copy_pa_ospeq", '')
//		setitem(lrow, "momast_copy_st_opseq", '')
//		setitem(lrow, "momast_copy_cvcod", '')
//		setitem(lrow, "vndmst_cvnas2", '')
//		setitem(lrow, "momast_copy_unprc", 0)	
//		
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "pagbn", 'N')		
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pa_pordno", '')
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pa_ospeq", '')
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_st_opseq", '')
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod", '')
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", '')
//		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc", 0)
	Case  	"momast_copy_purgc"								// 외주구분
		tab_1.tabpage_2.p_last.enabled = false	
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		sPordno = getitemstring(Lrow, "momast_copy_pordno")
		
		if gettext() = 'N' then
			
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')		
			
			// 외주가 아닌 경우에는 자재 출고 구분을 자동출고 구분을 Setting한다.		
			Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autpdt = 'Y';
			if sqlca.sqlcode <> 0 then
				setitem(lrow, "momast_copy_purgc", 'N')
				Messagebox("생산출고", "자동출고용 수불구분을 검색할 수 없읍니다", stopsign!)
				return 1
			end if
			
			sDptno = getitemstring(lrow, "momast_copy_pdtgu")
			
			select cvcod   into :sCvcod
			  from vndmst where cvgu = '5' and jumaeip = :sDptno;
				
			Update Holdstock_copy
				Set out_store = :sCvcod,
					 Hold_gu	  = :sIogbn
			 Where sabu = :gs_sabu and Pordno = :sPordno;
					
			Commit;	
			
			// 외주 내역을 clear
			setitem(lrow, "momast_copy_cvcod",  snull)
			setitem(lrow, "vndmst_cvnas2", snull)
			setitem(lrow, "momast_copy_unprc",  0)			
			
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  snull)
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", snull)
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  0)
			
			// 전체외주인 경우에는 공정생성및 시간계산을 제외한다.
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_routct", 'Y')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_timect", 'Y')						
			
		Else				/* 외주		*/
			
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'Y')
			sitnbr 		= getitemstring(lrow, "momast_copy_itnbr")
			ls_pspec = getitemstring(lrow, "momast_copy_pspec")
			f_buy_unprc(sitnbr, ls_pspec, '9999', scvcod, scvnas, dUnprc, sTuncu)
			
			// 외주인 경우에는 자재 출고 구분을 외주출고 구분을 Setting한다.
			Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autvnd = 'Y';
			if sqlca.sqlcode <> 0 then
				setitem(lrow, "momast_copy_purgc", 'N')
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')
				Messagebox("사급출고", "사급출고용 수불구분을 검색할 수 없읍니다", stopsign!)
				return 1
			end if
			Update Holdstock_copy
				Set out_store = :sCvcod,
					 Hold_gu	  = :sIogbn
			 Where sabu = :gs_sabu and Pordno = :sPordno;
			Commit;
			
			if isnull(getitemstring(Lrow, "momast_copy_itnbr")) or trim(getitemstring(Lrow, "momast_copy_itnbr")) = '' then
				setitem(lrow, "momast_copy_cvcod",  snull)
				setitem(lrow, "vndmst_cvnas2", snull)
				setitem(lrow, "momast_copy_unprc",  0)			
				
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  snull)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", snull)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  0)
			Else
				setitem(lrow, "momast_copy_cvcod",  scvcod)
				setitem(lrow, "vndmst_cvnas2", scvnas)
				setitem(lrow, "momast_copy_unprc",  dUnprc)			
				
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  scvcod)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", scvnas)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  dUnprc)		
			End if;
			
			// 전체외주인 경우에는 공정생성및 시간계산을 제외한다.
			setitem(Lrow, "momast_copy_routct", 'N')
			setitem(Lrow, "momast_copy_timect", 'N')
		end if	
	Case	"pagbn"										// 작업지시 분할
		 /* 사양개조 */
		 tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "pagbn", getitemstring(lrow, "pagbn"))		
	Case 	"momast_copy_itnbr"	
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		sItnbr = trim(GetText())
		
		/* 2003.12.06  사용중 & 단종은 작업지시 불가(익태) */
		Select useyn, FUN_GET_ITMSHT(:gs_saupj, :sItnbr), fun_get_carcode(:sitnbr)
		  into :usechk, :sItmsht, :scarcode
		  From itemas
		 where itnbr = :sItnbr	 using sqlca;
		 
			 if sqlca.sqlcode = 0 and (usechk = '1' or usechk = '2' ) then
				 f_message_chk(53,'[사용중지 및 단종]') 
				 setitem(tab_1.tabpage_2.dw_tabpage2.getrow(), "momast_copy_itnbr", '')	
				 SetColumn("momast_copy_itnbr")
				 SetFocus()
				 Return 1
			 else
					ireturn = f_get_name4('품번', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
					setitem(lrow, "momast_copy_itnbr", sitnbr)	
					setitem(lrow, "itemas_itdsc", sitdsc)	
					setitem(lrow, "itemas_ispec", sispec)
					setitem(lrow, "itemas_jijil", sjijil)
					setitem(lrow, "itm_shtnm", sItmsht)
					setitem(lrow, "carcode", scarcode)
					
					tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_itnbr", sitnbr)	
					tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_itdsc", sitdsc)	
					tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_ispec", sispec)	
					
					//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 	from dual;
					setitem(lrow, "momast_copy_pdtgu", sPdtgu)
					
					tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pdtgu", sPdtgu)
					
					wf_item_check(lrow, sitnbr, ls_pspec ,'9999')
					RETURN ireturn
			 end if
	Case 	"itemas_itdsc"
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		sItdsc = trim(GetText())
		ireturn = f_get_name4('품명', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
		setitem(lrow, "momast_copy_itnbr", sitnbr)	
		setitem(lrow, "itemas_itdsc", sitdsc)	
		setitem(lrow, "itemas_ispec", sispec)
		setitem(lrow, "itemas_jijil", sjijil)	
		
		
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_itnbr", sitnbr)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_itdsc", sitdsc)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_ispec", sispec)	
		
		//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 	from dual;	
		setitem(lrow, "momast_copy_pdtgu", sPdtgu)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pdtgu", sPdtgu)
		
		wf_item_check(lrow, sitnbr,ls_pspec, '9999')
		RETURN ireturn
	Case 	"itemas_ispec"	
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		sIspec = trim(GetText())
		ireturn = f_get_name4('규격', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
		setitem(lrow, "momast_copy_itnbr", sitnbr)	
		setitem(lrow, "itemas_itdsc", sitdsc)	
		setitem(lrow, "itemas_ispec", sispec)
		setitem(lrow, "itemas_jijil", sjijil)	
		
		
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_itnbr", sitnbr)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_itdsc", sitdsc)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_ispec", sispec)	
		
		//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 		from dual;	
		setitem(lrow, "momast_copy_pdtgu", sPdtgu)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pdtgu", sPdtgu)		
		
		wf_item_check(lrow, sitnbr, ls_pspec, '9999')
		RETURN ireturn
	Case "itemas_jijil"
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		sjijil = trim(GetText())
		ireturn = f_get_name4('재질', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
		setitem(lrow, "momast_copy_itnbr", sitnbr)	
		setitem(lrow, "itemas_itdsc", sitdsc)	
		setitem(lrow, "itemas_ispec", sispec)
		setitem(lrow, "itemas_jijil", sjijil)	
		
		
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_itnbr", sitnbr)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_itdsc", sitdsc)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_ispec", sispec)	
		
		//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 	from dual;	
		setitem(lrow, "momast_copy_pdtgu", sPdtgu)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pdtgu", sPdtgu)		
		
		wf_item_check(lrow, sitnbr, ls_pspec, '9999')
		RETURN ireturn
	Case 	"itemas_ispec_code"	
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		sispec_code = trim(GetText())
		ireturn = f_get_name4('규격코드', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
		setitem(lrow, "momast_copy_itnbr", sitnbr)	
		setitem(lrow, "itemas_itdsc", sitdsc)	
		setitem(lrow, "itemas_ispec", sispec)
		setitem(lrow, "itemas_jijil", sjijil)	
		setitem(lrow, "itemas_ispec_code", sispec_code)
		
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_itnbr", sitnbr)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_itdsc", sitdsc)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "itemas_ispec", sispec)	
		
		//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 		from dual;	
		setitem(lrow, "momast_copy_pdtgu", sPdtgu)	
		tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pdtgu", sPdtgu)		
		
		wf_item_check(lrow, sitnbr, ls_pspec, '9999')
		RETURN ireturn
	Case 	"momast_copy_pspec"  
		if 	isnull(gettext()) or trim(gettext()) = '' then
			setitem(Lrow, "momast_copy_pspec", '.')
			return 2
		end if	
	
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_pspec", gettext())	
		sPordno 	= getitemstring(Lrow, "momast_copy_pordno")
		spurgc 	= getitemstring(Lrow, "momast_copy_purgc")
		
		if spurgc = 'N' then
			
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')		
			
			// 외주가 아닌 경우에는 자재 출고 구분을 자동출고 구분을 Setting한다.		
			Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autpdt = 'Y';
			if sqlca.sqlcode <> 0 then
				setitem(lrow, "momast_copy_purgc", 'N')
				Messagebox("생산출고", "자동출고용 수불구분을 검색할 수 없읍니다", stopsign!)
				return 1
			end if
			
			sDptno = getitemstring(lrow, "momast_copy_pspec")
			
			Update Holdstock_copy
				Set pspec = :sDptno
			 Where sabu = :gs_sabu and Pordno = :sPordno;
					
			Commit;	
			
			// 외주 내역을 clear
			setitem(lrow, "momast_copy_cvcod",  snull)
			setitem(lrow, "vndmst_cvnas2", snull)
			setitem(lrow, "momast_copy_unprc",  0)			
			
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  snull)
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", snull)
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  0)
			
			// 전체외주인 경우에는 공정생성및 시간계산을 제외한다.
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_routct", 'Y')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_timect", 'Y')						
			
		Else				/* 외주		*/
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'Y')
			sitnbr 		= getitemstring(lrow, "momast_copy_itnbr")
			ls_pspec = getitemstring(lrow, "momast_copy_pspec")
			f_buy_unprc(sitnbr, ls_pspec, '9999', scvcod, scvnas, dUnprc, sTuncu)
			
			// 외주인 경우에는 자재 출고 구분을 외주출고 구분을 Setting한다.
			Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autvnd = 'Y';
			if sqlca.sqlcode <> 0 then
				setitem(lrow, "momast_copy_purgc", 'N')
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')
				Messagebox("사급출고", "사급출고용 수불구분을 검색할 수 없읍니다", stopsign!)
				return 1
			end if
			Update Holdstock_copy
				Set out_store 	= :sCvcod,
					 Hold_gu		= :sIogbn,
					 pspec		= :ls_pspec
			 Where sabu = :gs_sabu and Pordno = :sPordno;
			Commit;
			
			if isnull(getitemstring(Lrow, "momast_copy_itnbr")) or trim(getitemstring(Lrow, "momast_copy_itnbr")) = '' then
				setitem(lrow, "momast_copy_cvcod",  snull)
				setitem(lrow, "vndmst_cvnas2", snull)
				setitem(lrow, "momast_copy_unprc",  0)			
				
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  snull)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", snull)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  0)
			Else
				setitem(lrow, "momast_copy_cvcod",  scvcod)
				setitem(lrow, "vndmst_cvnas2", scvnas)
				setitem(lrow, "momast_copy_unprc",  dUnprc)			
				
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  scvcod)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", scvnas)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  dUnprc)		
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pspec",  ls_pspec)		
			End if;
			
			// 전체외주인 경우에는 공정생성및 시간계산을 제외한다.
			setitem(Lrow, "momast_copy_routct", 'N')
			setitem(Lrow, "momast_copy_timect", 'N')
		end if
	// 지시수량
	Case 	"momast_copy_pdqty"
		tab_1.tabpage_2.p_last.enabled = false	
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_pdqty", dec(gettext()))
		if dec(gettext()) < 1 then
			f_message_chk(78,'[지시수량]') 
			setitem(Lrow, "momast_copy_pdqty", 0)
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_pdqty", 0)
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_pdmqty", 0)
			RETURN  1
		end if
		
		SetItem(Lrow, 'momast_copy_pdmqty',dec(gettext()))
	// 지시수량(m)
	Case 	"momast_copy_pdmqty"
		if dec(gettext()) < 1 then
			f_message_chk(78,'[지시수량]') 
			setitem(Lrow, "momast_copy_pdmqty", 0)
			RETURN  1
		end if
		
		SetItem(Lrow, 'momast_copy_pdqty', wf_convert_qty(GetItemString(Lrow, 'momast_copy_itnbr'), Dec(GetText()), 'M'))
	// 시작일자
	Case 	"momast_copy_fsdat" 
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_esdat", gettext())
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fsdat", gettext())
		setitem(lrow, "momast_copy_esdat", gettext())	
		if isnull(gettext()) or trim(gettext()) = '' then
			setitem(lrow, "momast_copy_fstim", '')
		elseif f_datechk(gettext()) = -1 then
			f_message_chk(35,'[생산시작일]') 
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_esdat", '')
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fsdat", '')
			setitem(lrow, "momast_copy_esdat", '')
			setitem(lrow, "momast_copy_fsdat", '')
			setitem(lrow, "momast_copy_fstim", '')
			RETURN  1
		end if
		
		// 시작일자를 입력할경우 종료일자는 null
		setitem(lrow, "momast_copy_eedat", '')
		setitem(lrow, "momast_copy_fedat", '')
		setitem(lrow, "momast_copy_fetim", '')
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_eedat", '')
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fedat", '')
	// 종료일자
	Case 	"momast_copy_fedat" 
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_eedat", gettext())
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fedat", gettext())
		setitem(lrow, "momast_copy_eedat", gettext())
		if isnull(gettext()) or trim(gettext()) = '' then
			setitem(lrow, "momast_copy_fetim", '')
			return
		end if
		if 	f_datechk(gettext()) = -1 then
			f_message_chk(35,'[생산종료일]') 
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_eedat", '')
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fedat", '')
			setitem(lrow, "momast_copy_eedat", '')
			setitem(lrow, "momast_copy_fedat", '')
			setitem(lrow, "momast_copy_fetim", '')
			RETURN  1			
		end if
		
		if getitemstring(lrow, "momast_copy_fsdat") > getitemstring(lrow, "momast_copy_fedat") then
			f_message_chk(35,'[생산종료일]') 
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_eedat", '')
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fedat", '')
			setitem(lrow, "momast_copy_eedat", '')
			setitem(lrow, "momast_copy_fedat", '')
			setitem(lrow, "momast_copy_fetim", '')
			RETURN  1			
		end if
		
		// 종료일자를 입력할경우 시작일자는 null
		setitem(lrow, "momast_copy_esdat", '')
		setitem(lrow, "momast_copy_fsdat", '')
		setitem(lrow, "momast_copy_fstim", '')
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_esdat", '')
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fsdat", '')
	Case 	"momast_copy_matchk" 
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_matchk", gettext())	
	Case 	"momast_copy_routct" 
		sReff   = gettext()
		sPordno = getitemstring(Lrow, "momast_copy_pordno")
		Lchk    = 0
	
	// 최초 작업지시인 경우에 공정이 없으면 Error
/*	If sREff = 'N' then
		Select count(*) into :Lchk From morout_copy
		 Where Sabu = :gs_sabu And pordno = :sPordno;
		If Lchk < 1 then
			MessageBox("공정선택", "최초 작업지시인 경우에는 공정선택이 되어야 합니다", stopsign!)
			Setitem(Lrow, "momast_copy_routct", 'Y')
			Setitem(Lrow, "momast_copy_timect", 'Y')			
			return 1
		End if
	End if */
	// 시작일자
	Case 	"momast_copy_esdat" 
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_esdat", gettext())
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fsdat", gettext())
		setitem(lrow, "momast_copy_esdat", gettext())	
		if isnull(gettext()) or trim(gettext()) = '' then
			setitem(lrow, "momast_copy_fstim", '')
		elseif f_datechk(gettext()) = -1 then
			f_message_chk(35,'[생산시작일]') 
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_esdat", '')
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fsdat", '')
			setitem(lrow, "momast_copy_esdat", '')
			setitem(lrow, "momast_copy_fsdat", '')
			setitem(lrow, "momast_copy_fstim", '')
			RETURN  1
		end if
		
		// 시작일자를 입력할경우 종료일자는 null
		setitem(lrow, "momast_copy_eedat", '')
		setitem(lrow, "momast_copy_fedat", '')
		setitem(lrow, "momast_copy_fetim", '')
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_eedat", '')
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fedat", '')
	// 종료일자
	Case 	"momast_copy_eedat" 
		tab_1.tabpage_2.p_last.enabled = false
		tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_eedat", gettext())
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fedat", gettext())
		setitem(lrow, "momast_copy_eedat", gettext())
		if isnull(gettext()) or trim(gettext()) = '' then
			setitem(lrow, "momast_copy_fetim", '')
			return
		end if
		if 	f_datechk(gettext()) = -1 then
			f_message_chk(35,'[생산종료일]') 
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_eedat", '')
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fedat", '')
			setitem(lrow, "momast_copy_eedat", '')
			setitem(lrow, "momast_copy_fedat", '')
			setitem(lrow, "momast_copy_fetim", '')
			RETURN  1			
		end if
		
		if getitemstring(lrow, "momast_copy_fsdat") > getitemstring(lrow, "momast_copy_fedat") then
			f_message_chk(35,'[생산종료일]') 
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_eedat", '')
			tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fedat", '')
			setitem(lrow, "momast_copy_eedat", '')
			setitem(lrow, "momast_copy_fedat", '')
			setitem(lrow, "momast_copy_fetim", '')
			RETURN  1			
		end if
		
		// 종료일자를 입력할경우 시작일자는 null
		setitem(lrow, "momast_copy_esdat", '')
		setitem(lrow, "momast_copy_fsdat", '')
		setitem(lrow, "momast_copy_fstim", '')
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_esdat", '')
		tab_1.tabpage_3.dw_tabpage3_1.setitem(Lrow, "momast_copy_fsdat", '')
	Case 'momast_copy_fstim'
		sTime = trim(this.gettext())
		if f_timechk(sTime) <> 1 Then
			f_message_chk(30, "시각")
			return 1
		end if
	Case 'momast_copy_fetim'
		sTime = trim(this.gettext())
		if f_timechk(sTime) <> 1 Then
			f_message_chk(30, "시각")
			return 1
		end if
	/* 고객향 */
	Case 'momast_copy_custno'
  	  sCvcod = this.GetText()
	  IF sCvcod ="" OR IsNull(sCvcod) THEN
			SetItem(lrow,"custnm",sNull)
			Return 
		End If
	
	  SELECT "VNDMST"."CVNAS2"		INTO :sreff
		 FROM "VNDMST"  
		WHERE "VNDMST"."CVCOD" =:sCvcod ;
		
	 IF SQLCA.SQLCODE = 0 THEN				
		 SetItem(lrow,"custnm",sreff)
		 SetFocus()
	 Else
		 f_message_chk(33,'')
		 SetItem(lrow,"custnm",sNull)
		 Return 1
	 END IF
End Choose
end event

event dberror;String  sMsg, sErrorcode, sErrorsyntax, sReturn, sNewline
Integer iPos, iCount

iCount			= 0
sNewline			= '~r'
sReturn			= '~n'
sErrorcode 		= Left(sqlerrtext, 9)
iPos 		  		= Len(sqlerrtext) - Pos(sqlerrtext, "No changes made to database.", 1)
sErrorSyntax	= tRIM(Mid(sqlerrtext, 11, Len(sqlerrtext) - iPos - 11))

For iPos = Len(sErrorSyntax) to 1 STEP -1
	 sMsg = Mid(sErrorSyntax, ipos, 1)
	 If sMsg   = sReturn or sMsg = sNewline Then
		 iCount++
	 End if
Next

sErrorSynTax  	= Left(sErrorSyntax, Len(sErrorsyntax) - iCount)


str_db_error db_error_msg
db_error_msg.rowno 	 				= row
db_error_msg.errorcode 				= sErrorCode
db_error_msg.errorsyntax_system	= sErrorSyntax
db_error_msg.errorsyntax_user		= sErrorSyntax
db_error_msg.errorsqlsyntax			= sqlsyntax
OpenWithParm(w_error, db_error_msg)


/*sMsg = "Row No       -> " + String(row) 			 + '~n' + &
		 "Error Code   -> " + sErrorcode			    + '~n' + &
		 "Error Syntax -> " + sErrorSyntax			 + '~n' + &
		 "SqlSyntax    -> " + Sqlsyntax
	MESSAGEBOX("자료처리중 오류발생", sMsg) */

RETURN 1
end event

event editchanged;ib_any_typing =True

//if not (getcolumnname() = "momast_copy_pdqty" or getcolumnname() = "momast_copy_matchk") then
//   tab_1.tabpage_2.p_last.enabled = false
//	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
//end if
//
end event

event itemerror;return 1
end event

event rbuttondown;String colname
Long   lrow

SetNull(gs_gubun)
SetNull(gs_code)
SetNull(gs_codename)

colname = this.getcolumnname()
lrow	  = this.getrow()
if this.accepttext() = -1 then return

if colname = "momast_copy_itnbr" or colname = "itemas_itdcs" or colname = "itemas_ispec" then
   gs_code = this.getitemstring(lrow, "momast_copy_itnbr")
	open(w_itemas_popup)
	
	if isnull(gs_code) or gs_code = "" then return
	
	this.SetItem(lrow,"momast_copy_itnbr",gs_code)
	this.TriggerEvent(ItemChanged!)
elseif colname = "momast_copy_custno" then
	OPEN(W_VNDMST_POPUP)
	If IsNull(gs_code) Then Return
	
	SetItem(lrow,"momast_copy_custno",gs_code)
	SetItem(lrow,"custnm",gs_codename)
end if

end event

event updatestart;/* Update() function 호출시 user 설정 */
long k, lRowCount

lRowCount = this.RowCount()

FOR k = 1 TO lRowCount
   IF NewModified! = this.GetItemStatus(k, 0, Primary!) THEN
 	   This.SetItem(k,'crt_user',gs_userid)
   ELSEIF DataModified! = this.GetItemStatus(k, 0, Primary!) THEN 		
	   This.SetItem(k,'upd_user',gs_userid)
   END IF	  
NEXT


end event

event doubleclicked;Long Lrow

Lrow = getrow()

if Lrow <  1 then return

gs_code 		= getitemstring(Lrow, "momast_copy_itnbr")
gs_codename = getitemstring(Lrow, "itemas_itdsc")

if isnull(gs_code) or trim(gs_code) = '' or isnull(gs_codename) or trim(gs_codename) = '' then
	return
end if


open(w_pdt_04000_1)

setnull(gs_code)
setnull(gs_codename)
end event

event rowfocuschanged;If currentrow > 0 then
	SelectRow(0,false)
	SelectRow(currentrow,true)
Else
	SelectRow(0,false)
	Return
End If

String sItnbr, sPordno, sJidat
Dec    dPdqty

sItnbr = GetItemString(currentrow, 'momast_copy_itnbr')
sPordno = GetItemString(currentrow, 'momast_copy_pordno')
sjidat = GetItemString(currentrow, 'momast_copy_jidat')
dPdqty = GetItemNumber(currentrow, 'momast_copy_pdqty')

dw_stock.Retrieve(gs_sabu, is_sysno, sItnbr, sJidat, dPdqty)
dw_link.Retrieve(gs_sabu, sPordno, is_sysno)
end event

event dragdrop;drag_end_row = row
ib_down = true

If drag_start_row = drag_end_row Then Return
If drag_start_row <= 0 Then Return

If drag_end_row <= 0 Then drag_end_row = RowCount()

//messagebox(string(drag_start_row), string(drag_end_row))

wf_copy_row(drag_start_row, drag_end_row)

end event

type st_pordno from statictext within tabpage_2
integer x = 59
integer y = 76
integer width = 1138
integer height = 52
boolean bringtotop = true
integer textsize = -9
integer weight = 700
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 8388608
long backcolor = 12639424
boolean enabled = false
string text = "[ 주간계획번호 ]"
boolean focusrectangle = false
end type

type tabpage_3 from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 108
integer width = 4521
integer height = 2204
boolean enabled = false
long backcolor = 16777215
string text = "대상 검토"
long tabtextcolor = 33554432
long tabbackcolor = 32106727
long picturemaskcolor = 553648127
rr_8 rr_8
p_17 p_17
p_16 p_16
rr_7 rr_7
dw_tabpage3_3 dw_tabpage3_3
cb_3 cb_3
p_15 p_15
p_save p_save
cb_2 cb_2
cb_1 cb_1
rr_1 rr_1
rr_6 rr_6
dw_etc dw_etc
rr_5 rr_5
dw_wkctr dw_wkctr
p_8 p_8
p_7 p_7
p_9 p_9
p_11 p_11
p_10 p_10
dw_tabpage3_1 dw_tabpage3_1
dw_tabpage3_2 dw_tabpage3_2
gb_5 gb_5
dw_jego dw_jego
end type

on tabpage_3.create
this.rr_8=create rr_8
this.p_17=create p_17
this.p_16=create p_16
this.rr_7=create rr_7
this.dw_tabpage3_3=create dw_tabpage3_3
this.cb_3=create cb_3
this.p_15=create p_15
this.p_save=create p_save
this.cb_2=create cb_2
this.cb_1=create cb_1
this.rr_1=create rr_1
this.rr_6=create rr_6
this.dw_etc=create dw_etc
this.rr_5=create rr_5
this.dw_wkctr=create dw_wkctr
this.p_8=create p_8
this.p_7=create p_7
this.p_9=create p_9
this.p_11=create p_11
this.p_10=create p_10
this.dw_tabpage3_1=create dw_tabpage3_1
this.dw_tabpage3_2=create dw_tabpage3_2
this.gb_5=create gb_5
this.dw_jego=create dw_jego
this.Control[]={this.rr_8,&
this.p_17,&
this.p_16,&
this.rr_7,&
this.dw_tabpage3_3,&
this.cb_3,&
this.p_15,&
this.p_save,&
this.cb_2,&
this.cb_1,&
this.rr_1,&
this.rr_6,&
this.dw_etc,&
this.rr_5,&
this.dw_wkctr,&
this.p_8,&
this.p_7,&
this.p_9,&
this.p_11,&
this.p_10,&
this.dw_tabpage3_1,&
this.dw_tabpage3_2,&
this.gb_5,&
this.dw_jego}
end on

on tabpage_3.destroy
destroy(this.rr_8)
destroy(this.p_17)
destroy(this.p_16)
destroy(this.rr_7)
destroy(this.dw_tabpage3_3)
destroy(this.cb_3)
destroy(this.p_15)
destroy(this.p_save)
destroy(this.cb_2)
destroy(this.cb_1)
destroy(this.rr_1)
destroy(this.rr_6)
destroy(this.dw_etc)
destroy(this.rr_5)
destroy(this.dw_wkctr)
destroy(this.p_8)
destroy(this.p_7)
destroy(this.p_9)
destroy(this.p_11)
destroy(this.p_10)
destroy(this.dw_tabpage3_1)
destroy(this.dw_tabpage3_2)
destroy(this.gb_5)
destroy(this.dw_jego)
end on

type rr_8 from roundrectangle within tabpage_3
long linecolor = 28144969
integer linethickness = 4
long fillcolor = 16777215
integer x = 27
integer y = 1244
integer width = 4137
integer height = 288
integer cornerheight = 40
integer cornerwidth = 55
end type

type p_17 from uo_picture within tabpage_3
integer x = 3968
integer y = 16
integer width = 178
boolean originalsize = true
string picturename = "..\image\인쇄_up.gif"
end type

event clicked;call super::clicked;dw_print.SetTransObject(sqlca)
//messagebox('', is_sysno)
If dw_print.Retrieve(gs_sabu, '.', 'zzzzzz',is_sysno, gs_saupj) < 1 THEN
  	f_message_chk(50,'')
  	return -1
END IF

OpenWithParm(w_print_preview, dw_print)	
end event

type p_16 from uo_picture within tabpage_3
integer x = 1760
integer y = 16
integer width = 178
string picturename = "..\image\품목추가_up.gif"
end type

event clicked;call super::clicked;Long 		Lrow, lMax, nRow, nSeq
String	sDepotNo, sPordno, sPdtgu, sWkctr, sMsg
Int      iReturn
datawindowchild state_child

/* 기타일정 저장 */
If dw_etc.Update() <> 1 Then
	MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
	RollBack;
	Return
End If

COMMIT;

sWkctr = dw_wkctr.GetItemString(1, 'wkctr')

If tab_1.tabpage_2.dw_tabpage2.RowCount() = 0 Then
	lMax = 0
Else
	lMax = Long(tab_1.tabpage_2.dw_tabpage2.GetItemString(1, 'maxseq'))
End If

// 지시번호 생성
lMax = lMax + 1
sPordno = ispordno + string(lMax, '000') + '0'

gs_code = sPordno
gs_codename = is_sysno
gs_gubun = tab_1.tabpage_1.dw_date.GetItemString(1,'steam')
open(w_pdt_02030_9)

sMsg = message.stringparm
if sMsg = 'Y' then
	/* 품목별 내역 조회 		*/
	tab_1.tabpage_2.dw_tabpage2.retrieve(gs_sabu, is_sysno, gs_saupj)
	
	// 작업지시가 생성된 작업장 내역을 조회
	tab_1.tabpage_3.dw_wkctr.Reset()
	iReturn = tab_1.tabpage_3.dw_wkctr.GetChild('wkctr', state_child)
	state_child.SetTransObject(SQLCA)
	state_child.Retrieve(gs_sabu, is_sysno)
	tab_1.tabpage_3.dw_wkctr.SetTransObject(SQLCA)
	tab_1.tabpage_3.dw_wkctr.InsertRow(0)
	
	dw_wkctr.SetItem(1, 'wkctr', swkctr)
	tab_1.tabpage_3.dw_tabpage3_2.retrieve(gs_sabu, is_sysno, sWkctr, gs_saupj, idMeter)
	tab_1.tabpage_3.dw_etc.retrieve(gs_sabu, is_sysno, '%')
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
End if

SetNull(gs_code)			// 작업지시번호
SetNull(gs_codename)		// 공정코드
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\품목추가_dn.gif'
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\품목추가_up.gif'
end event

type rr_7 from roundrectangle within tabpage_3
long linecolor = 28144969
integer linethickness = 1
long fillcolor = 32106727
integer x = 18
integer y = 1544
integer width = 4480
integer height = 656
integer cornerheight = 40
integer cornerwidth = 55
end type

type dw_tabpage3_3 from datawindow within tabpage_3
boolean visible = false
integer x = 5
integer y = 1884
integer width = 4370
integer height = 504
integer taborder = 40
string title = "none"
string dataobject = "d_adt_00290_6_1"
boolean border = false
boolean livescroll = true
end type

type cb_3 from commandbutton within tabpage_3
boolean visible = false
integer x = 2830
integer y = 68
integer width = 517
integer height = 88
integer taborder = 31
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "일정 적용"
end type

event clicked;String sfsdat, sfstim, sfedat, sfetim, sStrTime, sEndTime
Dec    stime
Long   ix, iy, nFind
Long nMax, nRow
String sWkctr
Int    iReturn

If dw_tabpage3_2.AcceptText() <> 1 Then Return
If dw_etc.AcceptText() <> 1 Then Return

sWkctr = dw_wkctr.GetItemString(1, 'wkctr')

// 정렬
dw_tabpage3_2.SetSort("morout_copy_moseq, morout_copy_fsdat, morout_copy_fstim")
dw_tabpage3_2.Sort()

//// 우선순위 정렬만 하고 시간계산은 하지 않는다 2005.07.08
//Return

If dw_tabpage3_2.RowCount() > 0 Then
	sfsdat = Trim(dw_tabpage3_2.GetItemString(1, 'morout_copy_fsdat'))
	sfstim = Trim(dw_tabpage3_2.GetItemString(1, 'morout_copy_fstim'))
	If IsNull(sfsdat) Or sfsdat = '' Then
		MessageBox('확인','시작일자가 지정되지 않았습니다.!!')
		Return
	End If
	If IsNull(sfstim) Or sfstim = '' Then
		MessageBox('확인','시작시간이 지정되지 않았습니다.!!')
		Return
	End If
End If

// 기타일정 감안
wf_calc_time(1, '1')

dw_tabpage3_2.SetSort("morout_copy_fsdat, morout_copy_fstim")
dw_tabpage3_2.Sort()
end event

type p_15 from uo_picture within tabpage_3
integer x = 4151
integer y = 16
integer width = 178
string picturename = "..\image\미리보기_up.gif"
end type

event clicked;call super::clicked;if iw_window.visible then
	iw_window.visible = false
else
	iw_window.visible = true
	
	iw_window.wf_setmenu(is_sysno)
end if


end event

type p_save from uo_picture within tabpage_3
integer x = 4329
integer y = 16
integer width = 178
string picturename = "..\image\저장_up.gif"
end type

event clicked;call super::clicked;Long nMax, nRow
String sWkctr, sPordno, sOpseq, sMaster_no, sInwon_nm, sWkctrr, sKuntype
Int    iReturn, i
Datawindowchild state_child

If dw_tabpage3_2.AcceptText() <> 1 Then Return
If dw_etc.AcceptText() <> 1 Then Return

//If f_msg_update() <> 1 Then Return

sWkctr = Trim(dw_wkctr.GetItemString(1, 'wkctr'))

If dw_tabpage3_2.Update() <> 1 Then
	MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
	RollBack;
	Return
End If

/* 기타일정 저장 */
If dw_etc.Update() <> 1 Then
	MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
	RollBack;
	Return
End If

For i = 1 to dw_tabpage3_2.rowcount()
    sPordno    = dw_tabpage3_2.GetitemString(i, "morout_copy_pordno")
    sOpseq     = dw_tabpage3_2.GetitemString(i, "morout_copy_opseq")
    sMaster_no = dw_tabpage3_2.GetitemString(i, "morout_copy_master_no")
    sWkctrr    = dw_tabpage3_2.GetitemString(i, "morout_copy_wkctr")
    sInwon_nm  = dw_tabpage3_2.GetitemString(i, "morout_etc_copy_inwon_nm")
 	 sKuntype   = dw_tabpage3_2.GetitemString(i, "morout_etc_copy_kuntype")
	  
    update morout_etc_copy set inwon_nm = :sInwon_nm, kuntype = :skuntype,
                               wkctr    = :sWkctrr
                         where sabu    = :gs_sabu
						         and pordno  = :sPordno
							      and opseq   = :sOpseq
						         and master_no = :sMaster_no;						  

Next
COMMIT;

// 작업지시가 생성된 작업장 내역을 조회
tab_1.tabpage_3.dw_wkctr.Reset()
iReturn = tab_1.tabpage_3.dw_wkctr.GetChild('wkctr', state_child)
state_child.SetTransObject(SQLCA)
state_child.Retrieve(gs_sabu, is_sysno)
tab_1.tabpage_3.dw_wkctr.SetTransObject(SQLCA)
tab_1.tabpage_3.dw_wkctr.InsertRow(0)

tab_1.tabpage_3.dw_tabpage3_2.Reset()
tab_1.tabpage_3.dw_etc.Reset()

// 작업장 내역 재조회
If sWkctr > '' Then
	dw_wkctr.SetItem(1, 'wkctr', swkctr)
	tab_1.tabpage_3.dw_tabpage3_2.retrieve(gs_sabu, is_sysno, sWkctr, gs_saupj, idMeter)
	tab_1.tabpage_3.dw_etc.retrieve(gs_sabu, is_sysno, '%')
End If

//MessageBox('확인','저장되었습니다.!!')
end event

type cb_2 from commandbutton within tabpage_3
integer x = 4178
integer y = 1408
integer width = 320
integer height = 104
integer taborder = 21
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "일정 삭제"
end type

event clicked;Long nMax, nRow
String sWkctr

If dw_etc.AcceptText() <> 1 Then Return

nRow = dw_etc.GetRow()
If nRow <= 0 Then Return

If f_msg_delete() <> 1 Then Return

dw_etc.DeleteRow(nRow)
If dw_etc.Update() <> 1 Then
	MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
	RollBack;
	Return
End If

COMMIT;

MessageBox('확인','삭제되었습니다.!!')

end event

type cb_1 from commandbutton within tabpage_3
integer x = 4178
integer y = 1276
integer width = 320
integer height = 104
integer taborder = 20
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "일정 추가"
end type

event clicked;Long nMax, nRow
String sWkctr, sJidat

If dw_etc.AcceptText() <> 1 Then Return

If dw_etc.RowCount() > 0 Then
	nMax = dw_etc.GetItemNumber(1,'max_seq')
Else
	nMax = 0
End If

sJidat = tab_1.tabpage_1.dw_date.getitemstring(1, "jdate")
//sWkctr = Trim(dw_wkctr.GetItemString(1, 'wkctr'))
//If IsNull(sWkctr) Or sWkctr = '' Then
//	f_message_chk(1400,'작업장')
//	Return
//End If

nRow = dw_etc.InsertRow(0)
dw_etc.SetItem(nrow, 'sabu', gs_sabu)
dw_etc.SetItem(nrow, 'master_no', is_sysno)
//dw_etc.SetItem(nrow, 'master_no', sJidat) // 일자기준으로 한건씩만 생성
dw_etc.SetItem(nrow, 'mstseq', nMax + 1)
//dw_etc.SetItem(nrow, 'wkctr', sWkctr)
dw_etc.SetItem(nrow, 'fsdat', sJidat)
dw_etc.SetItem(nrow, 'fedat', sJidat)
dw_etc.SetItem(nrow, 'fstim', '2359')
dw_etc.SetItem(nrow, 'fetim', '2359')
dw_etc.SetItem(nrow, 'estim', 0)

dw_etc.SetFocus()
dw_etc.ScrollTorow(nrow)
dw_etc.SetColumn('fsdat')

end event

type rr_1 from roundrectangle within tabpage_3
boolean visible = false
long linecolor = 28144969
integer linethickness = 4
long fillcolor = 32106727
integer x = 18
integer y = 1244
integer width = 4155
integer height = 448
integer cornerheight = 40
integer cornerwidth = 55
end type

type rr_6 from roundrectangle within tabpage_3
long linecolor = 28144969
integer linethickness = 1
long fillcolor = 32106727
integer x = 23
integer y = 180
integer width = 4480
integer height = 1056
integer cornerheight = 40
integer cornerwidth = 55
end type

type dw_etc from u_key_enter within tabpage_3
integer x = 37
integer y = 1256
integer width = 4123
integer height = 268
integer taborder = 11
string dataobject = "d_adt_00290_b"
boolean vscrollbar = true
boolean border = false
end type

event itemchanged;call super::itemchanged;string   snull, sitnbr, sreff, sreff1, sitdsc, sispec, scvcod, sopseq, sPordno, &
			sIogbn, sDptno, sOpdsc, sPurgc, stuncu, scvnas, spdtgu
long     lrow
integer  ireturn
Decimal  {5} dunprc, destim
String	ls_pspec, sDate, sTime

setnull(snull)

lrow   = dw_etc.getrow()

if accepttext() = -1 then
	Messagebox("자료확인", "자료확인시 오류 발생", stopsign!)
	return 1
end if

if this.getcolumnname() = "fsdat" then
	if isnull(this.gettext()) or trim(this.gettext()) = '' then
		f_message_chk(35,'[시작일]') 
		this.setitem(lrow, "fsdat", '')
		RETURN  1
	end if
	if f_datechk(this.gettext()) = -1 then
		f_message_chk(35,'[시작일]') 
		this.setitem(lrow, "fsdat", '')
		RETURN  1			
	end if
	
	SetItem(lrow, 'fedat', gettext())
	// 시간계산
	SetItem(lrow, 'estim', f_daytimeterm(gettext(), getitemstring(lrow,'fedat'), getitemstring(lrow,'fstim'),getitemstring(lrow,'fetim')))
elseif this.getcolumnname() = "fedat" then
	if isnull(this.gettext()) or trim(this.gettext()) = '' then
		f_message_chk(35,'[종료일]') 
		this.setitem(lrow, "fedat", '')
		RETURN  1
	end if
	if f_datechk(this.gettext()) = -1 then
		f_message_chk(35,'[종료일]') 
		this.setitem(lrow, "fedat", '')
		RETURN  1			
	end if
	
	// 시간계산
	SetItem(lrow, 'estim', f_daytimeterm(getitemstring(lrow,'fsdat'), gettext(), getitemstring(lrow,'fstim'),getitemstring(lrow,'fetim')))
elseif this.getcolumnname() = "fstim" then
	SetItem(lrow, 'estim', f_daytimeterm(getitemstring(lrow,'fsdat'), getitemstring(lrow,'fedat'), gettext(), getitemstring(lrow,'fetim')))
elseif this.getcolumnname() = "fetim" then
	SetItem(lrow, 'estim', f_daytimeterm(getitemstring(lrow,'fsdat'), getitemstring(lrow,'fedat'), getitemstring(lrow,'fstim'), gettext()))
elseif this.getcolumnname() = "estim" then
	destim = Dec(GetText())
	
	sDate = GetItemString(lrow, 'fsdat') + GetItemString(lrow, 'fstim')
	If Len(sDate) <> 12 Then
		MessageBox('확인','시작일자 및 시간을 입력하세요.!!')
		Return 2
	End If
	
	select to_char(to_date(:sDate,'yyyymmddhh24mi') + :destim/1440 , 'yyyymmddhh24mi') into :sTime from dual;
	
	SetItem(lrow, 'fedat', left(stime,8))
	SetItem(lrow, 'fetim', right(stime,4))
end if
end event

event itemerror;call super::itemerror;return 1
end event

type rr_5 from roundrectangle within tabpage_3
long linecolor = 28144969
integer linethickness = 1
long fillcolor = 12639424
integer x = 23
integer y = 20
integer width = 1714
integer height = 144
integer cornerheight = 40
integer cornerwidth = 55
end type

type dw_wkctr from u_key_enter within tabpage_3
integer x = 27
integer y = 44
integer width = 1705
integer height = 96
integer taborder = 11
string dataobject = "d_adt_00290_5"
boolean border = false
end type

event itemchanged;call super::itemchanged;String sWkctr, sRoslt
Long ix 

Choose Case GetColumnName()
	Case 'wkctr'
		sWkctr = Trim(GetText())
		
		p_save.PostEvent(Clicked!)
//		tab_1.tabpage_3.dw_tabpage3_2.Reset()
//		tab_1.tabpage_3.dw_tabpage3_2.retrieve(gs_sabu, is_sysno, sWkctr, gs_saupj, idMeter)
//		tab_1.tabpage_3.dw_etc.retrieve(gs_sabu, is_sysno, sWkctr)
	Case 'roslt'
		sRoslt = Trim(GetText())
		
		If IsNull(sRoslt) Or sRoslt = '' Then
			dw_tabpage3_2.SetFilter("")
		Else
			dw_tabpage3_2.SetFilter("morout_copy_roslt = '" + sRoslt +"'")
		End If
		dw_tabpage3_2.Filter()
End Choose

//// 정렬
//dw_tabpage3_2.SetSort("morout_copy_fsdat, morout_copy_fstim")
//dw_tabpage3_2.Sort()
//For ix = 1 To dw_tabpage3_2.RowCount()
//	dw_tabpage3_2.SetItem(ix, 'morout_copy_moseq', ix * 10)
//Next
end event

type p_8 from uo_picture within tabpage_3
boolean visible = false
integer x = 2592
integer y = 12
integer width = 178
boolean originalsize = true
string picturename = "..\image\제품할당_up.gif"
end type

event clicked;call super::clicked;str_02030 parm02030

Long Lrow

tab_1.selecttab(3)
Lrow = tab_1.tabpage_3.dw_tabpage3_1.getrow()
	
if Lrow < 1 then
	Messagebox("제품선택", "제품내역이 선택되어 있지않읍니다" + '~n' + &
								  "작업지시 내역을 Mouse로 Click후 Button을 Click하십시요!", &
								  Stopsign!)
   tab_1.tabpage_3.dw_tabpage3_1.setfocus()
	return
end if

if tab_1.tabpage_3.dw_tabpage3_1.getitemstring(Lrow, "pagbn") = 'N' then
	Messagebox("작업지시", "사양개조용 작업지시가 아닙니다" + '~n' + &
								  "사양개조용 작업지시 내역을 Mouse로 Click후 Button을 Click하십시요!", &
								  Stopsign!)
   tab_1.tabpage_3.dw_tabpage3_1.setfocus()
	return	
end if

parm02030.dwname 		= tab_1.tabpage_3.dw_tabpage3_1
parm02030.sitdsc  	= tab_1.tabpage_3.dw_tabpage3_1.getitemstring(Lrow, "itemas_itdsc")

openwithparm(w_pdt_02030_4, parm02030)
Commit;

tab_1.tabpage_3.dw_tabpage3_1.setfocus()
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\제품할당_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\제품할당_dn.gif'
end event

type p_7 from uo_picture within tabpage_3
boolean visible = false
integer x = 3383
integer y = 24
integer width = 178
boolean enabled = false
string picturename = "..\image\부하계산_up.gif"
end type

event clicked;call super::clicked;/* 작업지시 공정 일정 계산 */
Int II

if Messagebox("주간계획", "후공정별 일정을 계산합니다~r~r계속하시겠습니까?", question!, yesno!) = 2 then
	return
end if

If dw_tabpage3_2.AcceptText() <> 1 Then REturn
If dw_tabpage3_2.Update(True, False) <> 1 Then
	MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
	RollBack;
	Return
End If

If dw_etc.Update(True, False) <> 1 Then
	MessageBox(string(sqlca.sqlcode),sqlca.sqlerrtext)
	RollBack;
	Return
End If

COMMIT;

dw_tabpage3_2.ResetUpdate()
dw_etc.ResetUpdate()

w_mdi_frame.sle_msg.text = '작업일정을 계산중입니다....!!'

II = 0
DECLARE erp000000810_last procedure for erp000000810_last(:gs_sabu, :is_sysno) ;

Execute erp000000810_last;

FETCH erp000000810_last INTO :Ii;
Choose Case Ii
		 Case 0
				F_message_chk(41,'[공정일정 계산]')
				Rollback;
				w_mdi_frame.sle_msg.text = ''
				return;
		 Case -1
				F_message_chk(89,'[공정일정 계산]')
				Rollback;
				w_mdi_frame.sle_msg.text = ''
				return;			
		 Case -2
				F_message_chk(205,'[공정일정 계산]')
				Rollback;
				return;			
End Choose
Commit;

COMMIT;

close erp000000810_last ;

String sWkctr

sWkctr = dw_wkctr.GetItemSTring(1, 'wkctr')

tab_1.tabpage_3.dw_tabpage3_2.Reset()
tab_1.tabpage_3.dw_tabpage3_2.retrieve(gs_sabu, is_sysno, sWkctr, gs_saupj,idMeter)
tab_1.tabpage_3.dw_etc.retrieve(gs_sabu, is_sysno, '%')

w_mdi_frame.sle_msg.text = '완료....!!'
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\부하계산_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\부하계산_dn.gif'
end event

type p_9 from uo_picture within tabpage_3
boolean visible = false
integer x = 2309
integer y = 16
integer width = 178
string picturename = "..\image\공정삭제_up.gif"
end type

event clicked;call super::clicked;Long Lrow
String sOpdsc, sOpseq, sLastc, sDpseq, sLpseq, sNull, sColumn, sBogbn, sWkctr

Lrow = dw_tabpage3_2.getrow()

Setnull(snull)

if Lrow < 1 then
	Messagebox("공정확인", "삭제할 공정을 선택하십시요", stopsign!)
	dw_tabpage3_2.setfocus()
	return
end if

If tab_1.tabpage_3.dw_tabpage3_2.getitemstring(tab_1.tabpage_3.dw_tabpage3_2.getrow(), "momast_copy_porgu") = '90' Then
	MessageBox("공정추가", "주간계획자료는 수정하실 수 없습니다.", stopsign!)
	return
End if
	
swkctr 	= dw_wkctr.getitemstring(1, "wkctr")
sOpdsc 	= dw_tabpage3_2.getitemstring(Lrow, "morout_copy_opdsc")
sOpseq	= dw_tabpage3_2.getitemstring(Lrow, "morout_copy_opseq")
sLastc	= dw_tabpage3_2.getitemstring(Lrow, "morout_copy_lastc")
sColumn  = dw_tabpage3_2.getitemstring(Lrow, "morout_copy_pordno")

// 삭제용 dw 조회
dw_tabpage3_3.Retrieve(gs_sabu, is_sysno, sColumn)

if dw_tabpage3_3.rowcount() <= 1 then
	Messagebox("공정확인", "1개의 이상의 공정이 필요합니다", stopsign!)
	dw_tabpage3_2.setfocus()
	return
end if

if Messagebox("삭제확인", sOpdsc + " 공정을 삭제하시겠읍니까?", question!, yesno!) = 2 then
	dw_tabpage3_2.setfocus()
	return	
end if

LRow = dw_tabpage3_3.Find("morout_copy_opseq = '" + sOpseq +"'",1, dw_tabpage3_3.RowCount())
If LRow <= 0 Then
	Messagebox("공정확인", "공정을 찾을 수 없습니다.!!", stopsign!)
	dw_tabpage3_2.setfocus()
	return
End If

SEtpointer(hourglass!)

// 삭제 
dw_tabpage3_3.deleterow(Lrow)

// 동시공정이 있으면 삭제할 수 없음
For Lrow = 1 to dw_tabpage3_3.rowcount()
	 if not isnull(dw_tabpage3_3.getitemstring(Lrow, "morout_copy_do_opseq")) then
		 MessageBox("동시공정", "동시공정이 존재하므로 변경할 수 없읍니다", stopsign!)
		 return
	 end if
Next

// 보고유무 사용구분 검색
sBogbn = '2'
select dataname
  into :sBogbn
  from syscnfg
 where sysgu = 'Y' and serial = '15' and lineno = '6';
if sqlca.sqlcode <> 0 then sBogbn = '2'

// 보고유무를 사용하는 경우에만 공정구분을 정리한다.
if sBogbn = '1' then
	// 현재 공정을 기준으로 정리
	if dw_tabpage3_3.rowcount() > 1 then
		For Lrow = 1 to dw_tabpage3_3.rowcount()
			
			 // 공정구분
			 if Lrow = 1 then
				 dw_tabpage3_3.setitem(Lrow, "morout_copy_lastc", '1')
			 Elseif Lrow = dw_tabpage3_3.rowcount() then
				 dw_tabpage3_3.setitem(Lrow, "morout_copy_lastc", '3')
			 Else
				 dw_tabpage3_3.setitem(Lrow, "morout_copy_lastc", '0')
			 End if
			
			 //도착후 공정 check
			 if Lrow = dw_tabpage3_3.rowcount() then
				 dw_tabpage3_3.setitem(Lrow, "morout_copy_de_opseq", snull)				
			 Else
				 dw_tabpage3_3.setitem(Lrow, "morout_copy_de_opseq", dw_tabpage3_3.getitemstring(Lrow + 1, "morout_copy_opseq"))
			 End if	
	
			 //도착전 공정 check
			 if Lrow = 1 then 
				 dw_tabpage3_3.setitem(Lrow, "morout_copy_pr_opseq", '0000')
			 Else
				 dw_tabpage3_3.setitem(Lrow, "morout_copy_pr_opseq", dw_tabpage3_3.getitemstring(Lrow - 1, "morout_copy_opseq"))
			 End if		 
	
		Next
	else
		dw_tabpage3_3.setitem(1, "morout_copy_lastc", '9')	
		dw_tabpage3_3.setitem(1, "morout_copy_pr_opseq", '0000')	
		dw_tabpage3_3.setitem(1, "morout_copy_de_opseq", snull)	
	end if
end if

if dw_tabpage3_3.update() <> 1 then
	rollback;
	f_rollback()
end if

// 할당사용공정 변경
// 1. 삭제공정 이후에 Min공정을 적용
// 2. 삭제공정 이전에 Max공정을 적용
// 1,2에 해당되지 않으면 Error처리
//Setnull(sDpseq)
//Select Min(opseq) Into :sDpseq From morout_copy
// where sabu = :gs_sabu And pordno = :sColumn And opseq > :sOpseq;
//if Isnull( sDpseq ) then
//	Select Max(opseq) Into :sDpseq From morout_copy
//	 where sabu = :gs_sabu And pordno = :sColumn And opseq < :sOpseq;
//end if
//
//if Isnull( sDpseq ) then
//	rollback;
// 	tab_1.tabpage_3.dw_tabpage3_3.retrieve(gs_sabu, scolumn)
//	Messagebox("공정검색", "작업지시에 대한 공정을 검색할 수 없읍니다", stopsign!)
//	return
//end if	
//
//if MessageBox("자재확인", "자재를 삭제하시겠읍니까?", question!, yesno!) = 1 then
//	Delete
//	  From holdstock_copy
//	 Where sabu = :gs_sabu And Pordno = :sColumn And Opseq = :sOpseq;
//else
//	Update holdstock_copy
//		Set opseq = :sDpseq
//	 Where sabu = :gs_sabu And Pordno = :sColumn And Opseq = :sOpseq;
//end if

SEtpointer(Arrow!)

Commit;

dw_tabpage3_3.Reset()
dw_tabpage3_2.Retrieve(gs_sabu, is_sysno, sWkctr, gs_saupj,idMeter)

Messagebox("삭제완료", sOpdsc + " 공정이 삭제되었읍니다", information!)	
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\공정삭제_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\공정삭제_dn.gif'
end event

type p_11 from uo_picture within tabpage_3
boolean visible = false
integer x = 2135
integer y = 16
integer width = 178
string picturename = "..\image\공정수정_up.gif"
end type

event clicked;call super::clicked;SetNull(gs_code)			// 작업지시번호
SetNull(gs_codename)		// 공정코드

Long Lrow
String sMsg, sPordno, swkctr

Lrow = tab_1.tabpage_3.dw_tabpage3_2.getrow()
if Lrow < 1 then return

If tab_1.tabpage_3.dw_tabpage3_2.getitemstring(Lrow, "momast_copy_porgu") = '90' Then
	MessageBox("공정추가", "주간계획자료는 수정하실 수 없습니다.", stopsign!)
	return
End if

sWkctr = dw_wkctr.GetItemString(1, 'wkctr')
	
gs_code 		= tab_1.tabpage_3.dw_tabpage3_2.getitemstring(Lrow, "morout_copy_pordno")   // 작업지시번호
gs_codename = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(Lrow, "morout_copy_opseq")   // 공정코드
sPordno     = gs_code

open(w_pdt_02030_3)

sMsg = message.stringparm
if sMsg = 'Y' then
	dw_tabpage3_2.Retrieve(gs_sabu, is_sysno, sWkctr, gs_saupj,idMeter)
End if

SetNull(gs_code)			// 작업지시번호
SetNull(gs_codename)		// 공정코드
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\공정수정_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\공정수정_dn.gif'
end event

type p_10 from uo_picture within tabpage_3
boolean visible = false
integer x = 1961
integer y = 16
integer width = 178
string picturename = "..\image\공정추가_up.gif"
end type

event clicked;call super::clicked;SetNull(gs_code)			// 작업지시번호
SetNull(gs_codename)		// 공정코드

String sMsg, sPordno, swkctr

if tab_1.tabpage_3.dw_tabpage3_2.rowcount() > 0 then
	If tab_1.tabpage_3.dw_tabpage3_2.getitemstring(tab_1.tabpage_3.dw_tabpage3_2.getrow(), "momast_copy_porgu") = '90' Then
		MessageBox("공정추가", "주간계획자료는 수정하실 수 없습니다.", stopsign!)
		return
	End if
	
	gs_code = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(tab_1.tabpage_3.dw_tabpage3_2.getrow(), "morout_copy_pordno")   // 작업지시번호
End if

if IsNull( gs_code ) then
	MessageBox("공정추가", "계산후 공정을 추가하십시요" + "작업지시번호가 생성되어야 합니다", stopsign!)
	return
End if

sWkctr = dw_wkctr.GetItemString(1, 'wkctr')

sPordno = gs_code

open(w_pdt_02030_3)

sMsg = message.stringparm
if sMsg = 'Y' then
	dw_tabpage3_2.Retrieve(gs_sabu, is_sysno, sWkctr, gs_saupj,idMeter)
End if

SetNull(gs_code)			// 작업지시번호
SetNull(gs_codename)		// 공정코드
end event

event ue_lbuttonup;call super::ue_lbuttonup;PictureName = '..\image\공정추가_up.gif'
end event

event ue_lbuttondown;call super::ue_lbuttondown;PictureName = '..\image\공정추가_dn.gif'
end event

type dw_tabpage3_1 from datawindow within tabpage_3
event ue_key pbm_dwnkey
event ue_pressenter pbm_dwnprocessenter
boolean visible = false
integer x = 3717
integer y = 32
integer width = 151
integer height = 136
integer taborder = 10
boolean bringtotop = true
string dataobject = "d_pdt_02030_1"
boolean border = false
end type

event ue_key;Long lrow
lrow = this.getrow()


if keydown(keyf1!) then
	this.triggerevent(rbuttondown!)
end if

IF keydown(keyF2!) THEN
	IF This.GetColumnName() = "momast_copy_itnbr" Then
		open(w_itemas_popup2)
		if isnull(gs_code) or gs_code = "" then return
		
		this.SetItem(this.getrow(),"momast_copy_itnbr",gs_code)
		this.TriggerEvent(ItemChanged!)
	end if
END IF

end event

event ue_pressenter;Send(Handle(this),256,9,0)
Return 1
end event

event dberror;String  sMsg, sErrorcode, sErrorsyntax, sReturn, sNewline
Integer iPos, iCount

iCount			= 0
sNewline			= '~r'
sReturn			= '~n'
sErrorcode 		= Left(sqlerrtext, 9)
iPos 		  		= Len(sqlerrtext) - Pos(sqlerrtext, "No changes made to database.", 1)
sErrorSyntax	= tRIM(Mid(sqlerrtext, 11, Len(sqlerrtext) - iPos - 11))

For iPos = Len(sErrorSyntax) to 1 STEP -1
	 sMsg = Mid(sErrorSyntax, ipos, 1)
	 If sMsg   = sReturn or sMsg = sNewline Then
		 iCount++
	 End if
Next

sErrorSynTax  	= Left(sErrorSyntax, Len(sErrorsyntax) - iCount)


str_db_error db_error_msg
db_error_msg.rowno 	 				= row
db_error_msg.errorcode 				= sErrorCode
db_error_msg.errorsyntax_system	= sErrorSyntax
db_error_msg.errorsyntax_user		= sErrorSyntax
db_error_msg.errorsqlsyntax			= sqlsyntax
OpenWithParm(w_error, db_error_msg)


/*sMsg = "Row No       -> " + String(row) 			 + '~n' + &
		 "Error Code   -> " + sErrorcode			    + '~n' + &
		 "Error Syntax -> " + sErrorSyntax			 + '~n' + &
		 "SqlSyntax    -> " + Sqlsyntax
	MESSAGEBOX("자료처리중 오류발생", sMsg) */

RETURN 1
end event

event editchanged;ib_any_typing =True


end event

event itemchanged;string   snull, sitnbr, sreff, sreff1, sitdsc, sispec, sjijil, sispec_code, scvcod, &
			sdptno, spurgc, sporgu, scvnas, stuncu, sIogbn, sPordno, sopseq, sopdsc
long     lrow, Lrow1
integer  ireturn
Decimal  {5} dunprc
String	ls_pspec, sPdtgu

setnull(snull)

lrow   = this.getrow()
this.accepttext()

// 생산팀 체크
sPdtgu = Trim(tab_1.tabpage_1.dw_date.GetItemString(1, 'steam'))
If IsNull(sPdtgu) Or sPdtgu = '' Then
	f_message_chk(1400,'생산팀')
	Return 2
End If

/* 작업지시구분 check */
If this.Getcolumnname() = "momast_copy_porgu" then
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	
	tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_porgu", gettext())
	if isnull(f_get_reffer('60', this.gettext())) then
		f_message_chk(79,'[작업지시구분]') 
		this.setitem(lrow, "momast_copy_porgu", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_porgu", '')
		RETURN  1
	END IF

	this.setitem(lrow, "pagbn", 'N')		
	this.setitem(lrow, "momast_copy_purgc", 'N')
	this.setitem(lrow, "momast_copy_pa_pordno", '')
	this.setitem(lrow, "momast_copy_pa_ospeq", '')
	this.setitem(lrow, "momast_copy_st_opseq", '')
	this.setitem(lrow, "momast_copy_cvcod", '')
	this.setitem(lrow, "vndmst_cvnas2", '')
	this.setitem(lrow, "momast_copy_unprc", 0)	
	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "pagbn", 'N')		
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_purgc", 'N')
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_pordno", '')
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_ospeq", '')
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_st_opseq", '')
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_cvcod", '')
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "vndmst_cvnas2", '')
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_unprc", 0)	
	
	sPordno = getitemstring(Lrow, "momast_copy_pordno")
	
elseif this.getcolumnname() = "momst_copy_purgc" then		// 외주구분
	if gettext() <> 'N' then
		// 외주가 아닌 경우에는 자재 출고 구분을 자동출고 구분을 Setting한다.
		Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autpdt = 'Y';
		if sqlca.sqlcode <> 0 then
			setitem(lrow, "momast_copy_purgc", 'N')
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')
			Messagebox("생산출고", "자동출고용 수불구분을 검색할 수 없읍니다", stopsign!)
			return 1
		end if

		sDptno = getitemstring(lrow, "momast_copy_pdtgu")
		select cvcod into :sCvcod from vndmst where cvgu = '5' and jumaeip = :sDptno;
		
		Update Holdstock_copy
			Set out_store = :sCvcod,
				 Hold_gu	  = :sIogbn
		 Where sabu = :gs_sabu and Pordno = :sPordno;
		Commit;	
		
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_cvcod", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "vndmst_cvnas2", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_unprc", 0)			
		
		setitem(lrow, "momast_copy_cvcod", '')
		setitem(lrow, "vndmst_cvnas2", '')
		setitem(lrow, "momast_copy_unprc", 0)			
		
		// 전체외주인 경우에는 공정생성및 시간계산을 제외한다.
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_routct", 'Y')
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_timect", 'Y')				
		
	else	//전체외주
		this.setitem(lrow, "momast_copy_purgc", 'Y')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_purgc", 'Y')		
		sitnbr 		= this.getitemstring(lrow, "momast_copy_itnbr")
		ls_pspec 	= this.getitemstring(lrow, "momast_copy_pspec")
		f_buy_unprc(sitnbr, ls_pspec , '9999', scvcod, scvnas, dUnprc, sTuncu)
		
		// 외주인 경우에는 자재 출고 구분을 외주출고 구분을 Setting한다.
		Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autvnd = 'Y';
		if sqlca.sqlcode <> 0 then
			setitem(lrow, "momast_copy_purgc", 'N')
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')
			Messagebox("사급출고", "사급출고용 수불구분을 검색할 수 없읍니다", stopsign!)
			return 1
		end if
		Update Holdstock_copy
			Set out_store = :sCvcod,
				 Hold_gu	  = :sIogbn
		 Where sabu = :gs_sabu and Pordno = :sPordno;
		Commit;
		
		this.setitem(Lrow, "momast_copy_cvcod",  scvcod)
		this.setitem(Lrow, "vndmst_cvnas2", scvnas)
		this.setitem(Lrow, "momast_copy_unprc",  dUnprc)			
		
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_cvcod",  scvcod)
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "vndmst_cvnas2", scvnas)
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_unprc",  dUnprc)		
		
		
		// 전체외주인 경우에는 공정생성및 시간계산을 제외한다.
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_routct", 'N')
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_timect", 'N')		
		
	end if	
elseif this.getcolumnname() = "pagbn" then	
		 tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "pagbn", getitemstring(Lrow, "pagbn"))	
elseif this.getcolumnname() = "momast_copy_jidat" then
	if f_datechk(gettext()) = -1 then
		this.setitem(lrow, "momast_copy_jidat", f_today())
		f_message_chk(35, '[지시일자]')
		return 1
	else
		tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_jidat",  gettext())				
	end if	
ELSEIF this.GetColumnName() = "momast_copy_itnbr"	THEN
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	sItnbr = trim(this.GetText())
	ireturn = f_get_name4('품번', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	this.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	this.setitem(lrow, "itemas_itdsc", sitdsc)	
	this.setitem(lrow, "itemas_ispec", sispec)
	this.setitem(lrow, "itemas_jijil", sjijil)	
	this.setitem(lrow, "itemas_ispec_code", sispec_code)
	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_itdsc", sitdsc)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_ispec", sispec)
	
	//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 	from dual;	
	this.setitem(lrow, "momast_copy_pdtgu", sPdtgu)
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pdtgu", sPdtgu)
	ls_pspec 	= this.getitemstring(lrow, "momast_copy_pspec")
	
	wf_item_check(lrow, sitnbr, ls_pspec, '9999')

	RETURN ireturn
ELSEIF this.GetColumnName() = "itemas_itdsc"	THEN
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	sItdsc = trim(this.GetText())
	ireturn = f_get_name4('품명', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	this.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	this.setitem(lrow, "itemas_itdsc", sitdsc)	
	this.setitem(lrow, "itemas_ispec", sispec)
	this.setitem(lrow, "itemas_jijil", sjijil)	
	this.setitem(lrow, "itemas_ispec_code", sispec_code)
		
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_itdsc", sitdsc)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_ispec", sispec)
	
	//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 	from dual;	
	this.setitem(lrow, "momast_copy_pdtgu", sPdtgu)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pdtgu", sPdtgu)
	
	ls_pspec 	= this.getitemstring(lrow, "momast_copy_pspec")
	wf_item_check(lrow, sitnbr , ls_pspec,  '9999')
	RETURN ireturn
ELSEIF this.GetColumnName() = "itemas_ispec"	THEN
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	sIspec = trim(this.GetText())
	ireturn = f_get_name4('규격', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	this.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	this.setitem(lrow, "itemas_itdsc", sitdsc)	
	this.setitem(lrow, "itemas_ispec", sispec)
	this.setitem(lrow, "itemas_jijil", sjijil)	
	this.setitem(lrow, "itemas_ispec_code", sispec_code)
		
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_itdsc", sitdsc)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_ispec", sispec)
	
	//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 	from dual;	
	this.setitem(lrow, "momast_copy_pdtgu", sPdtgu)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pdtgu", sPdtgu)
	
	ls_pspec 	= this.getitemstring(lrow, "momast_copy_pspec")
	wf_item_check(lrow, sitnbr,  ls_pspec, '9999')
	RETURN ireturn
ELSEIF this.GetColumnName() = "itemas_jijil"	THEN
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	sjijil = trim(this.GetText())
	ireturn = f_get_name4('재질', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	this.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	this.setitem(lrow, "itemas_itdsc", sitdsc)	
	this.setitem(lrow, "itemas_ispec", sispec)
	this.setitem(lrow, "itemas_jijil", sjijil)	
	this.setitem(lrow, "itemas_ispec_code", sispec_code)
		
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_itdsc", sitdsc)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_ispec", sispec)
	
	//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 	from dual;	
	this.setitem(lrow, "momast_copy_pdtgu", sPdtgu)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pdtgu", sPdtgu)
	
	ls_pspec 	= this.getitemstring(lrow, "momast_copy_pspec")
	wf_item_check(lrow, sitnbr, ls_pspec,  '9999')
	RETURN ireturn
ELSEIF this.GetColumnName() = "itemas_ispec_code"	THEN
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	sIspec_code = trim(this.GetText())
	ireturn = f_get_name4('규격코드', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	this.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	this.setitem(lrow, "itemas_itdsc", sitdsc)	
	this.setitem(lrow, "itemas_ispec", sispec)
	this.setitem(lrow, "itemas_jijil", sjijil)	
	this.setitem(lrow, "itemas_ispec_code", sispec_code)
		
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_itnbr", sitnbr)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_itdsc", sitdsc)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "itemas_ispec", sispec)
	
	//select fun_get_pdtgu(:sitnbr, '1') into :sdptno 	from dual;	
	this.setitem(lrow, "momast_copy_pdtgu", sPdtgu)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pdtgu", sPdtgu)
	
	ls_pspec 	= this.getitemstring(lrow, "momast_copy_pspec")
	wf_item_check(lrow, sitnbr, ls_pspec,  '9999')
	RETURN ireturn
elseif getcolumnname() = "momast_copy_pspec"  then
	tab_1.tabpage_2.p_last.enabled = false		
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_pspec", gettext())	
	
		sPordno 	= getitemstring(Lrow, "momast_copy_pordno")
		spurgc 	= getitemstring(Lrow, "momast_copy_purgc")
		
		if spurgc = 'N' then
			
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')		
			
			// 외주가 아닌 경우에는 자재 출고 구분을 자동출고 구분을 Setting한다.		
			Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autpdt = 'Y';
			if sqlca.sqlcode <> 0 then
				setitem(lrow, "momast_copy_purgc", 'N')
				Messagebox("생산출고", "자동출고용 수불구분을 검색할 수 없읍니다", stopsign!)
				return 1
			end if
			
			sDptno = getitemstring(lrow, "momast_copy_pspec")
			
			Update Holdstock_copy
				Set pspec = :sDptno
			 Where sabu = :gs_sabu and Pordno = :sPordno;
					
			Commit;	
			
			// 외주 내역을 clear
			setitem(lrow, "momast_copy_cvcod",  snull)
			setitem(lrow, "vndmst_cvnas2", snull)
			setitem(lrow, "momast_copy_unprc",  0)			
			
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  snull)
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", snull)
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  0)
			
			// 전체외주인 경우에는 공정생성및 시간계산을 제외한다.
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_routct", 'Y')
			tab_1.tabpage_2.dw_tabpage2.setitem(Lrow, "momast_copy_timect", 'Y')						
			
		Else				/* 외주		*/
			tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'Y')
			sitnbr 		= getitemstring(lrow, "momast_copy_itnbr")
			ls_pspec = getitemstring(lrow, "momast_copy_pspec")
			f_buy_unprc(sitnbr, ls_pspec, '9999', scvcod, scvnas, dUnprc, sTuncu)
			
			// 외주인 경우에는 자재 출고 구분을 외주출고 구분을 Setting한다.
			Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autvnd = 'Y';
			if sqlca.sqlcode <> 0 then
				setitem(lrow, "momast_copy_purgc", 'N')
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_purgc", 'N')
				Messagebox("사급출고", "사급출고용 수불구분을 검색할 수 없읍니다", stopsign!)
				return 1
			end if
			Update Holdstock_copy
				Set out_store 	= :sCvcod,
					 Hold_gu		= :sIogbn,
					 pspec		= :ls_pspec
			 Where sabu = :gs_sabu and Pordno = :sPordno;
			Commit;
			
			if isnull(getitemstring(Lrow, "momast_copy_itnbr")) or trim(getitemstring(Lrow, "momast_copy_itnbr")) = '' then
				setitem(lrow, "momast_copy_cvcod",  snull)
				setitem(lrow, "vndmst_cvnas2", snull)
				setitem(lrow, "momast_copy_unprc",  0)			
				
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  snull)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", snull)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  0)
			Else
				setitem(lrow, "momast_copy_cvcod",  scvcod)
				setitem(lrow, "vndmst_cvnas2", scvnas)
				setitem(lrow, "momast_copy_unprc",  dUnprc)			
				
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_cvcod",  scvcod)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "vndmst_cvnas2", scvnas)
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_unprc",  dUnprc)		
				tab_1.tabpage_3.dw_tabpage3_1.setitem(lrow, "momast_copy_pspec",  ls_pspec)		
			End if;
			
			// 전체외주인 경우에는 공정생성및 시간계산을 제외한다.
			setitem(Lrow, "momast_copy_routct", 'N')
			setitem(Lrow, "momast_copy_timect", 'N')
		end if	
	
elseif this.getcolumnname() = "momast_copy_pdqty"  then
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pdqty", Dec(this.gettext()))
	if dec(this.gettext()) < 1 then
		this.setitem(Lrow, "momast_copy_pdqty", 0)
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pdqty", 0)
		f_message_chk(78,'[지시수량]') 
		RETURN  1	
	end if
elseif this.getcolumnname() = "momast_copy_esdat" then
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_esdat", this.gettext())
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_fsdat", this.gettext())
	this.setitem(lrow, "momast_copy_fsdat", this.gettext())	
	if isnull(this.gettext()) or trim(this.gettext()) = '' then
		return
	end if
	if f_datechk(this.gettext()) = -1 then
		f_message_chk(35,'[생산시작일]') 
		this.setitem(lrow, "momast_copy_esdat", '')
		this.setitem(lrow, "momast_copy_fsdat", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_esdat", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_fsdat", '')
		RETURN  1			
	end if
elseif this.getcolumnname() = "momast_copy_eedat" then
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_eedat", this.gettext())
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_fedat", this.gettext())
	setitem(lrow, "momast_copy_fedat", this.gettext())
	if isnull(this.gettext()) or trim(this.gettext()) = '' then
		return
	end if
	if f_datechk(this.gettext()) = -1 then
		f_message_chk(35,'[생산종료일]') 
		this.setitem(lrow, "momast_copy_eedat", '')
		this.setitem(lrow, "momast_copy_fedat", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_eedat", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_fedat", '')
		RETURN  1			
	end if
	if this.getitemstring(lrow, "momast_copy_esdat") > this.getitemstring(lrow, "momast_copy_eedat") then
		f_message_chk(35,'[생산종료일]') 
		this.setitem(lrow, "momast_copy_eedat", '')
		this.setitem(lrow, "momast_copy_fedat", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_eedat", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_fedat", '')
		RETURN  1			
	end if
elseif this.getcolumnname() = "momast_copy_cvcod"	 then
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	scvcod = this.gettext()
	ireturn = f_get_name2('V1', 'Y', scvcod, sitdsc, sispec)    //1이면 실패, 0이 성공	
	if ireturn = 0 then
		sitnbr = this.getitemstring(lrow, "momast_copy_itnbr")
		select unprc into :dunprc from danmst
			 where itnbr = :sitnbr and cvcod = :scvcod and opseq = '9999';
		 if sqlca.sqlcode <> 0 then
	 		 f_message_chk(82,'[ ' + sitdsc + ' ]')
			 dunprc = 0
		 end if
	end if	
	this.setitem(lrow, "momast_copy_cvcod", scvcod)	
	this.setitem(lrow, "vndmst_cvnas2", sitdsc)	
   this.setitem(lrow, "momast_copy_unprc", dunprc)
	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_cvcod", scvcod)	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "vndmst_cvnas2", sitdsc)	
   tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_unprc", dunprc)	
	
	RETURN ireturn
elseif this.getcolumnname() = "momast_copy_unprc"  then
   tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_unprc", Dec(this.gettext()))
	if dec(this.gettext()) < 1 then
		this.setitem(Lrow, "momast_copy_unprc", 0)
	   tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_unprc", 0)
		f_message_chk(80,'[외주단가]') 
		RETURN  1	
	end if	
elseif this.getcolumnname() = "momast_copy_purgc"  then	
	
	tab_1.tabpage_2.p_last.enabled = false	
	tab_1.tabpage_2.p_last.PictureName = "..\image\작업지시_d.gif"
	this.setitem(lrow, "momast_copy_cvcod", '')
	this.setitem(lrow, "vndmst_cvnas2", '')
	this.setitem(lrow, "momast_copy_unprc", 0)
	
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_cvcod", '')
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "vndmst_cvnas2", '')
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_unprc", 0)	
elseif this.getcolumnname() = "momast_copy_pa_pordno" then
	sreff = this.getitemstring(lrow, "momast_copy_pa_pordno")
	tab_1.tabpage_2.dw_tabpage2.getitemstring(lrow, "momast_copy_pa_pordno")
	
	Select itnbr, pspec, pdsts into :sitnbr, :sispec, :sreff1 from momast_copy
	 where sabu = :gs_sabu and pordno = :sreff;
	if sqlca.sqlcode <> 0 then
		f_message_chk(77,'[작업지시번호]')
		this.setitem(lrow, "momast_copy_pa_pordno", '')
		this.setitem(lrow, "momast_copy_pa_ospeq", '')
		
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_pordno", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_ospeq", '')		
		return 1
	end if
	if sreff1 <> '1' and sreff1 <> '2' then
		f_message_chk(84,'[작업지시상태]')
		this.setitem(lrow, "momast_copy_pa_pordno", '')
		this.setitem(lrow, "momast_copy_pa_ospeq", '')
		
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_pordno", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_ospeq", '')				
		return 1
	end if
	if this.getitemstring(lrow, "momast_copy_itnbr") <> sitnbr or &
		this.getitemstring(lrow, "momast_copy_pspec") <> sispec then
		f_message_chk(85,'[품목,사양]')
		this.setitem(lrow, "momast_copy_pa_pordno", '')
		this.setitem(lrow, "momast_copy_pa_ospeq", '')
		
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_pordno", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_ospeq", '')				
		return 1
	end if
elseif this.getcolumnname() = "momast_copy_pa_ospeq" then
	sitnbr  = this.getitemstring(lrow, "momast_copy_itnbr")
	spordno = this.getitemstring(lrow, "momast_copy_pa_pordno")	
	sopseq  = this.getitemstring(lrow, "momast_copy_pa_ospeq")
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_pordno", sopseq)	

	setnull(sopdsc)
	Select opdsc into :sopdsc from morout
	 Where sabu = :gs_sabu And pordno = :spordno And opseq = :sopseq;
	
   if isnull(sopdsc) then 
		this.setitem(lrow, "momast_copy_pa_ospeq", '')
		tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_ospeq", '')
		return 1
	end if
elseif this.getcolumnname() = "momast_copy_st_opseq" then
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_st_opseq", this.gettext())		
elseif this.getcolumnname() = "momast_copy_matchk" then
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_matchk", this.gettext())		
elseif this.getcolumnname() = "momast_copy_pdprc" then
	tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pdprc", dec(this.gettext()))
end if
end event

event itemerror;return 1
end event

event rbuttondown;String colname
Long   lrow

SetNull(gs_gubun)
SetNull(gs_code)
SetNull(gs_codename)

colname = this.getcolumnname()
lrow	  = this.getrow()
if this.accepttext() = -1 then return

if colname = "momast_copy_itnbr" or colname = "itemas_itdcs" or colname = "itemas_ispec" then
   gs_code = this.getitemstring(lrow, "momast_copy_itnbr")
	open(w_itemas_popup)
	
	if isnull(gs_code) or gs_code = "" then return
	
	this.SetItem(1,"momast_copy_itnbr",gs_code)
	this.TriggerEvent(ItemChanged!)
	
elseif colname = "momast_copy_cvcod" then
		 gs_code 	 = this.getitemstring(lrow, "momast_copy_itnbr")
		 gs_codename = '9999'
		 open(w_danmst_popup)
		 if isnull(gs_code) or gs_code = "" then return
		 this.setitem(lrow, "momast_copy_cvcod", gs_code)
		 this.triggerevent(itemchanged!)
		 
elseif colname = "momast_copy_pa_pordno" or &
		 colname = "momast_copy_pa_ospeq"  then		 
		 
		 gs_code 		= this.getitemstring(lrow, "momast_copy_itnbr")
		 gs_codename 	= this.getitemstring(lrow, "momast_copy_pspec")
		 gs_gubun		= trim(this.getitemstring(lrow, "itemas_itdsc")) + ' ' + &
		 					  trim(this.getitemstring(lrow, "itemas_itdsc"))
		 open(w_pdt_02030_2)
		 if isnull(gs_code) or gs_code = "" then return
		 this.setitem(lrow, "momast_copy_pa_pordno", gs_code)
		 this.setitem(lrow, "momast_copy_pa_ospeq", gs_codename)
		 tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_pordno", gs_code)
		 tab_1.tabpage_2.dw_tabpage2.setitem(lrow, "momast_copy_pa_ospeq",  gs_codename)
elseif colname = "momast_copy_st_opseq" then
		 gs_code = this.getitemstring(lrow, "momast_copy_itnbr")
		 openwithparm(w_routng_popup, gs_code)
		 if isnull(gs_code) or gs_code = "" then return
		 this.setitem(lrow, "momast_copy_st_opseq", gs_code)
		 this.triggerevent(itemchanged!)
end if

end event

event rowfocuschanged;//String  sColumn, sitnbr
//integer ichk
//Long Lrow, Lfind
//
//If Currentrow > 0 then
//	
//
//	/* 품목별 상세/공정내역 error check */	
//	If tab_1.tabpage_3.dw_tabpage3_1.accepttext() = -1 then
//		return 1
//	end if
//	If tab_1.tabpage_3.dw_tabpage3_2.accepttext() = -1 then
//		return 1
//	end if
//
//	iChk =  wf_requiredchk_tabpage31(lrow, scolumn) 
//	w_mdi_frame.sle_msg.text = ''	
//	if iChk = -1 then
//		tab_1.tabpage_3.dw_tabpage3_2.setcolumn(scolumn)
//		tab_1.tabpage_3.dw_tabpage3_2.scrolltorow(lrow)
//		tab_1.tabpage_3.dw_tabpage3_2.setfocus()
//	Else
//		sColumn = this.getitemstring(Currentrow, "momast_copy_pordno")
//		sItnbr  = this.getitemstring(Currentrow, "momast_copy_itnbr")
//		tab_1.tabpage_3.dw_tabpage3_2.retrieve(gs_sabu, scolumn)		
//	end if
//	
//else
//	tab_1.tabpage_3.dw_tabpage3_2.reset()
//end if
end event

event updatestart;/* Update() function 호출시 user 설정 */
long k, lRowCount

lRowCount = this.RowCount()

FOR k = 1 TO lRowCount
   IF NewModified! = this.GetItemStatus(k, 0, Primary!) THEN
 	   This.SetItem(k,'crt_user',gs_userid)
   ELSEIF DataModified! = this.GetItemStatus(k, 0, Primary!) THEN 		
	   This.SetItem(k,'upd_user',gs_userid)
   END IF	  
NEXT


end event

event scrollvertical;long ll_numrows

string ls_firstrow, ls_lastrow

ll_numrows = RowCount()

ls_firstrow = Object.Datawindow.FirstRowOnPage

ls_lastrow = Object.Datawindow.LastRowOnPage

setrow(dec(ls_lastrow))
scrolltorow(dec(ls_lastrow))

RETURN 0
end event

type dw_tabpage3_2 from datawindow within tabpage_3
event ue_key pbm_dwnkey
event ue_pressenter pbm_dwnprocessenter
integer x = 32
integer y = 188
integer width = 4457
integer height = 1032
integer taborder = 30
boolean bringtotop = true
string dataobject = "d_adt_00290_6"
boolean hscrollbar = true
boolean vscrollbar = true
boolean border = false
boolean livescroll = true
end type

event ue_key;if key  = keyf1! then
	this.triggerevent(rbuttondown!)
end if
end event

event ue_pressenter;Send(Handle(this),256,9,0)
Return 1
end event

event itemchanged;string   snull, sitnbr, sreff, sreff1, sitdsc, sispec, scvcod, sopseq, stoday, sPordno, &
			sIogbn, sDptno, sOpdsc, sPurgc, stuncu, scvnas, spdtgu, sTime
long     lrow
integer  ireturn, dinwon
Decimal  {5} dunprc
String	ls_pspec

setnull(snull)

lrow   = dw_tabpage3_2.getrow()

if accepttext() = -1 then
	Messagebox("자료확인", "자료확인시 오류 발생", stopsign!)
	return 1
end if

// 작업시작일자
if this.getcolumnname() = "morout_copy_fsdat" then
	if isnull(this.gettext()) or trim(this.gettext()) = '' then
		f_message_chk(35,'[생산시작일]') 
		this.setitem(lrow, "morout_copy_fsdat", '')
		this.setitem(lrow, "morout_copy_esdat", '')
		RETURN  1
	end if
	if f_datechk(this.gettext()) = -1 then
		f_message_chk(35,'[생산시작일]') 
		this.setitem(lrow, "morout_copy_fsdat", '')
		this.setitem(lrow, "morout_copy_esdat", '')		
		RETURN  1			
	end if
	this.setitem(lrow, "morout_copy_esdat", this.gettext())
	
//	Post wf_calc_time(lrow, '1')
// 작업시작시각
elseif getcolumnname() = "morout_copy_fstim" then
	sTime = trim(this.gettext())
	if f_timechk(sTime) <> 1 Then
		f_message_chk(30, "시각")
		return 1
	end if
		
//	Post wf_calc_time(lrow, '1')
// 작업시작시각
elseif getcolumnname() = "morout_copy_esset" or getcolumnname() = "morout_copy_stdmn"  then
//	Post wf_calc_time(lrow, '1')
elseif this.getcolumnname() = "morout_copy_fedat" then
	if isnull(this.gettext()) or trim(this.gettext()) = '' then
		f_message_chk(35,'[생산종료일]') 
		this.setitem(lrow, "morout_copy_esdat", '')
		this.setitem(lrow, "morout_copy_eedat", '')
		this.setitem(lrow, "morout_copy_fsdat", '')
		this.setitem(lrow, "morout_copy_fedat", '')		
		RETURN  1			
	end if
	if f_datechk(this.gettext()) = -1 then
		f_message_chk(35,'[생산종료일]') 
		this.setitem(lrow, "morout_copy_esdat", '')
		this.setitem(lrow, "morout_copy_eedat", '')
		this.setitem(lrow, "morout_copy_fsdat", '')
		this.setitem(lrow, "morout_copy_fedat", '')		
		RETURN  1			
	end if
	if this.getitemstring(lrow, "morout_copy_fsdat") > this.gettext() then
		f_message_chk(35,'[생산종료일]') 
		this.setitem(lrow, "morout_copy_esdat", '')
		this.setitem(lrow, "morout_copy_eedat", '')
		this.setitem(lrow, "morout_copy_fsdat", '')
		this.setitem(lrow, "morout_copy_fedat", '')
		RETURN  1			
	end if
	this.setitem(lrow, "morout_copy_eedat", this.gettext())
elseif this.getcolumnname() = "morout_copy_wkctr" then
	ireturn = 0
	sreff = this.gettext()
	select a.wkctr, a.wcdsc, b.jocod, b.jonam
	  into :sitnbr, :sreff1, :sitdsc, :sispec
	  from wrkctr a, jomast b
	 where a.wkctr = :sreff and a.jocod = b.jocod (+);
	if sqlca.sqlcode <> 0 then
		f_message_chk(90,'[작업장]')
		setnull(sreff1)		
		setnull(sitnbr)
		setnull(sitdsc)
		setnull(sispec)
		ireturn = 1
	end if
	if not isnull(sreff1)  and isnull(sitdsc) then
		f_message_chk(91,'[조]')
		setnull(sreff1)
		setnull(sitnbr)
		setnull(sitdsc)
		setnull(sispec)
		ireturn = 1
	end if
	this.setitem(lrow, "morout_copy_wkctr", sitnbr)
	this.setitem(lrow, "wrkctr_wcdsc", sreff1)
	this.setitem(lrow, "morout_copy_jocod", sitdsc)
	this.setitem(lrow, "jomast_jonam", sispec)
	return ireturn
elseif this.getcolumnname() = "morout_copy_mchcod" then
	ireturn = 0
	sreff = this.getitemstring(lrow, "morout_copy_mchcod")
	select mchnam
	  into :sreff1
	  from mchmst
	 where sabu = :gs_sabu and mchno = :sreff;
	if sqlca.sqlcode <> 0 then
		f_message_chk(92,'[설비]')
		setnull(sreff)
		setnull(sreff1)
		ireturn = 1
	end if
	this.setitem(lrow, "mchmst_mchnam", sreff1)
	return ireturn	
elseif this.getcolumnname() = "morout_copy_purgc"  then	
	this.setitem(lrow, "morout_copy_wicvcod", '')
	this.setitem(lrow, "vndmst_cvnas2", '')
	this.setitem(lrow, "morout_copy_wiunprc", 0)
	
	sPordno = dw_tabpage3_1.getitemstring(dw_tabpage3_1.getrow(), "momast_copy_pordno")
	sPdtgu   = dw_tabpage3_1.getitemstring(dw_tabpage3_1.getrow(), "momast_copy_pdtgu")
	sItnbr  	= getitemstring(lrow, "morout_copy_itnbr")	
	ls_pspec	= getitemstring(lrow, "morout_copy_pspec")	
	sopseq  	= getitemstring(lrow, "morout_copy_opseq")	
	sopdsc  	= getitemstring(lrow, "morout_copy_opdsc")	
	sPurgc  	= this.gettext()
	
	if sPurgc = 'N' then
		// 외주가 아닌 경우에는 자재 출고 구분을 자동출고 구분을 Setting한다.
		Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autpdt = 'Y';
		if sqlca.sqlcode <> 0 then
			Messagebox("생산출고", "자동출고용 수불구분을 검색할 수 없읍니다", stopsign!)
			return 1
		end if

		sDptno = dw_tabpage3_1.getitemstring(dw_tabpage3_1.getrow(), "momast_copy_pdtgu")

		// 2001/05/11 유 추가 ==> 소진창고 최우선순위 추가 
		select depot_no 
		  into :sCvcod
		  from routng
		 where itnbr = :sItnbr and opseq = :sopseq ;			
	
		if isnull(sCvcod) or sCvcod = '' then 
			select cvcod   into :sCvcod
			  from vndmst where cvgu = '5' and jumaeip = :sDptno and rownum = 1;
		end if
			
		Update Holdstock_copy
			Set out_store = :sCvcod,
				 Hold_gu	  = :sIogbn, 
				 out_chk	  = '1',
				 naougu	  = '1' 				 
		 Where sabu = :gs_sabu and Pordno = :sPordno and opseq = :sOpseq;
			
		Commit;	
		
	Else
			
		sitnbr 		= tab_1.tabpage_3.dw_tabpage3_2.getitemstring(1, "morout_copy_itnbr")
		ls_pspec = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(1, "morout_copy_pspec")
		
		f_buy_unprc(sitnbr, ls_pspec, sopseq, scvcod, scvnas, dUnprc, sTuncu)				
		
//		select cvcod, unprc into :sCvcod, :dUnprc from danmst
//			 where itnbr = :sitnbr and opseq = :sopseq and sltcd = 'Y';
//			 
//		 if sqlca.sqlcode <> 0 then
//	 		 f_message_chk(82,'[ ' + sOpdsc + ' ]')
//		 end if
		 
		setitem(Lrow, "morout_copy_wicvcod", sCvcod)
		setitem(lrow, "morout_copy_wiunprc", dunprc)
		ireturn = f_get_name2('V1', 'Y', scvcod, sitdsc, sispec)    //1이면 실패, 0이 성공
		setitem(Lrow, "vndmst_cvnas2", sItdsc)		 
		
		// 외주인 경우에는 자재 출고 구분을 외주출고 구분을 Setting한다.
		Select Iogbn Into :sIogbn from iomatrix where sabu = '1' and autvnd = 'Y';
		if sqlca.sqlcode <> 0 then
			Messagebox("사급출고", "사급출고용 수불구분을 검색할 수 없읍니다", stopsign!)
			return 1
		end if
		Update Holdstock_copy
			Set out_store = :sCvcod,
				 Hold_gu	  = :sIogbn, 
				 out_chk	  = '2',
				 naougu	  = '2' 
		 Where sabu = :gs_sabu and Pordno = :sPordno and opseq = :sOpseq;
		Commit;		
		
	end if	
	
elseif this.getcolumnname() = "morout_copy_wicvcod"	then
	scvcod = this.getitemstring(lrow, "morout_copy_wicvcod")
	sopseq = this.getitemstring(lrow, "morout_copy_opseq")
	ireturn = f_get_name2('V1', 'Y', scvcod, sitdsc, sispec)    //1이면 실패, 0이 성공	
	if ireturn = 0 then
		sitnbr 		= tab_1.tabpage_3.dw_tabpage3_2.getitemstring(1, "morout_copy_itnbr")
		ls_pspec = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(1, "morout_copy_pspec")
		
		f_buy_unprc(sitnbr, ls_pspec, sopseq, scvcod, scvnas, dUnprc, sTuncu)				
//		select unprc into :dunprc from danmst
//			 where itnbr = :sitnbr and cvcod = :scvcod and opseq = :sopseq and sltcd = 'Y';
//		 if sqlca.sqlcode <> 0 then
//	 		 f_message_chk(82,'[ ' + sitdsc + ' ]')
//			 scvcod = ''
//			 dunprc = 0
//			 sitnbr = ''
//			 sitdsc = ''
//			 ireturn = 1
//		 else
//			 this.setitem(lrow, "morout_copy_wiunprc", dunprc)
//		 end if

	end if	
	
	sPordno = dw_tabpage3_1.getitemstring(dw_tabpage3_1.getrow(), "momast_copy_pordno")
	sopseq  = getitemstring(lrow, "morout_copy_opseq")		
	
	// 할당의 소진처를 변경
	Update Holdstock_copy
		Set out_store = sCvcod
	 Where sabu = :gs_sabu and Pordno = :sPordno;
	Commit;			
	
	this.setitem(lrow, "morout_copy_wicvcod", scvcod)	
	this.setitem(lrow, "vndmst_cvnas2",  sitdsc)
   	this.setitem(lrow, "morout_copy_wiunprc", dunprc)
	RETURN ireturn
elseif this.getcolumnname() = "morout_copy_wiunprc"  then
//	if dec(this.gettext()) < 1 then
//		f_message_chk(80,'[외주단가]') 
//		RETURN  1	
//	end if	
elseif this.getcolumnname() = "morout_copy_estim"  then
	if dec(this.gettext()) < 1 then
		f_message_chk(93,'[작업예상시간]') 
		RETURN  1	
	end if
// 투입인원 조정시
elseif this.getcolumnname() = "morout_copy_esinw"  then
	dinwon = Dec(GetText())
	
	SetItem(lrow, 'morout_copy_esman', GetItemNumber(lrow, 'manhr') * dinwon)	// Man Hour 투입공수
	SetItem(lrow, 'morout_copy_estim', GetItemNumber(lrow, 'manhr') * dinwon + GetItemNumber(lrow, 'morout_copy_esmch'))
end if
end event

event itemerror;return 1
end event

event rbuttondown;string colname
long   lrow

SETNULL(gs_gubun)
setnull(gs_code)
setnull(gs_codename)

colname = this.getcolumnname()
lrow    = this.getrow()

if     colname = "morout_copy_mchcod" then
		 gs_code = this.gettext()
		 gs_gubun    = this.getitemstring(lrow, "morout_copy_wkctr")
		 gs_codename = this.getitemstring(lrow, "wrkctr_wcdsc")
		 open(w_mchmst_popup)
		 if isnull(gs_code) or gs_code = "" then return
		 this.setitem(lrow, "morout_copy_mchcod", gs_code)
		 this.triggerevent(itemchanged!)
elseif colname = "morout_copy_wicvcod" then
		 gs_code = tab_1.tabpage_3.dw_tabpage3_2.getitemstring(lrow, "morout_copy_itnbr")
		 gs_codename = this.getitemstring(lrow, "morout_copy_opseq")
		 open(w_danmst_popup)
		 if isnull(gs_code) or gs_code = "" then return
		 this.setitem(lrow, "morout_copy_wicvcod", gs_code)
		 this.triggerevent(itemchanged!)
elseif colname = "morout_copy_wkctr" then
//		 gs_code = this.gettext()
		 open(w_workplace_popup)
		 if isnull(gs_code) or gs_code = "" then return
		 this.setitem(lrow, "morout_copy_wkctr", gs_code)
		 this.triggerevent(itemchanged!)
end if


end event

event rowfocuschanged;String sPordno, sOpseq

If currentrow > 0 then
	sPordno = GetItemString(currentrow, 'morout_copy_pordno')
	sOpseq  = GetItemString(currentrow, 'morout_copy_opseq')
	
	datawindowchild dwc
	tab_1.tabpage_3.dw_jego.getchild("opseq", dwc)
	dwc.settransobject(sqlca)
	IF dwc.retrieve(gs_sabu, sPordno) < 1 THEN 
		dwc.insertrow(0)
	END IF
			
	tab_1.tabpage_3.dw_jego.reset()
	dw_jego.Retrieve(gs_sabu, sPordno, sOpseq, gs_saupj, is_sysno)
	
	selectrow(0,false)
	selectrow(currentrow, true)
Else
	dw_jego.Reset()
	selectrow(0,false)
End If
end event

type gb_5 from groupbox within tabpage_3
boolean visible = false
integer x = 2793
integer width = 590
integer height = 172
integer taborder = 40
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 16777215
string text = "공정 + 기타 일정계산"
end type

type dw_jego from u_key_enter within tabpage_3
integer x = 32
integer y = 1552
integer width = 4453
integer height = 640
integer taborder = 11
string dataobject = "d_adt_00290_7"
boolean hscrollbar = true
boolean vscrollbar = true
boolean border = false
end type

event doubleclicked;call super::doubleclicked;Long Lrow, lReq
string sitnbr

Lrow = getrow()

if Lrow > 0 then
	
	Lreq =  Messagebox("대체품 & 재고정보" ,"대체품 재고정보를 보시겠읍니까?", question!, yesnocancel!)
	
	if Lreq = 1 then
		gs_code = getitemstring(Lrow, "itnbr")
		open(w_pdt_07200_5)
	Elseif lreq = 2 then
		gs_code 		= getitemstring(Lrow, "itnbr")
		gs_codename = getitemstring(Lrow, "itdsc")
		if isnull(gs_code) or trim(gs_code) = '' or isnull(gs_codename) or trim(gs_codename) = '' then
			return
		end if
		open(w_pdt_04000_1)
		setnull(gs_code)
		setnull(gs_codename)	
	End if
	
end if
end event

event itemchanged;call super::itemchanged;Long Lrow
String sItnbr, sItdsc, sIspec, sAutvnd, sNull, sOpdsc, sOpseq, sPurgc, sPordno, sCvcod, sprvdat, &
		 sRqdat, sdepot_no, sdeptcode, sban, sjaje, sittyp, sCvnas, sPspec, sgijun, sout_store, &
		 STDITNBR, shname, sjijil, sispec_code
Integer iReturn
Decimal {3} dJego_qty, dValid_qty, dValid_qty1, dupjego, dupvalid
String	ls_saupj, ls_first, sPdtgu

Setnull(sNull)

Lrow = this.getrow()

this.accepttext()

dw_ban.accepttext() 		// 반제품 출고 기준창고
dw_jaje.accepttext()		// 부품   출고 기준창고
sBan		=	dw_ban.getitemstring(1, "ban_code")
sJaje		=	dw_jaje.getitemstring(1, "jaje_code")
spordno 	=  dw_tabpage3_2.getitemstring(dw_tabpage3_2.GetRow(), "pordno")

ls_saupj	= dw_saupj.GetItemString(1, "saupj")
sitnbr 	= dw_tabpage3_2.getitemstring(dw_tabpage3_2.GetRow(), "itnbr")
sPdtgu 	= tab_1.tabpage_1.dw_date.GetItemString(1, 'steam')

IF GetColumnName() = "opseq"	THEN
	sOpseq = trim(GetText())
	
	/* 소진창고 */
	Select c.cvcod, c.deptcode into :sdepot_no, :sdeptcode
	  from momast_copy a, vndmst c
	 where a.sabu  = :gs_sabu and a.pordno like :sPordno
		and a.pdtgu = c.jumaeip (+);

    	IF	sdepot_no = '' or isNull(sdepot_no)	then 
			Select cvcod  into :sdepot_no  from vndmst
			 where cvgu = '5' and juprod   = '3'    	and ipjogun = :ls_saupj and rownum = 1;	 
	End If
	SetNull(ls_first)
	// 표준공정의 소진창고를 확인하여 있으면 제일우선순의로 사용.
	select depot_no			  into :ls_first
		from routng
	 where itnbr = :sitnbr and opseq = :sOPSEQ ;
	If	Not isNull(ls_first) and ls_first <> ''	then
		sDepot_no	= ls_first
	End If	
		
	Setitem(Lrow, "Req_dept", 	sDeptcode)
	
	/* 전체외주인 경우에만 허용함 */
	if sOPSEQ = '9999' then
		Setitem(Lrow, "opdsc", sNull)
		IF dw_tabpage3_2.getitemstring(dw_tabpage3_2.GetRow(), "purgc") = 'N' then
			Messagebox("공정", "외주작업이 아니므로 입력할 수 없읍니다", stopsign!)
			Setitem(Lrow, "opseq", 		sNull)
			Setitem(Lrow, "opdsc", 		sNull)
			Setitem(Lrow, "hold_gu", 	sNull)
			Setitem(Lrow, "out_store", sNull)
			Setitem(Lrow, "req_dept", 	sNull)
			Setitem(Lrow, "in_store", 	sNull)
			Setitem(Lrow, "naougu", 	sNull)
			Setitem(Lrow, "out_chk", 	sNull)
			return 1
		Else
			/* 외주출고 에 대한 출고구분을 검색 (외주사급출고는 1개이어야 한다). */
			Select iogbn into :sautvnd from iomatrix 
			 where sabu = :gs_sabu and autvnd = 'Y';
			 
			if sqlca.sqlcode <> 0 then
				Messagebox("외주사급출고", "사급출고구분을 검색할 수 없읍니다", stopsign!)
				Setitem(Lrow, "opseq", 		sNull)
				Setitem(Lrow, "opdsc", 		sNull)
				Setitem(Lrow, "hold_gu", 	sNull)
				Setitem(Lrow, "out_store", sNull)
				Setitem(Lrow, "req_dept", 	sNull)
				Setitem(Lrow, "in_store", 	sNull)
				Setitem(Lrow, "naougu", 	sNull)
				Setitem(Lrow, "out_chk", 	sNull)
				return 1				
			end if
			 
			sRqdat = dw_tabpage3_2.getitemstring(dw_tabpage3_2.GetRow(), "esdat")			
			sCvcod = dw_tabpage3_2.getitemstring(dw_tabpage3_2.GetRow(), "cvcod")

			Setitem(Lrow, "hold_gu", 		sautvnd)
			Setitem(Lrow, "rqdat", 	 		sRqdat)
			Setitem(Lrow, "out_store", 	sCvcod)
			Setitem(Lrow, "in_store", 		sCvcod)
			
			select cvnas2 into :sCvnas from vndmst
			 Where cvcod = :sCvcod;
			 
			if sqlca.sqlcode <> 0 then
				Messagebox("외주거래처", "외주거래처를 검색할 수 없읍니다", stopsign!)
				Setitem(Lrow, "opseq", 		sNull)
				Setitem(Lrow, "opdsc", 		sNull)
				Setitem(Lrow, "hold_gu", 	sNull)
				Setitem(Lrow, "out_store", sNull)
				Setitem(Lrow, "req_dept", 	sNull)
				Setitem(Lrow, "in_store", 	sNull)
				Setitem(Lrow, "naougu", 	sNull)
				Setitem(Lrow, "out_chk", 	sNull)
				return 1				
			end if			 
			 
			Setitem(Lrow, "cvnas", sCvnas)
			Setitem(Lrow, "naougu",   '2')
			Setitem(Lrow, "out_chk",  '2')
			return
		End if
	End if
	
	/* 공정검색 */
	stditnbr	= dw_tabpage3_2.getitemstring(dw_tabpage3_2.GetRow(), "stditnbr")
	Select opdsc, purgc into :sOpdsc, :spurgc 
	  from morout_copy
	 Where sabu = :gs_sabu And pordno = :spordno And opseq = :sOpseq;
	If sqlca.sqlcode <> 0 then
		Messagebox("공정", "해당품목에 공정순서가 없읍니다", stopsign!)
		Setitem(Lrow, "opseq", 		sNull)
		Setitem(Lrow, "opdsc", 		sNull)
		Setitem(Lrow, "hold_gu", 	sNull)
		Setitem(Lrow, "out_store", sNull)
		Setitem(Lrow, "req_dept", 	sNull)
		Setitem(Lrow, "in_store", 	sNull)
		Setitem(Lrow, "naougu", 	sNull)
		Setitem(Lrow, "out_chk", 	sNull)
		return 1
	End if
	
	/* 작업지시 공정검색 */
	Select purgc, wicvcod, esdat into :sPurgc, :scvcod, :sRqdat 
	  from morout_copy
	 Where sabu = :gs_sabu and pordno = :sPordno and opseq = :soPseq;
	If sqlca.sqlcode <> 0 then
		Messagebox("공정", "작업지시되지 않은 공정입니다.", stopsign!)
		Setitem(Lrow, "opseq", 		sNull)
		Setitem(Lrow, "opdsc", 		sNull)
		Setitem(Lrow, "hold_gu", 	sNull)
		Setitem(Lrow, "out_store", sNull)
		Setitem(Lrow, "req_dept", 	sNull)
		Setitem(Lrow, "in_store", 	sNull)
		Setitem(Lrow, "naougu", 	sNull)
		Setitem(Lrow, "out_chk", 	sNull)
		return 1
	End if

	Setitem(Lrow, "opdsc", sOpdsc)
	
	if spurgc = 'N' then
		
		Select iogbn into :sautvnd from iomatrix 
		 where sabu = :gs_sabu and autpdt = 'Y';
		 
		If sqlca.sqlcode <> 0 then
			Messagebox("할당구분", "할당구분을 검색할 수 없읍니다.", stopsign!)
			Setitem(Lrow, "opseq", 		sNull)
			Setitem(Lrow, "opdsc", 		sNull)
			Setitem(Lrow, "hold_gu", 	sNull)
			Setitem(Lrow, "out_store", sNull)
			Setitem(Lrow, "req_dept", 	sNull)
			Setitem(Lrow, "in_store", 	sNull)
			Setitem(Lrow, "naougu", 	sNull)
			Setitem(Lrow, "out_chk", 	sNull)
			return 1
		End if		 

		Setitem(Lrow, "Out_store", sDepot_no)
		
		select cvnas2 into :sCvnas from vndmst
		 Where cvcod = :sDepot_no;
		 
		if sqlca.sqlcode <> 0 then
			Messagebox("소진처창고", "소진처창고를 검색할 수 없읍니다", stopsign!)
			Setitem(Lrow, "opseq", 		sNull)
			Setitem(Lrow, "opdsc", 		sNull)
			Setitem(Lrow, "hold_gu", 	sNull)
			Setitem(Lrow, "out_store", sNull)
			Setitem(Lrow, "req_dept", 	sNull)
			Setitem(Lrow, "in_store", 	sNull)
			Setitem(Lrow, "naougu", 	sNull)
			Setitem(Lrow, "out_chk", 	sNull)
			return 1				
		end if			 
		 
		Setitem(Lrow, "cvnas", sCvnas)
		Setitem(Lrow, "hold_gu",  	sAutvnd)
		Setitem(Lrow, "in_store", 	sNull)
		Setitem(Lrow, "rqdat", 		sRqdat)
		Setitem(Lrow, "naougu",   '1')
		Setitem(Lrow, "out_chk",  '1')
	Else
		
		Select iogbn into :sautvnd from iomatrix 
		 where sabu = :gs_sabu and autvnd = 'Y';		
		 
		If sqlca.sqlcode <> 0 then
			Messagebox("사급구분", "사급구분을 검색할 수 없읍니다.", stopsign!)
			Setitem(Lrow, "opseq", 		sNull)
			Setitem(Lrow, "opdsc", 		sNull)
			Setitem(Lrow, "hold_gu", 	sNull)
			Setitem(Lrow, "out_store", sNull)
			Setitem(Lrow, "req_dept", 	sNull)
			Setitem(Lrow, "in_store", 	sNull)
			Setitem(Lrow, "naougu", 	sNull)
			Setitem(Lrow, "out_chk", 	sNull)
			return 1
		End if		 		 
		
		Setitem(Lrow, "Out_store", sCvcod)		

		select cvnas2 into :sCvnas from vndmst
		 Where cvcod = :sCvcod;
		 
		if sqlca.sqlcode <> 0 then
			Messagebox("외주거래처", "외주거래처를 검색할 수 없읍니다", stopsign!)
			Setitem(Lrow, "opseq", 		sNull)
			Setitem(Lrow, "opdsc", 		sNull)
			Setitem(Lrow, "hold_gu", 	sNull)
			Setitem(Lrow, "out_store", sNull)
			Setitem(Lrow, "req_dept", 	sNull)
			Setitem(Lrow, "in_store", 	sNull)
			Setitem(Lrow, "naougu", 	sNull)
			Setitem(Lrow, "out_chk", 	sNull)
			return 1				
		end if			 
		 
		Setitem(Lrow, "cvnas", 		sCvnas)
		Setitem(Lrow, "hold_gu",  	sAutvnd)		
		Setitem(Lrow, "in_store", 	sCvcod)
		Setitem(Lrow, "rqdat", 		sRqdat)
		Setitem(Lrow, "naougu",   '2')
		Setitem(Lrow, "out_chk",  '2')
	End if

	RETURN ireturn
ElseIF GetColumnName() = "itnbr"	THEN
	sItnbr = trim(GetText())
	ireturn = f_get_name4('품번', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	setitem(lrow, "itnbr", sitnbr)	
	setitem(lrow, "itdsc", sitdsc)	
	setitem(lrow, "ispec", sispec)
	setitem(lrow, "jijil", sjijil)	
	setitem(lrow, "ispec_code", sispec_code)
	
	// 품목구분을 검색하여 할당창고를 저장
	if ireturn = 0 then
		select ittyp into :sittyp from itemas where itnbr = :sitnbr;
		if sittyp = '2' then
			setitem(lrow, "hold_store", sban)
			sgijun = sban
		else
			setitem(lrow, "hold_store", sjaje)			
			sgijun = sjaje
		end if 
		
		select cvnas into :shname
		  from vndmst where cvcod = :sgijun;		
		 setitem(lrow, "vndmst_cvnas", shname)

		// 전체창고 현재고
		dJego_qty 	= 0;
		dValid_qty	= 0;
		sPspec		= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "pspec")
		select sum(nvl(jego_qty, 0)), sum(nvl(valid_qty, 0)) into :djego_qty, :dvalid_qty
		  from stock
		 where itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "jego_qty", 						dJego_qty)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "holdstock_copy_prgo_qty", 	dvalid_qty)
		
		// 관리창고 현재고
		dJego_qty 	= 0;
		select nvl(jego_qty, 0) into :djego_qty 
		  from stock
		 where depot_no = :sgijun and itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "stock_valid_qty", 			dJego_qty)
		
		// 업체창고 현재고, 가용재고
		dupjego 	= 0
		dupvalid	= 0
		sout_store	= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "out_store")		
		select sum(nvl(jego_qty, 0)), sum(nvl(jego_qty - hold_qty, 0))
		  into :dupjego, :dupvalid
		  from stock_vendor
		 where cvcod = :sout_store and itnbr = :sitnbr and pspec = :spspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_jego", dupjego)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_valid", dupvalid)		
		
	end if
	
//	tab_1.tabpage_3.dw_jego.setitem(lrow, "itnbr", sitnbr)	
//	tab_1.tabpage_3.dw_jego.setitem(lrow, "itdsc", sitdsc)	
//	tab_1.tabpage_3.dw_jego.setitem(lrow, "ispec", sispec)	
	RETURN ireturn
ELSEIF GetColumnName() = "itdsc"	THEN
	sItdsc = trim(GetText())
	ireturn = f_get_name4('품명', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	setitem(lrow, "itnbr", sitnbr)	
	setitem(lrow, "itdsc", sitdsc)	
	setitem(lrow, "ispec", sispec)
	setitem(lrow, "jijil", sjijil)	
	setitem(lrow, "ispec_code", sispec_code)
	
	// 품목구분을 검색하여 할당창고를 저장
	if ireturn = 0 then
		select ittyp into :sittyp from itemas where itnbr = :sitnbr;
		if sittyp = '2' then
			setitem(lrow, "hold_store", sban)
			sgijun = sban
		else
			setitem(lrow, "hold_store", sjaje)			
			sgijun = sjaje
		end if 
		
		select cvnas into :shname
		  from vndmst where cvcod = :sgijun;		
		 setitem(lrow, "vndmst_cvnas", shname)		
		
		// 전체창고 현재고
		dJego_qty 	= 0
		dValid_qty	= 0 
		sPspec		= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "pspec")
		select sum(nvl(jego_qty, 0)), sum(nvl(valid_qty, 0)) into :djego_qty, :dvalid_qty
		  from stock
		 where itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "jego_qty", 						dJego_qty)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "holdstock_copy_prgo_qty", 	dvalid_qty)
		
		// 관리창고 현재고
		dJego_qty 	= 0
		select nvl(jego_qty, 0) into :djego_qty 
		  from stock
		 where depot_no = :sgijun and itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "stock_valid_qty", 			dJego_qty)	
		
		// 업체창고 현재고, 가용재고
		dupjego 	= 0
		dupvalid	= 0
		sout_store	= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "out_store")		
		select sum(nvl(jego_qty, 0)), sum(nvl(jego_qty - hold_qty, 0))
		  into :dupjego, :dupvalid
		  from stock_vendor
		 where cvcod = :sout_store and itnbr = :sitnbr and pspec = :spspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_jego", dupjego)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_valid", dupvalid)
	end if	
	
	RETURN ireturn
ELSEIF GetColumnName() = "ispec"	THEN
	sIspec = trim(GetText())
	ireturn = f_get_name4('규격', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	setitem(lrow, "itnbr", sitnbr)	
	setitem(lrow, "itdsc", sitdsc)	
	setitem(lrow, "ispec", sispec)
	setitem(lrow, "jijil", sjijil)	
	setitem(lrow, "ispec_code", sispec_code)
	
	// 품목구분을 검색하여 할당창고를 저장
	if ireturn = 0 then
		select ittyp into :sittyp from itemas where itnbr = :sitnbr;
		if sittyp = '2' then
			setitem(lrow, "hold_store", sban)
			sgijun = sban
		else
			setitem(lrow, "hold_store", sjaje)			
			sgijun = sjaje
		end if 
		
		select cvnas into :shname
		  from vndmst where cvcod = :sgijun;		
		 setitem(lrow, "vndmst_cvnas", shname)		
		
		// 전체창고 현재고
		dJego_qty 	= 0;
		dValid_qty	= 0;
		sPspec		= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "pspec")
		select sum(nvl(jego_qty, 0)), sum(nvl(valid_qty, 0)) into :djego_qty, :dvalid_qty
		  from stock
		 where itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "jego_qty", 						dJego_qty)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "holdstock_copy_prgo_qty", 	dvalid_qty)
		
		// 관리창고 현재고
		dJego_qty 	= 0;
		select nvl(jego_qty, 0) into :djego_qty 
		  from stock
		 where depot_no = :sgijun and itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "stock_valid_qty", 			dJego_qty)		
		
		// 업체창고 현재고, 가용재고
		dupjego 	= 0
		dupvalid	= 0
		sout_store	= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "out_store")		
		select sum(nvl(jego_qty, 0)), sum(nvl(jego_qty - hold_qty, 0))
		  into :dupjego, :dupvalid
		  from stock_vendor
		 where cvcod = :sout_store and itnbr = :sitnbr and pspec = :spspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_jego", dupjego)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_valid", dupvalid)		
	end if	
	RETURN ireturn
ELSEIF GetColumnName() = "jijil"	THEN
	sjijil = trim(GetText())
	ireturn = f_get_name4('재질', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	setitem(lrow, "itnbr", sitnbr)	
	setitem(lrow, "itdsc", sitdsc)	
	setitem(lrow, "ispec", sispec)
	setitem(lrow, "jijil", sjijil)	
	setitem(lrow, "ispec_code", sispec_code)
	
	// 품목구분을 검색하여 할당창고를 저장
	if ireturn = 0 then
		select ittyp into :sittyp from itemas where itnbr = :sitnbr;
		if sittyp = '2' then
			setitem(lrow, "hold_store", sban)
			sgijun = sban
		else
			setitem(lrow, "hold_store", sjaje)			
			sgijun = sjaje
		end if 
		
		select cvnas into :shname
		  from vndmst where cvcod = :sgijun;		
		 setitem(lrow, "vndmst_cvnas", shname)		
		
		// 전체창고 현재고
		dJego_qty 	= 0;
		dValid_qty	= 0;
		sPspec		= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "pspec")
		select sum(nvl(jego_qty, 0)), sum(nvl(valid_qty, 0)) into :djego_qty, :dvalid_qty
		  from stock
		 where itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "jego_qty", 						dJego_qty)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "holdstock_copy_prgo_qty", 	dvalid_qty)
		
		// 관리창고 현재고
		dJego_qty 	= 0;
		select nvl(jego_qty, 0) into :djego_qty 
		  from stock
		 where depot_no = :sgijun and itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "stock_valid_qty", 			dJego_qty)		
		
		// 업체창고 현재고, 가용재고
		dupjego 	= 0
		dupvalid	= 0
		sout_store	= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "out_store")		
		select sum(nvl(jego_qty, 0)), sum(nvl(jego_qty - hold_qty, 0))
		  into :dupjego, :dupvalid
		  from stock_vendor
		 where cvcod = :sout_store and itnbr = :sitnbr and pspec = :spspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_jego", dupjego)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_valid", dupvalid)		
	end if	
	RETURN ireturn
ELSEIF GetColumnName() = "ispec_code"	THEN
	sIspec_code = trim(GetText())
	ireturn = f_get_name4('규격코드', 'Y', sitnbr, sitdsc, sispec, sjijil, sispec_code)
	setitem(lrow, "itnbr", sitnbr)	
	setitem(lrow, "itdsc", sitdsc)	
	setitem(lrow, "ispec", sispec)
	setitem(lrow, "jijil", sjijil)	
	setitem(lrow, "ispec_code", sispec_code)
	
	// 품목구분을 검색하여 할당창고를 저장
	if ireturn = 0 then
		select ittyp into :sittyp from itemas where itnbr = :sitnbr;
		if sittyp = '2' then
			setitem(lrow, "hold_store", sban)
			sgijun = sban
		else
			setitem(lrow, "hold_store", sjaje)			
			sgijun = sjaje
		end if 
		
		select cvnas into :shname
		  from vndmst where cvcod = :sgijun;		
		 setitem(lrow, "vndmst_cvnas", shname)		
		
		// 전체창고 현재고
		dJego_qty 	= 0;
		dValid_qty	= 0;
		sPspec		= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "pspec")
		select sum(nvl(jego_qty, 0)), sum(nvl(valid_qty, 0)) into :djego_qty, :dvalid_qty
		  from stock
		 where itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "jego_qty", 						dJego_qty)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "holdstock_copy_prgo_qty", 	dvalid_qty)
		
		// 관리창고 현재고
		dJego_qty 	= 0;
		select nvl(jego_qty, 0) into :djego_qty 
		  from stock
		 where depot_no = :sgijun and itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "stock_valid_qty", 			dJego_qty)		
		
		// 업체창고 현재고, 가용재고
		dupjego 	= 0
		dupvalid	= 0
		sout_store	= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "out_store")		
		select sum(nvl(jego_qty, 0)), sum(nvl(jego_qty - hold_qty, 0))
		  into :dupjego, :dupvalid
		  from stock_vendor
		 where cvcod = :sout_store and itnbr = :sitnbr and pspec = :spspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_jego", dupjego)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_valid", dupvalid)		
	end if	
	RETURN ireturn
ELSEIF GetColumnName() = "pspec"	THEN
	spspec = trim(GetText())
	sitnbr = getitemstring(lrow, "itnbr")
	sitdsc = getitemstring(lrow, "itdsc")
	sispec = getitemstring(lrow, "ispec")
	
	// 품목구분을 검색하여 할당창고를 저장
	if ireturn = 0 then
		select ittyp into :sittyp from itemas where itnbr = :sitnbr;
		if sittyp = '2' then
			setitem(lrow, "hold_store", sban)
			sgijun = sban
		else
			setitem(lrow, "hold_store", sjaje)			
			sgijun = sjaje
		end if 
		
		select cvnas into :shname
		  from vndmst where cvcod = :sgijun;		
		 setitem(lrow, "vndmst_cvnas", shname)		
		
		// 전체창고 현재고
		dJego_qty 	= 0;
		dValid_qty	= 0;
		select sum(nvl(jego_qty, 0)), sum(nvl(valid_qty, 0)) into :djego_qty, :dvalid_qty
		  from stock
		 where itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "jego_qty", 						dJego_qty)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "holdstock_copy_prgo_qty", 	dvalid_qty)
		
		// 관리창고 현재고
		dJego_qty 	= 0;
		select nvl(jego_qty, 0) into :djego_qty 
		  from stock
		 where depot_no = :sgijun and itnbr = :sItnbr and pspec = :sPspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "stock_valid_qty", 			dJego_qty)		
		
		// 업체창고 현재고, 가용재고
		dupjego 	= 0
		dupvalid	= 0
		sout_store	= tab_1.tabpage_3.dw_jego.getitemstring(Lrow, "out_store")		
		select sum(nvl(jego_qty, 0)), sum(nvl(jego_qty - hold_qty, 0))
		  into :dupjego, :dupvalid
		  from stock_vendor
		 where cvcod = :sout_store and itnbr = :sitnbr and pspec = :spspec;
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_jego", dupjego)
		tab_1.tabpage_3.dw_jego.setitem(Lrow, "ven_valid", dupvalid)		
		
	end if	
	
	RETURN ireturn	
	
ELSEIF GetColumnName() = "out_store"	THEN
	sout_store = trim(GetText())
	sban = getitemstring(Lrow, "hold_gu")
	
	Select autvnd into :sautvnd
	  From iomatrix where sabu = :gs_sabu And iogbn = :sBan;
	  
	select cvgu, cvnas into :sittyp, :sgijun
	  from vndmst where cvcod = :sout_store;
	if sqlca.sqlcode <> 0 then
		Messagebox("소진처", "코드가 부정확합니다", stopsign!)
		setitem(Lrow, "out_store", snull)
		setitem(Lrow, "cvnas",     snull)
		return 1
	Elseif sautvnd = 'N' and sittyp <> '5' then		// 생산출고인데 소진처가 창고가 아니면 error
		Messagebox("소진처", "사내제작이므로 창고코드를 선택하십시요", stopsign!)
		setitem(Lrow, "out_store", snull)
		setitem(Lrow, "cvnas",     snull)		
		return 1		
	Elseif sautvnd = 'Y' and sittyp =  '5' then		// 생산출고인데 소진처가 창고이면      error		
		Messagebox("소진처", "외주사급이므로 거래처코드를 선택하십시요", stopsign!)
		setitem(Lrow, "out_store", snull)
		setitem(Lrow, "cvnas",     snull)		
		return 1	
	Else
		setitem(Lrow, "cvnas", sgijun)
	End if
ELSEIF GetColumnName() = "hold_store"	THEN
	
	sout_store = trim(GetText())
	sban = getitemstring(Lrow, "hold_gu")
	
	Select autvnd into :sautvnd
	  From iomatrix where sabu = :gs_sabu And iogbn = :sBan;
	  
	select cvgu, cvnas into :sittyp, :sgijun
	  from vndmst where cvcod = :sout_store;
	if sqlca.sqlcode <> 0 then
		Messagebox("출고요청처", "코드가 부정확합니다", stopsign!)
		setitem(Lrow, "hold_store",   snull)
		setitem(Lrow, "vndmst_cvnas", snull)		
		return 1
	Elseif sautvnd = 'N' and sittyp <> '5' then		// 생산출고인데 소진처가 창고가 아니면 error
		Messagebox("출고요청처", "사내제작이므로 창고코드를 선택하십시요", stopsign!)
		setitem(Lrow, "hold_store",   snull)
		setitem(Lrow, "vndmst_cvnas", snull)
		return 1		
	Elseif sautvnd = 'Y' and sittyp =  '5' then		// 생산출고인데 소진처가 창고이면      error		
		Messagebox("출고요청처", "외주사급이므로 거래처코드를 선택하십시요", stopsign!)
		setitem(Lrow, "hold_store",   snull)
		setitem(Lrow, "vndmst_cvnas", snull)
		return 1				
	Else
		setitem(Lrow, "vndmst_cvnas", sgijun)				
	End if	
End if

end event

event itemerror;call super::itemerror;return 1
end event

event rbuttondown;call super::rbuttondown;String colname
Long   lrow

SetNull(gs_gubun)
SetNull(gs_code)
SetNull(gs_codename)

colname = this.getcolumnname()
lrow	  = this.getrow()
if this.accepttext() = -1 then return

if colname = "itnbr" or colname = "itdcs" or colname = "ispec" then
   gs_code = this.getitemstring(lrow, "itnbr")
	open(w_itemas_popup)
	
	if isnull(gs_code) or gs_code = "" then return
	
	this.SetItem(lrow,"itnbr",gs_code)
	this.TriggerEvent(ItemChanged!)
elseif colname = 'out_store' then
   gs_code = this.getitemstring(lrow, "out_store")
	open(w_vndmst_popup)
	
	if isnull(gs_code) or gs_code = "" then return
	
	this.SetItem(lrow,"out_store",gs_code)
	this.TriggerEvent(ItemChanged!)	
elseif colname = 'hold_store' then
   gs_code = this.getitemstring(lrow, "hold_store")
	open(w_vndmst_popup)
	
	if isnull(gs_code) or gs_code = "" then return
	
	this.SetItem(lrow,"hold_store",gs_code)
	this.TriggerEvent(ItemChanged!)		
end if

end event

type dw_ban from datawindow within w_adt_00290
boolean visible = false
integer x = 1815
integer y = 60
integer width = 768
integer height = 88
integer taborder = 40
boolean bringtotop = true
string dataobject = "d_pdt_02030_40"
boolean border = false
boolean livescroll = true
end type

type dw_jaje from datawindow within w_adt_00290
boolean visible = false
integer x = 1070
integer y = 60
integer width = 741
integer height = 88
integer taborder = 60
boolean bringtotop = true
string dataobject = "d_pdt_02030_42"
boolean border = false
boolean livescroll = true
end type

type st_2 from statictext within w_adt_00290
boolean visible = false
integer x = 3497
integer y = 64
integer width = 407
integer height = 64
boolean bringtotop = true
integer textsize = -9
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long backcolor = 33027312
boolean enabled = false
string text = "생성 작지번호"
boolean focusrectangle = false
end type

type sle_bal from singlelineedit within w_adt_00290
event ue_key pbm_keydown
boolean visible = false
integer x = 3922
integer y = 60
integer width = 274
integer height = 80
integer taborder = 90
boolean bringtotop = true
integer textsize = -9
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 33027312
boolean autohscroll = false
textcase textcase = upper!
integer limit = 8
end type

event ue_key;//if key = KeyEnter! then
//	cb_mod.setfocus()
//end if
end event

event modified;//string sBaljpno, sNull
//LonG   lCount
//
//setnull(snull)
//
//sBaljpno = trim(this.text)
//
//  SELECT COUNT(*)
//    INTO :lCount
//    FROM POMAST  
//   WHERE SABU    =    '1'   
//     AND BALJPNO LIKE :sBaljpno||'%' ;
//
//IF lCount > 0 THEN
//	MessageBox("확 인", "등록된 발주번호입니다. 생성할 발주번호를 확인하세요!")
//	this.text = sNull
//	return 1
//END IF	
//
end event

type st_3 from statictext within w_adt_00290
integer x = 2555
integer y = 196
integer width = 297
integer height = 64
boolean bringtotop = true
integer textsize = -9
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long backcolor = 12639424
string text = "사업장구분"
boolean focusrectangle = false
end type

type dw_saupj from datawindow within w_adt_00290
integer x = 2880
integer y = 176
integer width = 672
integer height = 80
integer taborder = 110
boolean bringtotop = true
string title = "none"
string dataobject = "D_PDT_02030_44"
boolean border = false
boolean livescroll = true
end type

type dw_print from datawindow within w_adt_00290
boolean visible = false
integer x = 4375
integer y = 64
integer width = 686
integer height = 68
integer taborder = 80
boolean bringtotop = true
string title = "none"
string dataobject = "d_adt_00320_2"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

type cbx_jaje from checkbox within w_adt_00290
boolean visible = false
integer x = 3968
integer y = 68
integer width = 617
integer height = 76
boolean bringtotop = true
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 33027312
string text = "계산시 소요자재 할당"
end type

