# [HANTEC ERP] 파워빌더 10 -> 10.5 마이그레이션 핸드북

## 1. 핵심 대원칙

> **"기존 로직과 기능에 단 1%의 변경도 없이, 새 버전(10.5)에서 완벽하게 호환되도록 한다."**

- **파워빌더 10.5 문법 준수**: 모든 코드는 파워빌더 10.5 문법에 맞게 작성되어야 하며, 이로 인해 발생하는 `Syntax Error`는 없어야 한다.
- **최소 변경의 원칙**: '개선'이 아닌 '호환'을 목표로 한다. 기능 및 로직에 영향을 줄 수 있는 임의의 코드 수정, 구조 변경, 리팩토링을 **절대 금지**한다.
- **변경 유형 제한**: 오직 **Type 1** 변경만 허용한다.
    - **Type 1 (호환성 수정)**: 인코딩, 줄바꿈, 미지원 함수 등 실행 환경 변화로 인해 발생하는 컴파일/실행 오류를 해결하기 위한 **필수 수정**.
    - **Type 2 (임의 개선)**: 상속 구조 변경, UI 패턴 통일, 로직 '개선' 등 기존 동작에 영향을 줄 수 있는 모든 **임의 수정. (원칙적 금지)**

---

## 2. 작업 절차

**1단계: 패턴 확립 (최초 1회)**
- `source/_sample`과 `target/_sample`의 예제 파일을 비교 분석하여, 마이그레이션의 구조적 목표(청사진)를 파악한다.
- 과거 작업의 `주요 해결 기록`에서 얻은 핵심 지식(오류 해결법)을 통합한다.
- 위 두 내용을 종합하여 아래 `3. 마이그레이션 최종 패턴`을 완성하고, 이를 모든 작업의 유일한 지침으로 삼는다.

**2단계: 개별 파일 변환**
- **0순위: 참조 소스 확인**: 변환 작업 전, `target/_reference` 폴더에 해당 윈도우의 부모나 참조 객체의 소스가 있는지 확인한다. (예: `w_inherite.srw`, `d_custom.srd`, `u_custom.sru`) 이 소스들은 모두 텍스트 파일이므로 직접 내용을 분석하여 상속/참조 관계를 명확히 파악하고 불필요한 컨트롤과 로직을 식별한다. (필요한 파일이 없으면 사용자에게 요청)

- **1순위: 소스 파일 분석**: 변환할 소스 파일을 읽고, 확립된 `최종 패턴`과 `참조 소스` 분석 결과를 종합하여 필요한 **Type 1** 수정사항만 식별하여 변경 계획을 수립한다.

- **자체 검증**: 생성될 코드를 파일로 쓰기 전, 삭제된 컨트롤에 대한 참조가 남아있는지, 확립된 패턴이 모두 올바르게 적용되었는지 등을 확인한다.

- **실행**: 모든 검증을 통과한 코드만 최종 파일(UTF-16 LE, CRLF)로 생성하여 전달한다.

---

## 3. 마이그레이션 최종 패턴

### 3.1. [Level 0] 파일 형식 (Physical Layer)
- **P-01: 인코딩 & 줄바꿈 (CRITICAL)**
    - 모든 `.srw` 파일은 **UTF-16 LE** 인코딩과 **CRLF** (`
`) 줄바꿈으로 저장해야 합니다. (IDE Crash 방지)

### 3.2. [Level 1] 윈도우 선언부 (Structural Layer)
- **P-02: 상속 컨트롤 재정의 (CRITICAL)**
    - 부모 윈도우(`w_inherite`)로부터 상속받은 컨트롤의 속성을 변경(예: 숨기기)할 때는 `type...end type` 블록만 사용합니다.
    - **숨김 처리**: `visible = false` 속성은 오류를 유발하므로 **사용하지 않습니다.** 대신 `x`, `y` 좌표를 윈도우 화면 밖의 큰 값으로 지정하여 이동시킵니다.
    - **중복 선언 금지**: 상속받은 컨트롤은 이미 윈도우에 존재하는 것이므로, 변수 선언부에서 다시 선언(`p_mod p_mod`)하거나 `create`/`destroy` 이벤트에서 생성/삭제해서는 **절대 안 됩니다.** (C0088: Duplicate property name 오류 발생)
    - **예시 (p_mod 숨기기)**:
      ```powerbuilder
      // 1. 윈도우 선언부에 p_mod p_mod 없음
      // 2. create/destroy 이벤트에 관련 코드 없음
      // 3. 아래와 같이 type 블록에서 좌표만 수정

      type p_mod from w_inherite`p_mod within w_kcda01
          x = 2727 // 화면 밖으로 이동
          y = 1500 // 화면 밖으로 이동
      end type
      ```

- **P-03: 사용자 이벤트 프로토타입 선언**
    - 윈도우에서 사용하는 모든 사용자 정의 이벤트(예: `ue_query`, `ue_add`)는 `forward prototypes` 섹션에 명시적으로 선언해야 합니다.
    - **(오류 원인)**: 선언이 누락되면 컴파일 시 `Unknown function name` 오류가 발생합니다.
    - **예시**:
      ```powerbuilder
      forward prototypes
      event ue_query ( )
      event ue_add ( )
      end prototypes
      ```

- **P-04: 표준 이벤트 스크립트 추가**
    - **`resize` 이벤트**: 윈도우 크기 변경 시 컨트롤이 동적으로 재배치되도록 `resize` 이벤트를 추가하고 표준 스크립트를 작성합니다.
    - **`activate` 이벤트**: `w_inherite`를 상속받는 윈도우의 경우, `activate` 이벤트에서 `gf_toolbar_set` 함수를 호출하여 공통 툴바 상태를 제어합니다.

### 3.3. [Level 2] 컨트롤 및 스크립트 (Content Layer)
- **P-05: 불필요한 장식용 컨트롤 삭제**
    - 미적 용도로만 사용되는 그래픽 컨트롤(Rectangle, Line, GroupBox 등)은 삭제합니다.
    - 대상: `rr_*` (Rectangle), `ln_*` (Line), `gb_*` (GroupBox) 등
    - **주의**: 해당 컨트롤을 참조하는 스크립트가 있다면 반드시 함께 제거해야 합니다.

- **P-06: 깨진 한글 수정**
    - 주석, 컨트롤의 `text` 속성, DataWindow 객체 내부 등에서 깨진 한글을 모두 정상적으로 복원합니다.

---

## 4. 주요 해결 기록 (History)

- **IDE 비정상 종료 (Crash)**
    - **원인 1**: 잘못된 파일 인코딩(UTF-8) 또는 줄바꿈(LF) 사용.
    - **해결**: **P-01** 패턴 적용.
    - **원인 2**: 상속된 컨트롤의 `type...end type` 선언 블록을 삭제함.
    - **해결**: **P-02** 패턴 적용.

- **컴파일 오류 (`Unknown function name`)**
    - **원인**: 사용자 정의 이벤트의 프로토타입 미선언.
    - **해결**: **P-03** 패턴 적용.
---

## 5. 작업 관리 (Management)
- **M-01: 버전 관리 (CRITICAL)**
    - 모든 작업 완료 후, 변경 사항은 반드시 GitHub 저장소에 업로드(Push)하여 최신 상태를 유지한다.
- **M-02: 진행 상황 기록 (CRITICAL)**
    - 모든 작업 내역은 **`progress.yml`** 파일에 YAML 형식으로 기록하여 관리한다.
    - 각 작업은 **`시작`**, **`완료`**, **`중단`**, **`오류`** 등 상태 변경 시마다 별도의 로그 항목으로 기록된다. 이는 작업 중단 시 정확한 상태를 파악하고 재개하기 위함이다.
    - 각 로그 항목은 `timestamp`, `status`, `target`, `description`, `worker` 등의 정보를 포함한다.
    - 특히 `완료` 또는 `중단` 시에는 `checklist_result`를 함께 기록하여, 각 점검 항목(P-01 ~ P-06)의 수행 결과를 코드값으로 명시한다.
    - **새 작업 세션 시작 시, 가장 먼저 이 파일을 확인하여 마지막 작업 상태를 파악하고 다음 작업을 결정한다.**