# [HANTEC ERP] 파워빌더 10 -> 10.5 마이그레이션 핸드북

## 1. 핵심 대원칙

> **"기존 로직과 기능에 단 1%의 변경도 없이, 새 버전(10.5)에서 완벽하게 호환되도록 한다."**

- **파워빌더 10.5 문법 준수**: 모든 코드는 파워빌더 10.5 문법에 맞게 작성되어야 하며, 이로 인해 발생하는 `Syntax Error`는 없어야 한다.
- **최소 변경의 원칙**: '개선'이 아닌 '호환'을 목표로 한다. 기능 및 로직에 영향을 줄 수 있는 임의의 코드 수정, 구조 변경, 리팩토링을 **절대 금지**한다.
- **참조용 소스 보호**: `source/_sample`, `source/_reference`, `target/_sample`, `target/_reference` 폴더의 파일들은 패턴 분석을 위한 원본 참조 자료이므로, 마이그레이션 작업 중 절대로 수정되어서는 안 된다.
- **변경 유형 제한**: 오직 **Type 1** 변경만 허용한다.
    - **Type 1 (호환성 수정)**: 인코딩, 줄바꿈, 미지원 함수 등 실행 환경 변화로 인해 발생하는 컴파일/실행 오류를 해결하기 위한 **필수 수정**.
    - **Type 2 (임의 개선)**: 상속 구조 변경, UI 패턴 통일, 로직 '개선' 등 기존 동작에 영향을 줄 수 있는 모든 **임의 수정. (원칙적 금지)**

---

## 1.5. 현재 작업 목표: PBMigrator 개발

- **목표**: `specification.md` 명세서에 따라, PowerBuilder 10 소스를 10.5 버전으로 자동 변환하는 GUI 애플리케이션 `PBMigrator`를 개발한다.
- **핵심 역할**:
    - `gemini.md`의 **'3. 마이그레이션 최종 패턴'** 에 정의된 모든 규칙(P-01 ~ P-08)을 자동화하여 적용한다.
    - 사용자가 변환 과정을 시각적으로 확인하고 제어할 수 있는 UI를 제공한다.
- **작업 상태**: `_sample` 폴더의 모든 소스 분석을 통해 최종 패턴 확립을 완료했으며, 이제 `PBMigrator`의 핵심 엔진 및 규칙 구현을 시작한다.

---

## 2. 작업 절차: PBMigrator 사용법

모든 마이그레이션 작업은 `PBMigrator` GUI 프로그램을 통해 진행하는 것을 원칙으로 한다.

**1단계: 프로그램 실행**
- `pb_migrator` 폴더의 `main.py`를 실행하거나 `dist` 폴더의 `PBMigrator.exe`를 실행하여 `PBMigrator`를 시작한다.
- 프로그램은 시작 시 자동으로 `source` 폴더 하위의 모든 `.srw` 파일을 읽어 좌측 '파일 목록'을 채운다.

**2단계: 변환 및 검토**
1.  **파일 선택**: '설정 및 실행' 탭의 '파일 목록'에서 변환할 `.srw` 파일을 선택한다.
2.  **규칙 확인**: 우측 'Controls' 영역에서 적용할 마이그레이션 규칙(P-01 ~ P-08)이 모두 선택되었는지 확인한다.
3.  **미리보기 실행**: `[Preview Changes]` 버튼을 클릭한다.
4.  **결과 확인**: 자동으로 '소스 비교' 탭으로 전환되면, 좌측(원본)과 우측(변환 후)의 코드를 비교한다. 스크롤 동기화 및 Diff 하이라이팅 기능을 통해 변경된 부분을 쉽게 확인할 수 있다.

**3단계: 저장 및 보고**
1.  **파일 저장**: '소스 비교' 탭의 내용이 올바르게 변환되었는지 최종 확인 후, '설정 및 실행' 탭으로 돌아와 `[Save to Target]` 버튼을 클릭한다.
2.  **결과물 확인**:
    - 원본과 동일한 경로를 유지하며 `target` 폴더에 변환된 `.srw` 파일이 생성된다. (P-01 규칙에 따라 UTF-16 LE, CRLF로 저장됨)
    - `target` 폴더 내에 `reports`라는 하위 폴더가 생성되고, 그 안에 작업 내역이 기록된 Markdown 보고서 파일이 생성된다.
3.  **로그 확인**: 'Log' 창을 통해 파일 저장 및 보고서 생성 과정의 성공/실패 여부를 확인한다.

---

## 2.5. PBMigrator 빌드 및 재배포

`PBMigrator`의 소스 코드를 수정한 후, 사용자가 직접 실행할 수 있는 `.exe` 파일을 만들려면 `PBMigrator.spec` 파일을 사용하여 빌드를 진행합니다.

**빌드 절차**

1.  **전제 조건**: 로컬 시스템에 **Python**과 **PyInstaller** 라이브러리가 설치되어 있어야 합니다.
2.  **빌드 실행**: 프로젝트 최상위 폴더(`hantec_erp_gemini`)에서 다음 명령어를 실행합니다. `PBMigrator.spec` 파일에는 필요한 모든 빌드 설정이 이미 포함되어 있습니다.

    ```shell
    py -m PyInstaller PBMigrator.spec
    ```

3.  **결과 확인**: 빌드가 성공하면 `dist` 폴더에 `PBMigrator.exe` 파일이 생성됩니다.

**중요 사항**:
- 빌드 실패 시 `PermissionError`가 발생한다면, 이전에 실행했던 `PBMigrator.exe`가 종료되지 않았거나 다른 프로그램이 파일을 잠근 상태일 수 있습니다. `dist` 폴더의 `.exe` 파일을 수동으로 삭제한 후 다시 빌드를 시도하십시오.

---

## 3. 마이그레이션 최종 패턴

### 3.1. [Level 0] 파일 형식 (Physical Layer)
- **P-01: 인코딩 & 줄바꿈 (CRITICAL)**
    - 모든 `.srw` 파일은 **UTF-16 LE** 인코딩과 **CRLF** (`
`) 줄바꿈으로 저장해야 합니다. (IDE Crash 방지)

### 3.2. [Level 1] 윈도우 선언부 (Structural Layer)
- **P-02: 상속 컨트롤 재정의 (CRITICAL)**
    - 부모 윈도우(`w_inherite`)로부터 상속받은 컨트롤의 속성을 변경(예: 숨기기)할 때는 `type...end type` 블록만 사용합니다.
    - **숨김 처리**: `visible = false` 속성은 오류를 유발하므로 **사용하지 않습니다.** 대신 `x`, `y` 좌표를 윈도우 화면 밖의 큰 값으로 지정하여 이동시킵니다. 이는 **P-08**의 MDI 표준 이벤트가 기존 컨트롤의 로직을 재사용하기 때문입니다.
    - **중복 선언 금지**: 상속받은 컨트롤은 이미 윈도우에 존재하는 것이므로, 변수 선언부에서 다시 선언(`p_mod p_mod`)하거나 `create`/`destroy` 이벤트에서 생성/삭제해서는 **절대 안 됩니다.** (C0088: Duplicate property name 오류 발생)

- **P-03: 사용자 이벤트 프로토타입 선언**
    - 윈도우에서 사용하는 모든 사용자 정의 이벤트(예: `ue_query`, `ue_add`)는 `forward prototypes` 섹션에 명시적으로 선언해야 합니다.
    - **(오류 원인)**: 선언이 누락되면 컴파일 시 `Unknown function name` 오류가 발생합니다.

- **P-04: 표준 이벤트 스크립트 추가 (확장)**
    - **`resize` 이벤트**: **P-07**에 따라 새로 추가된 `Rectangle` 레이아웃 컨트롤(`r_head`, `r_detail` 등)에 맞춰 내부 컨트롤들의 크기와 위치를 동적으로 재배치하는 표준 스크립트를 작성합니다.
    - **`activate` 이벤트**: `w_inherite`를 상속받는 윈도우의 경우, `activate` 이벤트에서 MDI 공통 툴바의 버튼 상태(활성/비활성)를 제어하는 표준 스크립트를 작성합니다.

### 3.3. [Level 2] 컨트롤 및 스크립트 (Content Layer)
- **P-05: 불필요한 장식용 컨트롤 삭제**
    - 미적 용도로만 사용되는 레거시 그래픽 컨트롤(RoundRectangle, Line, GroupBox 등)은 삭제합니다.
    - 대상: `rr_*` (RoundRectangle), `ln_*` (Line), `gb_*` (GroupBox) 등.
    - **주의**: 이 컨트롤들은 **P-07**의 새로운 `Rectangle` 기반 레이아웃으로 대체됩니다.

- **P-06: 깨진 한글 수정**
    - 주석, 컨트롤의 `text` 속성, DataWindow 객체 내부 등에서 깨진 한글을 모두 정상적으로 복원합니다.

### 3.4. [Level 3] UI/UX 현대화 (UI/UX Modernization Layer)
- **P-07: UI/UX 전면 개편 (CRITICAL)**
    - **목표**: 모든 윈도우에 일관된 최신 UI/UX 템플릿을 적용합니다.
    - **레이아웃 재구성**: 기존의 불규칙한 컨트롤 배치를 버리고, `r_head`(상단 영역), `r_detail`(상세 영역) 등 명명된 `Rectangle` 컨트롤을 사용하여 화면을 구조적으로 분할합니다.
    - **컨트롤 재배치**: 모든 데이터윈도우, 버튼 등의 컨트롤은 새로 생성된 `Rectangle` 영역에 맞춰 위치와 크기가 재조정됩니다.
    - **장식 컨트롤 교체**: **P-05**에 따라 삭제된 `RoundRectangle` 등의 장식 컨트롤을 대체하여, `Rectangle` 컨트롤이 새로운 시각적 구조를 형성합니다.

- **P-08: 표준 MDI 이벤트 연동 (CRITICAL)**
    - **목표**: 윈도우 내부의 버튼 이벤트를 MDI 공통 툴바와 연동합니다.
    - **표준 사용자 이벤트 추가**: `ue_retrieve`(조회), `ue_update`(수정), `ue_delete`(삭제), `ue_append`(추가) 등 MDI 툴바의 기능과 일치하는 표준 사용자 이벤트를 윈도우에 추가합니다.
    - **이벤트 호출 체인**: MDI 툴바 버튼 클릭 -> 윈도우의 표준 사용자 이벤트(`ue_*`) 트리거 -> 해당 이벤트의 스크립트가 기존에 숨겨진 `PictureButton`(`p_inq`, `p_mod` 등)의 `Clicked` 이벤트를 호출합니다. 이를 통해 기존 로직을 수정 없이 재사용합니다.

---

## 4. 작업 관리 (Management)

- **M-01: 버전 관리 (CRITICAL)**
    - 모든 작업 완료 후, 변경 사항은 반드시 GitHub 저장소에 업로드(Push)하여 최신 상태를 유지한다.

- **M-02: 진행 상황 기록 (CRITICAL)**
    - 모든 작업 내역은 **`progress.yml`** 파일에 YAML 형식으로 기록하여 관리한다.
    - 각 작업은 `PBMigrator` 실행 단위(파일 변환 및 저장) 또는 주요 결정 사항을 기준으로 로그가 기록된다.
    - 각 로그 항목은 `timestamp`, `status`, `target`, `description`, `worker` 등의 정보를 포함한다.
    - **새 작업 세션 시작 시, 가장 먼저 이 파일을 확인하여 마지막 작업 상태를 파악하고 다음 작업을 결정한다.**

- **M-03: 사용자 요청사항 관리 (CRITICAL)**
    - 사용자의 추가 요청이나 질문, 메모는 **`user_notes.md`** 파일에 기록하는 것을 원칙으로 한다.
    - 작업 세션 시작 시 `progress.yml`과 함께 이 파일을 확인하여 사용자의 요구사항을 파악하고 작업 계획에 반영한다.